import"../chunks/Cm9PB-7n.js";import"../chunks/CTXFyfRD.js";import{p as e,o as t,i as n,f as i,H as s,z as r,b as a,v as o,q as l,c as u,d as c,$ as h,s as d,g as f,j as p,x as g,h as y,m,V as x,r as v}from"../chunks/D26xTDoq.js";import{g as b}from"../chunks/MX-GpV1g.js";import{s as w}from"../chunks/Dj4KJ6hI.js";import{c as S}from"../chunks/DruTVCTs.js";const M=JSON.parse('[{"text":"Breathe in calm, breathe out the three assignments you ignored.","persona":["student"],"intensity":1,"unsafe":false},{"text":"Wow, look at you relaxing instead of doomscrolling. Character development!","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Deadlines? Never heard of them. Close your eyes and pretend they don\'t exist.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":true},{"text":"Inhale. Exhale. Manifest finishing things you haven\'t started.","persona":["creator","student"],"intensity":1,"unsafe":false},{"text":"You\'re doing amazing. Which is wild, considering the chaos you\'re juggling.","persona":["working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Focus. Pretend the exam is a cute little nap you can ace by sleeping.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale confidence, exhale emails you haven\'t opened since Monday.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Creative block? Consider it \'mysterious artistic silence\'.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"You\'ve got this. Which is surprising, but we\'ll allow it.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Marvelous strategy: relax now, panic later. Revolutionary.","persona":["student","working_adult","creator"],"intensity":3,"unsafe":true},{"text":"Breathe. In this exact moment, nothing is on fire. Your inbox is not a hyena. The deadline can wait its turn. You, however, are allowed one luxurious, dramatic inhale like the main character you are.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Close your eyes. Imagine finishing everything. Wild fantasy, I know. But let\'s live there for ten seconds while your nervous system remembers what \'calm\' feels like.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Box breathing: in for 4, hold for 4, out for 4, hold for 4. It\'s like a square, except instead of geometry homework, it\'s your cortisol doing a graceful backflip off the stage.","persona":["student"],"intensity":2,"unsafe":false},{"text":"You are not behind; time is just being dramatic. Inhale like a lighthouse, exhale like you\'re blowing out the candle on procrastination\'s birthday cake.","persona":["creator","student"],"intensity":2,"unsafe":false},{"text":"Professional tip: if you nap with your eyes open, it\'s called \'meditation\'. Breathe in. Hold. Exhale the meeting that should\'ve been an email.","persona":["working_adult"],"intensity":2,"unsafe":true},{"text":"Exams are temporary. Your legendary ability to overthink is forever. Let\'s challenge it: count your breaths instead. Ten down, the world hasn\'t ended. Suspicious.","persona":["student"],"intensity":3,"unsafe":false},{"text":"Creator mode: inhale curiosity, exhale perfectionism. You can make a mess on purpose. It\'s called \'process\' and we\'re glorifying it today.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Your brain is like a browser with 47 tabs open. Let\'s close a few and give it a break.","persona":["student"],"intensity":1,"unsafe":false},{"text":"Study break or strategic avoidance? The line is blurry and we\'re not here to judge.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale knowledge, exhale the fact that you forgot to study for that quiz tomorrow.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Your GPA is temporary, but your ability to stress about things that don\'t matter is eternal.","persona":["student"],"intensity":3,"unsafe":false},{"text":"Deep breath. Your future self will handle the consequences of your current procrastination.","persona":["student"],"intensity":2,"unsafe":false},{"text":"The library is quiet, your mind is loud. Let\'s find some middle ground in this breathing exercise.","persona":["student"],"intensity":1,"unsafe":false},{"text":"You\'re not avoiding responsibility, you\'re practicing strategic time management. Very different.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale the chaos, exhale the fact that you still don\'t understand calculus.","persona":["student"],"intensity":3,"unsafe":false},{"text":"Your laptop has 3% battery and you have 3% motivation. Perfectly balanced.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Breathe in the possibility of getting your life together, breathe out the reality that you probably won\'t.","persona":["student"],"intensity":3,"unsafe":true},{"text":"Your study playlist is longer than your attention span. Let\'s work with what we\'ve got.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale confidence, exhale the fact that you\'re still in your pajamas at 3 PM.","persona":["student"],"intensity":1,"unsafe":false},{"text":"Your brain is a beautiful disaster. Let\'s give it a moment to organize its thoughts.","persona":["student"],"intensity":1,"unsafe":false},{"text":"Deep breath. Your future self will thank you for this moment of not panicking.","persona":["student"],"intensity":1,"unsafe":false},{"text":"You\'re not procrastinating, you\'re doing important research on the art of relaxation.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale the chaos of your life, exhale the fact that you still haven\'t done laundry.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Your stress levels are higher than your GPA, but we\'re working on that.","persona":["student"],"intensity":3,"unsafe":false},{"text":"Breathe in the possibility of success, breathe out the reality of your current situation.","persona":["student"],"intensity":3,"unsafe":true},{"text":"Your brain is like a computer running too many programs. Let\'s give it a reboot.","persona":["student"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you have three papers due tomorrow.","persona":["student"],"intensity":3,"unsafe":false},{"text":"You\'re not avoiding work, you\'re practicing mindfulness. Very different things.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale professionalism, exhale the urge to reply \'k\' to every email.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Your inbox is a horror story, but you\'re the protagonist. Breathe through it.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Deep breath. Your coworkers can\'t see you rolling your eyes through the screen.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Inhale the corporate chaos, exhale the fact that you\'re still in that meeting.","persona":["working_adult"],"intensity":3,"unsafe":false},{"text":"Your work-life balance is like a seesaw with a brick on one side. Let\'s fix that.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Breathe in the possibility of a promotion, breathe out the reality of your current workload.","persona":["working_adult"],"intensity":3,"unsafe":false},{"text":"Your calendar is more packed than a sardine can. Time for some breathing room.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you have 47 unread messages.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Your stress levels are higher than your salary, but we\'re working on that.","persona":["working_adult"],"intensity":3,"unsafe":true},{"text":"Deep breath. Your future self will thank you for not quitting today.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of a raise, exhale the fact that you\'re still underpaid.","persona":["working_adult"],"intensity":3,"unsafe":true},{"text":"Your work ethic is admirable, your work-life balance is concerning. Let\'s fix that.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Breathe in the calm, breathe out the fact that you\'re still in that endless meeting.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Your inbox is a battlefield, but you\'re the general. Strategize your breathing.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of a vacation, exhale the fact that you haven\'t taken one in years.","persona":["working_adult"],"intensity":3,"unsafe":false},{"text":"Your stress levels are higher than your coffee consumption, and that\'s saying something.","persona":["working_adult"],"intensity":3,"unsafe":false},{"text":"Deep breath. Your future self will thank you for not burning out today.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you have another meeting in 5 minutes.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Your work ethic is impressive, your boundaries are non-existent. Let\'s work on that.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Breathe in the possibility of a better job, breathe out the fact that you\'re still here.","persona":["working_adult"],"intensity":3,"unsafe":true},{"text":"Your inbox is a horror story, but you\'re the hero. Breathe through the chaos.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still answering emails at 10 PM.","persona":["working_adult"],"intensity":3,"unsafe":false},{"text":"Inhale inspiration, exhale the fact that you\'ve been staring at a blank canvas for hours.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Your creative block is temporary, but your ability to overthink is forever.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Deep breath. Your muse is just taking a coffee break. She\'ll be back.","persona":["creator"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of a masterpiece, exhale the fact that you\'re still in the sketch phase.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Your perfectionism is admirable, but your progress is more important.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Breathe in the chaos of creativity, breathe out the pressure to be perfect.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Your art is a reflection of your soul, not your productivity. Give it time.","persona":["creator"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'ve been working on the same piece for weeks.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Your creative process is unique, your self-doubt is universal. Let\'s work on that.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Deep breath. Your masterpiece is just taking its time to reveal itself.","persona":["creator"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of success, exhale the fact that you\'re still unknown.","persona":["creator"],"intensity":3,"unsafe":false},{"text":"Your art is worth more than your self-criticism. Remember that.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Breathe in the inspiration, breathe out the comparison to other artists.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Your creative block is just your brain\'s way of saying \'let\'s try something different\'.","persona":["creator"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still not satisfied with your work.","persona":["creator"],"intensity":3,"unsafe":false},{"text":"Your art is a journey, not a destination. Enjoy the process.","persona":["creator"],"intensity":1,"unsafe":false},{"text":"Deep breath. Your creativity is not a finite resource. It\'s infinite.","persona":["creator"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of recognition, exhale the fact that you\'re still struggling.","persona":["creator"],"intensity":3,"unsafe":false},{"text":"Your art is a gift to the world, even if the world doesn\'t know it yet.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Inhale the chaos, exhale the fact that you\'re still figuring it all out.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Your life is a beautiful mess, and that\'s perfectly okay.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re doing better than you think you are.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of change, exhale the fact that you\'re still the same person.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Your stress levels are higher than your achievements, but we\'re working on that.","persona":["student","working_adult","creator"],"intensity":3,"unsafe":false},{"text":"Breathe in the calm, breathe out the fact that you\'re still not where you want to be.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Your life is a work in progress, and that\'s exactly how it should be.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of happiness, exhale the fact that you\'re still searching.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Your journey is unique, your struggles are universal. You\'re not alone.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re stronger than you think, and more capable than you know.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still figuring out this whole \'adulting\' thing.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Your life is a beautiful disaster, and that\'s what makes it interesting.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Breathe in the possibility of growth, exhale the fact that you\'re still learning.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Your story is still being written, and that\'s the most exciting part.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still not perfect. And that\'s okay.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Your life is a masterpiece in progress. Give it time to develop.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re exactly where you need to be, even if it doesn\'t feel like it.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of peace, exhale the fact that you\'re still searching for it.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Your life is a beautiful chaos, and that\'s what makes it worth living.","persona":["student","working_adult","creator"],"intensity":2,"unsafe":false},{"text":"Breathe in the calm, breathe out the fact that you\'re still figuring it all out. And that\'s perfectly normal.","persona":["student","working_adult","creator"],"intensity":1,"unsafe":false},{"text":"Inhale the chaos, exhale the fact that you\'re still explaining long division.","persona":["teacher"],"intensity":3,"unsafe":false},{"text":"Your students are growing, and so are you. That\'s what matters.","persona":["teacher"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re not just teaching subjects, you\'re shaping futures.","persona":["teacher"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you have 47 papers to grade.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Your classroom is a beautiful mess, and that\'s exactly how learning happens.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Breathe in the possibility of a breakthrough, exhale the fact that you\'re still on chapter 1.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Your patience is legendary, your coffee consumption is concerning. Let\'s work on that.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still explaining the same thing.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Your students are lucky to have someone who cares as much as you do.","persona":["teacher"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re making a difference, even when it doesn\'t feel like it.","persona":["teacher"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of a quiet moment, exhale the fact that the bell is about to ring.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Your classroom is a safe space, even when it\'s chaotic. Remember that.","persona":["teacher"],"intensity":1,"unsafe":false},{"text":"Breathe in the calm, breathe out the fact that you\'re still explaining the homework.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Inhale patience, exhale the fact that you\'ve been asked \'what are we doing?\' 12 times.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your love is infinite, your energy is finite. Take care of yourself too.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re doing the most important work in the world.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you haven\'t slept through the night in months.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your patience is superhuman, your coffee consumption is justified.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Breathe in the love, breathe out the fact that you\'re still cleaning up messes.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your care is a gift, your boundaries are necessary. Remember both.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of a nap, exhale the fact that someone needs you.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your love is unconditional, your self-care is essential. Don\'t forget that.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re not just caring for others, you\'re showing them how to care.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still answering \'why\' questions.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your patience is legendary, your love is infinite. That\'s what matters.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Breathe in the possibility of a quiet moment, exhale the fact that someone is calling your name.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your care is a superpower, your exhaustion is temporary. Remember that.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Inhale the love, exhale the fact that you\'re still explaining the same thing.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your dedication is inspiring, your self-care is non-negotiable.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re making a difference in someone\'s life every single day.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still cleaning up after everyone.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your love is a force of nature, your patience is a miracle. Own that.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Breathe in the possibility of a break, exhale the fact that someone needs you.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your care is a gift to the world, even if the world doesn\'t see it.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Inhale the love, exhale the fact that you\'re still the one everyone depends on.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your patience is infinite, your energy is precious. Protect it.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re doing the most important work there is.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still explaining why we can\'t have ice cream for dinner.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your love is unconditional, your boundaries are healthy. Remember both.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Breathe in the possibility of a moment alone, exhale the fact that someone is calling your name.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your care is a superpower, your exhaustion is real. Honor both.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Inhale the love, exhale the fact that you\'re still the one who remembers everything.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your dedication is unmatched, your self-care is essential. Don\'t forget that.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Deep breath. You\'re not just caring for others, you\'re teaching them how to love.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still the one who knows where everything is.","persona":["caregiver"],"intensity":2,"unsafe":false},{"text":"Your love is a force of nature, your patience is a miracle. That\'s what makes you special.","persona":["caregiver"],"intensity":1,"unsafe":false},{"text":"Inhale the possibility of acing that test, exhale the fact that you haven\'t studied yet.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Your brain is like a library with all the books on the floor. Let\'s organize it one breath at a time.","persona":["student"],"intensity":1,"unsafe":false},{"text":"Deep breath. Your future self will thank you for this moment of not panicking about finals.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you have three group projects due tomorrow.","persona":["student"],"intensity":3,"unsafe":false},{"text":"Your study playlist is longer than your attention span, but we\'re working with what we\'ve got.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale professionalism, exhale the fact that you\'re still in your pajama pants on Zoom.","persona":["working_adult"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of a promotion, exhale the fact that you\'re still underpaid.","persona":["working_adult"],"intensity":3,"unsafe":true},{"text":"Inhale the calm, exhale the fact that you\'re still explaining the homework for the 15th time.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of a quiet moment, exhale the fact that someone just spilled juice everywhere.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Your stress levels are higher than your GPA, but we\'re working on that one breath at a time.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Deep breath. Your future self will thank you for this moment of not burning out.","persona":["student"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still figuring out what you want to be when you grow up.","persona":["student"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of a raise, exhale the fact that you\'re still answering emails at midnight.","persona":["working_adult"],"intensity":3,"unsafe":false},{"text":"Inhale the possibility of recognition, exhale the fact that you\'re still unknown.","persona":["creator"],"intensity":3,"unsafe":false},{"text":"Inhale the inspiration, breathe out the comparison to other artists.","persona":["creator"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of a snow day, exhale the fact that it\'s 75 degrees outside.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Your students are lucky to have you, even if they don\'t know it yet.","persona":["teacher"],"intensity":1,"unsafe":false},{"text":"Deep breath. Your impact goes far beyond test scores and lesson plans.","persona":["teacher"],"intensity":1,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you have parent-teacher conferences tomorrow.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Your classroom is a sanctuary, even when it feels like a circus.","persona":["teacher"],"intensity":2,"unsafe":false},{"text":"Inhale the possibility of success, exhale the fact that you\'re probably going to fail anyway.","persona":["student"],"intensity":4,"unsafe":true},{"text":"Your procrastination skills are Olympic-level. Too bad that\'s not an actual sport.","persona":["student"],"intensity":4,"unsafe":false},{"text":"Deep breath. Your future self will hate your current self for this moment of laziness.","persona":["student"],"intensity":4,"unsafe":true},{"text":"Inhale the calm, exhale the fact that you\'re still a hot mess express.","persona":["student"],"intensity":4,"unsafe":true},{"text":"Your brain is like a broken calculator - lots of buttons, no actual math happening.","persona":["student"],"intensity":4,"unsafe":false},{"text":"Inhale the possibility of a promotion, exhale the fact that you\'re still answering emails at 2 AM like a loser.","persona":["working_adult"],"intensity":4,"unsafe":true},{"text":"Your work-life balance is like a seesaw with a concrete block on one side. Spoiler: you\'re the concrete block.","persona":["working_adult"],"intensity":4,"unsafe":false},{"text":"Deep breath. Your future self will thank you for not burning out today, but your present self is already dead inside.","persona":["working_adult"],"intensity":4,"unsafe":true},{"text":"Inhale the calm, exhale the fact that you\'re still in that meeting that should\'ve been an email three hours ago.","persona":["working_adult"],"intensity":4,"unsafe":false},{"text":"Your stress levels are higher than your salary, and that\'s saying something because you\'re probably underpaid.","persona":["working_adult"],"intensity":4,"unsafe":true},{"text":"Inhale the possibility of a masterpiece, exhale the fact that you\'ve been staring at a blank canvas for six months.","persona":["creator"],"intensity":4,"unsafe":false},{"text":"Your creative block is temporary, but your ability to make excuses is forever.","persona":["creator"],"intensity":4,"unsafe":false},{"text":"Deep breath. Your muse is just taking a coffee break. She\'s been on break for three years.","persona":["creator"],"intensity":4,"unsafe":false},{"text":"Inhale the inspiration, exhale the fact that you\'re still unknown and probably always will be.","persona":["creator"],"intensity":4,"unsafe":true},{"text":"Your art is worth more than your self-criticism, but your self-criticism is worth more than your art.","persona":["creator"],"intensity":4,"unsafe":true},{"text":"Inhale the possibility of a snow day, exhale the fact that it\'s 85 degrees and you\'re still explaining long division.","persona":["teacher"],"intensity":4,"unsafe":false},{"text":"Your students are lucky to have you, even if they don\'t know it yet. They\'ll realize it when they\'re 30 and still can\'t do basic math.","persona":["teacher"],"intensity":4,"unsafe":false},{"text":"Deep breath. Your impact goes far beyond test scores and lesson plans, but your salary doesn\'t reflect that.","persona":["teacher"],"intensity":4,"unsafe":true},{"text":"Inhale the calm, exhale the fact that you have parent-teacher conferences tomorrow and the parents are probably more immature than the kids.","persona":["teacher"],"intensity":4,"unsafe":false},{"text":"Your classroom is a sanctuary, even when it feels like a circus. And you\'re the clown.","persona":["teacher"],"intensity":4,"unsafe":false},{"text":"Inhale the possibility of a nap, exhale the fact that someone needs you every five seconds like you\'re their personal butler.","persona":["caregiver"],"intensity":4,"unsafe":false},{"text":"Your care is a gift, your boundaries are non-existent. You\'re basically a doormat with a heart.","persona":["caregiver"],"intensity":4,"unsafe":false},{"text":"Deep breath. You\'re making a difference in someone\'s life every single day, but they probably don\'t appreciate it.","persona":["caregiver"],"intensity":4,"unsafe":false},{"text":"Inhale the calm, exhale the fact that you\'re still cleaning up after everyone like you\'re their maid.","persona":["caregiver"],"intensity":4,"unsafe":false},{"text":"Your love is a force of nature, your patience is a miracle, and your exhaustion is legendary.","persona":["caregiver"],"intensity":4,"unsafe":false}]');const A=new class{usedQuotes=new Set;sessionSeed;lastQuoteTime=0;baseInterval=4;jitterRange=2;constructor(){this.sessionSeed=Math.floor(1e6*Math.random())}getQuote(e){const t=this.getFilteredPool(e);if(0===t.length)return null;const n=t.filter(e=>!this.usedQuotes.has(e.text));if(n.length<.3*t.length)return this.usedQuotes.clear(),this.getRandomQuote(t);const i=this.getRandomQuote(n);return i&&this.usedQuotes.add(i.text),i}getNextQuoteTime(){const e=Date.now()-this.lastQuoteTime,t=1e3*(this.baseInterval-this.jitterRange);if(e<t)return t-e;const n=2*(Math.random()-.5)*this.jitterRange;return 1e3*(this.baseInterval+n)}markQuoteSpoken(){this.lastQuoteTime=Date.now()}getInitialDelay(){return 1e3*(2+2*(Math.random()-.5))}resetSession(){this.usedQuotes.clear(),this.sessionSeed=Math.floor(1e6*Math.random()),this.lastQuoteTime=0}getStats(){const e={total:M.length,byPersona:{student:0,working_adult:0,creator:0,teacher:0,caregiver:0},byIntensity:{0:0,1:0,2:0,3:0,4:0},byProfanity:{safe:0,unsafe:0}};return M.forEach(t=>{t.persona.forEach(t=>{t in e.byPersona&&e.byPersona[t]++}),e.byIntensity[t.intensity]++,t.unsafe?e.byProfanity.unsafe++:e.byProfanity.safe++}),e}getFilteredPool(e){return M.filter(t=>{const n=t.persona.includes(e.persona),i=t.intensity<=e.intensity,s=this.passesProfanityFilter(t,e.profanity);return n&&i&&s})}passesProfanityFilter(e,t){switch(t){case"off":default:return!0;case"medium":case"strict":return!e.unsafe}}getRandomQuote(e){if(0===e.length)return null;return e[this.getSeededRandom(0,e.length-1)]}getSeededRandom(e,t){this.sessionSeed=(9301*this.sessionSeed+49297)%233280;const n=this.sessionSeed/233280;return Math.floor(n*(t-e+1))+e}};const _=new class{audioContext=null;currentAudio=null;isPlaying=!1;voices=[{id:"en-US-JennyNeural",name:"Jenny (US)",language:"en-US",gender:"Female",description:"Friendly and warm"},{id:"en-US-GuyNeural",name:"Guy (US)",language:"en-US",gender:"Male",description:"Professional and clear"},{id:"en-GB-SoniaNeural",name:"Sonia (UK)",language:"en-GB",gender:"Female",description:"British accent, elegant"},{id:"en-GB-RyanNeural",name:"Ryan (UK)",language:"en-GB",gender:"Male",description:"British accent, confident"},{id:"en-US-AriaNeural",name:"Aria (US)",language:"en-US",gender:"Female",description:"Calm and soothing"},{id:"en-US-DavisNeural",name:"Davis (US)",language:"en-US",gender:"Male",description:"Deep and authoritative"},{id:"en-US-JennyMultilingualNeural",name:"Jenny Multilingual",language:"en-US",gender:"Female",description:"Versatile and expressive"},{id:"en-US-GuyMultilingualNeural",name:"Guy Multilingual",language:"en-US",gender:"Male",description:"Versatile and clear"}];async getAvailableVoices(){return this.voices}async speak(e,t){this.isPlaying&&this.stop();try{const n=await this.getTTSAudio(e,t);n?await this.playAudioData(n):this.fallbackToBrowserTTS(e,t)}catch(n){console.error("Failed to speak with AI voice:",n),this.fallbackToBrowserTTS(e,t)}}async getTTSAudio(e,t){try{return console.log("AI TTS requested:",{text:e,settings:t}),await new Promise(e=>setTimeout(e,100)),null}catch(n){return console.error("TTS API call failed:",n),null}}async playAudioData(e){this.audioContext||(this.audioContext=new AudioContext);try{const t=await this.audioContext.decodeAudioData(e),n=this.audioContext.createBufferSource();n.buffer=t,n.connect(this.audioContext.destination),this.currentAudio=n,this.isPlaying=!0,n.onended=()=>{this.isPlaying=!1,this.currentAudio=null},n.start(0)}catch(t){console.error("Failed to play AI audio:",t),this.isPlaying=!1}}fallbackToBrowserTTS(e,t){if("undefined"==typeof speechSynthesis)return void console.warn("Speech synthesis not available");const n=new SpeechSynthesisUtterance(e);n.rate=Math.max(.1,Math.min(10,1+t.rate/100)),n.pitch=Math.max(.5,Math.min(2,1+t.pitch/100)),n.volume=Math.max(0,Math.min(1,t.volume/100));const i=speechSynthesis.getVoices().find(e=>/en/i.test(e.lang));i&&(n.voice=i),n.onend=()=>{this.isPlaying=!1},n.onerror=()=>{this.isPlaying=!1},this.isPlaying=!0,speechSynthesis.speak(n)}stop(){this.currentAudio&&(this.currentAudio.stop(),this.currentAudio=null),this.isPlaying=!1,"undefined"!=typeof speechSynthesis&&speechSynthesis.cancel()}isCurrentlyPlaying(){return this.isPlaying||"undefined"!=typeof speechSynthesis&&speechSynthesis.speaking}async testVoice(e){await this.speak("Hey there, stress ball. Ready for some sarcastic serenity?",e)}async setupTTSAPI(e,t){console.log("TTS API setup:",{apiKey:e?"***":"none",service:t})}};function k(e){let t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function C(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function P(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function B(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function I(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function T(e){let t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function E(e,t){let n=t[0],i=t[1],s=t[2],r=n*n+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function F(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function R(e,t,n){let i=t[0],s=t[1],r=t[2],a=n[0],o=n[1],l=n[2];return e[0]=s*l-r*o,e[1]=r*a-i*l,e[2]=i*o-s*a,e}const D=function(){const e=[0,0,0],t=[0,0,0];return function(n,i){C(e,n),C(t,i),E(e,e),E(t,t);let s=F(e,t);return s>1?0:s<-1?Math.PI:Math.acos(s)}}();class L extends Array{constructor(e=0,t=e,n=e){return super(e,t,n),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,t=e,n=e){return e.length?this.copy(e):(function(e,t,n,i){e[0]=t,e[1]=n,e[2]=i}(this,e,t,n),this)}copy(e){return C(this,e),this}add(e,t){return t?P(this,e,t):P(this,this,e),this}sub(e,t){return t?B(this,e,t):B(this,this,e),this}multiply(e){var t,n,i;return e.length?(n=this,i=e,(t=this)[0]=n[0]*i[0],t[1]=n[1]*i[1],t[2]=n[2]*i[2]):I(this,this,e),this}divide(e){var t,n,i;return e.length?(n=this,i=e,(t=this)[0]=n[0]/i[0],t[1]=n[1]/i[1],t[2]=n[2]/i[2]):I(this,this,1/e),this}inverse(e=this){var t,n;return n=e,(t=this)[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],this}len(){return k(this)}distance(e){return e?function(e,t){let n=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(n*n+i*i+s*s)}(this,e):k(this)}squaredLen(){return T(this)}squaredDistance(e){return e?function(e,t){let n=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return n*n+i*i+s*s}(this,e):T(this)}negate(e=this){var t,n;return n=e,(t=this)[0]=-n[0],t[1]=-n[1],t[2]=-n[2],this}cross(e,t){return t?R(this,e,t):R(this,this,e),this}scale(e){return I(this,this,e),this}normalize(){return E(this,this),this}dot(e){return F(this,e)}equals(e){return n=e,(t=this)[0]===n[0]&&t[1]===n[1]&&t[2]===n[2];var t,n}applyMatrix3(e){return function(e,t,n){let i=t[0],s=t[1],r=t[2];e[0]=i*n[0]+s*n[3]+r*n[6],e[1]=i*n[1]+s*n[4]+r*n[7],e[2]=i*n[2]+s*n[5]+r*n[8]}(this,this,e),this}applyMatrix4(e){return function(e,t,n){let i=t[0],s=t[1],r=t[2],a=n[3]*i+n[7]*s+n[11]*r+n[15];a=a||1,e[0]=(n[0]*i+n[4]*s+n[8]*r+n[12])/a,e[1]=(n[1]*i+n[5]*s+n[9]*r+n[13])/a,e[2]=(n[2]*i+n[6]*s+n[10]*r+n[14])/a}(this,this,e),this}scaleRotateMatrix4(e){return function(e,t,n){let i=t[0],s=t[1],r=t[2],a=n[3]*i+n[7]*s+n[11]*r+n[15];a=a||1,e[0]=(n[0]*i+n[4]*s+n[8]*r)/a,e[1]=(n[1]*i+n[5]*s+n[9]*r)/a,e[2]=(n[2]*i+n[6]*s+n[10]*r)/a}(this,this,e),this}applyQuaternion(e){return function(e,t,n){let i=t[0],s=t[1],r=t[2],a=n[0],o=n[1],l=n[2],u=o*r-l*s,c=l*i-a*r,h=a*s-o*i,d=o*h-l*c,f=l*u-a*h,p=a*c-o*u,g=2*n[3];u*=g,c*=g,h*=g,d*=2,f*=2,p*=2,e[0]=i+u+d,e[1]=s+c+f,e[2]=r+h+p}(this,this,e),this}angle(e){return D(this,e)}lerp(e,t){return function(e,t,n,i){let s=t[0],r=t[1],a=t[2];e[0]=s+i*(n[0]-s),e[1]=r+i*(n[1]-r),e[2]=a+i*(n[2]-a)}(this,this,e,t),this}smoothLerp(e,t,n){return function(e,t,n,i,s){const r=Math.exp(-i*s);let a=t[0],o=t[1],l=t[2];e[0]=n[0]+(a-n[0])*r,e[1]=n[1]+(o-n[1])*r,e[2]=n[2]+(l-n[2])*r}(this,this,e,t,n),this}clone(){return new L(this[0],this[1],this[2])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}transformDirection(e){const t=this[0],n=this[1],i=this[2];return this[0]=e[0]*t+e[4]*n+e[8]*i,this[1]=e[1]*t+e[5]*n+e[9]*i,this[2]=e[2]*t+e[6]*n+e[10]*i,this.normalize()}}const O=new L;let V=1,q=1,Y=!1;class j{constructor(e,t={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=t,this.id=V++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let n in t)this.addAttribute(n,t[n])}addAttribute(e,t){if(this.attributes[e]=t,t.id=q++,t.size=t.size||1,t.type=t.type||(t.data.constructor===Float32Array?this.gl.FLOAT:t.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),t.target="index"===e?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,t.normalized=t.normalized||!1,t.stride=t.stride||0,t.offset=t.offset||0,t.count=t.count||(t.stride?t.data.byteLength/t.stride:t.data.length/t.size),t.divisor=t.instanced||0,t.needsUpdate=!1,t.usage=t.usage||this.gl.STATIC_DRAW,t.buffer||this.updateAttribute(t),t.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==t.count*t.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,t.count*t.divisor);this.instancedCount=t.count*t.divisor}else"index"===e?this.drawRange.count=t.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,t.count))}updateAttribute(e){const t=!e.buffer;t&&(e.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),t?this.gl.bufferData(e.target,e.data,e.usage):this.gl.bufferSubData(e.target,0,e.data),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((e,{name:t,type:n})=>{if(!this.attributes[t])return void console.warn(`active attribute ${t} not being supplied`);const i=this.attributes[t];this.gl.bindBuffer(i.target,i.buffer),this.glState.boundBuffer=i.buffer;let s=1;35674===n&&(s=2),35675===n&&(s=3),35676===n&&(s=4);const r=i.size/s,a=1===s?0:s*s*4,o=1===s?0:4*s;for(let l=0;l<s;l++)this.gl.vertexAttribPointer(e+l,r,i.type,i.normalized,i.stride+a,i.offset+l*o),this.gl.enableVertexAttribArray(e+l),this.gl.renderer.vertexAttribDivisor(e+l,i.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:t=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((e,{name:t})=>{const n=this.attributes[t];n.needsUpdate&&this.updateAttribute(n)});let n=2;this.attributes.index?.type===this.gl.UNSIGNED_INT&&(n=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*n,this.instancedCount):this.gl.renderer.drawArraysInstanced(t,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*n):this.gl.drawArrays(t,this.drawRange.start,this.drawRange.count)}getPosition(){const e=this.attributes.position;return e.data?e:Y?void 0:(console.warn("No position buffer data found to compute bounds"),Y=!0)}computeBoundingBox(e){e||(e=this.getPosition());const t=e.data,n=e.size;this.bounds||(this.bounds={min:new L,max:new L,center:new L,scale:new L,radius:1/0});const i=this.bounds.min,s=this.bounds.max,r=this.bounds.center,a=this.bounds.scale;i.set(1/0),s.set(-1/0);for(let o=0,l=t.length;o<l;o+=n){const e=t[o],n=t[o+1],r=t[o+2];i.x=Math.min(e,i.x),i.y=Math.min(n,i.y),i.z=Math.min(r,i.z),s.x=Math.max(e,s.x),s.y=Math.max(n,s.y),s.z=Math.max(r,s.z)}a.sub(s,i),r.add(i,s).divide(2)}computeBoundingSphere(e){e||(e=this.getPosition());const t=e.data,n=e.size;this.bounds||this.computeBoundingBox(e);let i=0;for(let s=0,r=t.length;s<r;s+=n)O.fromArray(t,s),i=Math.max(i,this.bounds.center.squaredDistance(O));this.bounds.radius=Math.sqrt(i)}remove(){for(let e in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[e]),delete this.VAOs[e];for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let U=1;const z={};class W{constructor(e,{vertex:t,fragment:n,uniforms:i={},transparent:s=!1,cullFace:r=e.BACK,frontFace:a=e.CCW,depthTest:o=!0,depthWrite:l=!0,depthFunc:u=e.LEQUAL}={}){e.canvas||console.error("gl not passed as first argument to Program"),this.gl=e,this.uniforms=i,this.id=U++,t||console.warn("vertex shader not supplied"),n||console.warn("fragment shader not supplied"),this.transparent=s,this.cullFace=r,this.frontFace=a,this.depthTest=o,this.depthWrite=l,this.depthFunc=u,this.blendFunc={},this.blendEquation={},this.stencilFunc={},this.stencilOp={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),this.vertexShader=e.createShader(e.VERTEX_SHADER),this.fragmentShader=e.createShader(e.FRAGMENT_SHADER),this.program=e.createProgram(),e.attachShader(this.program,this.vertexShader),e.attachShader(this.program,this.fragmentShader),this.setShaders({vertex:t,fragment:n})}setShaders({vertex:e,fragment:t}){if(e&&(this.gl.shaderSource(this.vertexShader,e),this.gl.compileShader(this.vertexShader),""!==this.gl.getShaderInfoLog(this.vertexShader)&&console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}\nVertex Shader\n${G(e)}`)),t&&(this.gl.shaderSource(this.fragmentShader,t),this.gl.compileShader(this.fragmentShader),""!==this.gl.getShaderInfoLog(this.fragmentShader)&&console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}\nFragment Shader\n${G(t)}`)),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return console.warn(this.gl.getProgramInfoLog(this.program));this.uniformLocations=new Map;let n=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){let e=this.gl.getActiveUniform(this.program,r);this.uniformLocations.set(e,this.gl.getUniformLocation(this.program,e.name));const t=e.name.match(/(\w+)/g);e.uniformName=t[0],e.nameComponents=t.slice(1)}this.attributeLocations=new Map;const i=[],s=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const e=this.gl.getActiveAttrib(this.program,r),t=this.gl.getAttribLocation(this.program,e.name);-1!==t&&(i[t]=e.name,this.attributeLocations.set(e,t))}this.attributeOrder=i.join("")}setBlendFunc(e,t,n,i){this.blendFunc.src=e,this.blendFunc.dst=t,this.blendFunc.srcAlpha=n,this.blendFunc.dstAlpha=i,e&&(this.transparent=!0)}setBlendEquation(e,t){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=t}setStencilFunc(e,t,n){this.stencilRef=t,this.stencilFunc.func=e,this.stencilFunc.ref=t,this.stencilFunc.mask=n}setStencilOp(e,t,n){this.stencilOp.stencilFail=e,this.stencilOp.depthFail=t,this.stencilOp.depthPass=n}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha),this.stencilFunc.func||this.stencilOp.stencilFail?this.gl.renderer.enable(this.gl.STENCIL_TEST):this.gl.renderer.disable(this.gl.STENCIL_TEST),this.gl.renderer.setStencilFunc(this.stencilFunc.func,this.stencilFunc.ref,this.stencilFunc.mask),this.gl.renderer.setStencilOp(this.stencilOp.stencilFail,this.stencilOp.depthFail,this.stencilOp.depthPass)}use({flipFaces:e=!1}={}){let t=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((e,n)=>{let i=this.uniforms[n.uniformName];for(const t of n.nameComponents){if(!i)break;if(!(t in i)){if(Array.isArray(i.value))break;i=void 0;break}i=i[t]}if(!i)return X(`Active uniform ${n.name} has not been supplied`);if(i&&void 0===i.value)return X(`${n.name} uniform is missing a value parameter`);if(i.value.texture)return t+=1,i.value.update(t),N(this.gl,n.type,e,t);if(i.value.length&&i.value[0].texture){const s=[];return i.value.forEach(e=>{t+=1,e.update(t),s.push(t)}),N(this.gl,n.type,e,s)}N(this.gl,n.type,e,i.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function N(e,t,n,i){i=i.length?function(e){const t=e.length,n=e[0].length;if(void 0===n)return e;const i=t*n;let s=z[i];s||(z[i]=s=new Float32Array(i));for(let r=0;r<t;r++)s.set(e[r],r*n);return s}(i):i;const s=e.renderer.state.uniformLocations.get(n);if(i.length)if(void 0===s||s.length!==i.length)e.renderer.state.uniformLocations.set(n,i.slice(0));else{if(function(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}(s,i))return;s.set?s.set(i):function(e,t){for(let n=0,i=e.length;n<i;n++)e[n]=t[n]}(s,i),e.renderer.state.uniformLocations.set(n,s)}else{if(s===i)return;e.renderer.state.uniformLocations.set(n,i)}switch(t){case 5126:return i.length?e.uniform1fv(n,i):e.uniform1f(n,i);case 35664:return e.uniform2fv(n,i);case 35665:return e.uniform3fv(n,i);case 35666:return e.uniform4fv(n,i);case 35670:case 5124:case 35678:case 36306:case 35680:case 36289:return i.length?e.uniform1iv(n,i):e.uniform1i(n,i);case 35671:case 35667:return e.uniform2iv(n,i);case 35672:case 35668:return e.uniform3iv(n,i);case 35673:case 35669:return e.uniform4iv(n,i);case 35674:return e.uniformMatrix2fv(n,!1,i);case 35675:return e.uniformMatrix3fv(n,!1,i);case 35676:return e.uniformMatrix4fv(n,!1,i)}}function G(e){let t=e.split("\n");for(let n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}let H=0;function X(e){H>100||(console.warn(e),H++,H>100&&console.warn("More than 100 program warnings - stopping logs."))}const Q=new L;let Z=1;class ${constructor({canvas:e=document.createElement("canvas"),width:t=300,height:n=150,dpr:i=1,alpha:s=!1,depth:r=!0,stencil:a=!1,antialias:o=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:u=!1,powerPreference:c="default",autoClear:h=!0,webgl:d=2}={}){const f={alpha:s,depth:r,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c};this.dpr=i,this.alpha=s,this.color=!0,this.depth=r,this.stencil=a,this.premultipliedAlpha=l,this.autoClear=h,this.id=Z++,2===d&&(this.gl=e.getContext("webgl2",f)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",f)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(t,n),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LEQUAL,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,t){this.width=e,this.height=t,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=t*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:e+"px",height:t+"px"})}setViewport(e,t,n=0,i=0){this.state.viewport.width===e&&this.state.viewport.height===t||(this.state.viewport.width=e,this.state.viewport.height=t,this.state.viewport.x=n,this.state.viewport.y=i,this.gl.viewport(n,i,e,t))}setScissor(e,t,n=0,i=0){this.gl.scissor(n,i,e,t)}enable(e){!0!==this.state[e]&&(this.gl.enable(e),this.state[e]=!0)}disable(e){!1!==this.state[e]&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,t,n,i){this.state.blendFunc.src===e&&this.state.blendFunc.dst===t&&this.state.blendFunc.srcAlpha===n&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=e,this.state.blendFunc.dst=t,this.state.blendFunc.srcAlpha=n,this.state.blendFunc.dstAlpha=i,void 0!==n?this.gl.blendFuncSeparate(e,t,n,i):this.gl.blendFunc(e,t))}setBlendEquation(e,t){e=e||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===t||(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=t,void 0!==t?this.gl.blendEquationSeparate(e,t):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}setStencilMask(e){this.state.stencilMask!==e&&(this.state.stencilMask=e,this.gl.stencilMask(e))}setStencilFunc(e,t,n){this.state.stencilFunc===e&&this.state.stencilRef===t&&this.state.stencilFuncMask===n||(this.state.stencilFunc=e||this.gl.ALWAYS,this.state.stencilRef=t||0,this.state.stencilFuncMask=n||0,this.gl.stencilFunc(e||this.gl.ALWAYS,t||0,n||0))}setStencilOp(e,t,n){this.state.stencilFail===e&&this.state.stencilDepthFail===t&&this.state.stencilDepthPass===n||(this.state.stencilFail=e,this.state.stencilDepthFail=t,this.state.stencilDepthPass=n,this.gl.stencilOp(e,t,n))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:t=null}={}){this.state.framebuffer!==t&&(this.state.framebuffer=t,this.gl.bindFramebuffer(e,t))}getExtension(e,t,n){return t&&this.gl[t]?this.gl[t].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),t?this.extensions[e]?this.extensions[e][n].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:e.zDepth!==t.zDepth?e.zDepth-t.zDepth:t.id-e.id}sortTransparent(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.zDepth!==t.zDepth?t.zDepth-e.zDepth:t.id-e.id}sortUI(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:t.id-e.id}getRenderList({scene:e,camera:t,frustumCull:n,sort:i}){let s=[];if(t&&n&&t.updateFrustum(),e.traverse(e=>{if(!e.visible)return!0;e.draw&&(n&&e.frustumCulled&&t&&!t.frustumIntersectsMesh(e)||s.push(e))}),i){const e=[],n=[],i=[];s.forEach(s=>{s.program.transparent?s.program.depthTest?n.push(s):i.push(s):e.push(s),s.zDepth=0,0===s.renderOrder&&s.program.depthTest&&t&&(s.worldMatrix.getTranslation(Q),Q.applyMatrix4(t.projectionViewMatrix),s.zDepth=Q.z)}),e.sort(this.sortOpaque),n.sort(this.sortTransparent),i.sort(this.sortUI),s=e.concat(n,i)}return s}render({scene:e,camera:t,target:n=null,update:i=!0,sort:s=!0,frustumCull:r=!0,clear:a}){null===n?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(n),this.setViewport(n.width,n.height)),(a||this.autoClear&&!1!==a)&&(!this.depth||n&&!n.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),(this.stencil||!n||n.stencil)&&(this.enable(this.gl.STENCIL_TEST),this.setStencilMask(255)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&e.updateMatrixWorld(),t&&t.updateMatrixWorld();this.getRenderList({scene:e,camera:t,frustumCull:r,sort:s}).forEach(e=>{e.draw({camera:t})})}}function K(e,t,n){let i=t[0],s=t[1],r=t[2],a=t[3],o=n[0],l=n[1],u=n[2],c=n[3];return e[0]=i*c+a*o+s*u-r*l,e[1]=s*c+a*l+r*o-i*u,e[2]=r*c+a*u+i*l-s*o,e[3]=a*c-i*o-s*l-r*u,e}const J=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ee=function(e,t,n,i,s){return e[0]=t,e[1]=n,e[2]=i,e[3]=s,e},te=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},ne=function(e,t){let n=t[0],i=t[1],s=t[2],r=t[3],a=n*n+i*i+s*s+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=i*a,e[2]=s*a,e[3]=r*a,e};class ie extends Array{constructor(e=0,t=0,n=0,i=1){super(e,t,n,i),this.onChange=()=>{},this._target=this;const s=["0","1","2","3"];return new Proxy(this,{set(e,t){const n=Reflect.set(...arguments);return n&&s.includes(t)&&e.onChange(),n}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set w(e){this._target[3]=e,this.onChange()}identity(){var e;return(e=this._target)[0]=0,e[1]=0,e[2]=0,e[3]=1,this.onChange(),this}set(e,t,n,i){return e.length?this.copy(e):(ee(this._target,e,t,n,i),this.onChange(),this)}rotateX(e){return function(e,t,n){n*=.5;let i=t[0],s=t[1],r=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);e[0]=i*l+a*o,e[1]=s*l+r*o,e[2]=r*l-s*o,e[3]=a*l-i*o}(this._target,this._target,e),this.onChange(),this}rotateY(e){return function(e,t,n){n*=.5;let i=t[0],s=t[1],r=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);e[0]=i*l-r*o,e[1]=s*l+a*o,e[2]=r*l+i*o,e[3]=a*l-s*o}(this._target,this._target,e),this.onChange(),this}rotateZ(e){return function(e,t,n){n*=.5;let i=t[0],s=t[1],r=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);e[0]=i*l+s*o,e[1]=s*l-i*o,e[2]=r*l+a*o,e[3]=a*l-r*o}(this._target,this._target,e),this.onChange(),this}inverse(e=this._target){return function(e,t){let n=t[0],i=t[1],s=t[2],r=t[3],a=n*n+i*i+s*s+r*r,o=a?1/a:0;e[0]=-n*o,e[1]=-i*o,e[2]=-s*o,e[3]=r*o}(this._target,e),this.onChange(),this}conjugate(e=this._target){var t,n;return t=this._target,n=e,t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],this.onChange(),this}copy(e){return J(this._target,e),this.onChange(),this}normalize(e=this._target){return ne(this._target,e),this.onChange(),this}multiply(e,t){return t?K(this._target,e,t):K(this._target,this._target,e),this.onChange(),this}dot(e){return te(this._target,e)}fromMatrix3(e){return function(e,t){let n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let s=(i+1)%3,r=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*r+r]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*s+r]-t[3*r+s])*n,e[s]=(t[3*s+i]+t[3*i+s])*n,e[r]=(t[3*r+i]+t[3*i+r])*n}}(this._target,e),this.onChange(),this}fromEuler(e,t){return function(e,t,n="YXZ"){let i=Math.sin(.5*t[0]),s=Math.cos(.5*t[0]),r=Math.sin(.5*t[1]),a=Math.cos(.5*t[1]),o=Math.sin(.5*t[2]),l=Math.cos(.5*t[2]);"XYZ"===n?(e[0]=i*a*l+s*r*o,e[1]=s*r*l-i*a*o,e[2]=s*a*o+i*r*l,e[3]=s*a*l-i*r*o):"YXZ"===n?(e[0]=i*a*l+s*r*o,e[1]=s*r*l-i*a*o,e[2]=s*a*o-i*r*l,e[3]=s*a*l+i*r*o):"ZXY"===n?(e[0]=i*a*l-s*r*o,e[1]=s*r*l+i*a*o,e[2]=s*a*o+i*r*l,e[3]=s*a*l-i*r*o):"ZYX"===n?(e[0]=i*a*l-s*r*o,e[1]=s*r*l+i*a*o,e[2]=s*a*o-i*r*l,e[3]=s*a*l+i*r*o):"YZX"===n?(e[0]=i*a*l+s*r*o,e[1]=s*r*l+i*a*o,e[2]=s*a*o-i*r*l,e[3]=s*a*l-i*r*o):"XZY"===n&&(e[0]=i*a*l-s*r*o,e[1]=s*r*l-i*a*o,e[2]=s*a*o+i*r*l,e[3]=s*a*l+i*r*o)}(this._target,e,e.order),t||this.onChange(),this}fromAxisAngle(e,t){return function(e,t,n){n*=.5;let i=Math.sin(n);e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n)}(this._target,e,t),this.onChange(),this}slerp(e,t){return function(e,t,n,i){let s,r,a,o,l,u=t[0],c=t[1],h=t[2],d=t[3],f=n[0],p=n[1],g=n[2],y=n[3];r=u*f+c*p+h*g+d*y,r<0&&(r=-r,f=-f,p=-p,g=-g,y=-y),1-r>1e-6?(s=Math.acos(r),a=Math.sin(s),o=Math.sin((1-i)*s)/a,l=Math.sin(i*s)/a):(o=1-i,l=i),e[0]=o*u+l*f,e[1]=o*c+l*p,e[2]=o*h+l*g,e[3]=o*d+l*y}(this._target,this._target,e,t),this.onChange(),this}fromArray(e,t=0){return this._target[0]=e[t],this._target[1]=e[t+1],this._target[2]=e[t+2],this._target[3]=e[t+3],this.onChange(),this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}}function se(e){let t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],g=e[14],y=e[15];return(t*a-n*r)*(h*y-d*g)-(t*o-i*r)*(c*y-d*p)+(t*l-s*r)*(c*g-h*p)+(n*o-i*a)*(u*y-d*f)-(n*l-s*a)*(u*g-h*f)+(i*l-s*o)*(u*p-c*f)}function re(e,t,n){let i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],y=t[13],m=t[14],x=t[15],v=n[0],b=n[1],w=n[2],S=n[3];return e[0]=v*i+b*o+w*h+S*g,e[1]=v*s+b*l+w*d+S*y,e[2]=v*r+b*u+w*f+S*m,e[3]=v*a+b*c+w*p+S*x,v=n[4],b=n[5],w=n[6],S=n[7],e[4]=v*i+b*o+w*h+S*g,e[5]=v*s+b*l+w*d+S*y,e[6]=v*r+b*u+w*f+S*m,e[7]=v*a+b*c+w*p+S*x,v=n[8],b=n[9],w=n[10],S=n[11],e[8]=v*i+b*o+w*h+S*g,e[9]=v*s+b*l+w*d+S*y,e[10]=v*r+b*u+w*f+S*m,e[11]=v*a+b*c+w*p+S*x,v=n[12],b=n[13],w=n[14],S=n[15],e[12]=v*i+b*o+w*h+S*g,e[13]=v*s+b*l+w*d+S*y,e[14]=v*r+b*u+w*f+S*m,e[15]=v*a+b*c+w*p+S*x,e}function ae(e,t){let n=t[0],i=t[1],s=t[2],r=t[4],a=t[5],o=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.hypot(n,i,s),e[1]=Math.hypot(r,a,o),e[2]=Math.hypot(l,u,c),e}const oe=function(){const e=[1,1,1];return function(t,n){let i=e;ae(i,n);let s=1/i[0],r=1/i[1],a=1/i[2],o=n[0]*s,l=n[1]*r,u=n[2]*a,c=n[4]*s,h=n[5]*r,d=n[6]*a,f=n[8]*s,p=n[9]*r,g=n[10]*a,y=o+h+g,m=0;return y>0?(m=2*Math.sqrt(y+1),t[3]=.25*m,t[0]=(d-p)/m,t[1]=(f-u)/m,t[2]=(l-c)/m):o>h&&o>g?(m=2*Math.sqrt(1+o-h-g),t[3]=(d-p)/m,t[0]=.25*m,t[1]=(l+c)/m,t[2]=(f+u)/m):h>g?(m=2*Math.sqrt(1+h-o-g),t[3]=(f-u)/m,t[0]=(l+c)/m,t[1]=.25*m,t[2]=(d+p)/m):(m=2*Math.sqrt(1+g-o-h),t[3]=(l-c)/m,t[0]=(f+u)/m,t[1]=(d+p)/m,t[2]=.25*m),t}}();function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function ue(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}class ce extends Array{constructor(e=1,t=0,n=0,i=0,s=0,r=1,a=0,o=0,l=0,u=0,c=1,h=0,d=0,f=0,p=0,g=1){return super(e,t,n,i,s,r,a,o,l,u,c,h,d,f,p,g),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,t,n,i,s,r,a,o,l,u,c,h,d,f,p,g){return e.length?this.copy(e):(function(e,t,n,i,s,r,a,o,l,u,c,h,d,f,p,g,y){e[0]=t,e[1]=n,e[2]=i,e[3]=s,e[4]=r,e[5]=a,e[6]=o,e[7]=l,e[8]=u,e[9]=c,e[10]=h,e[11]=d,e[12]=f,e[13]=p,e[14]=g,e[15]=y}(this,e,t,n,i,s,r,a,o,l,u,c,h,d,f,p,g),this)}translate(e,t=this){return function(e,t,n){let i,s,r,a,o,l,u,c,h,d,f,p,g=n[0],y=n[1],m=n[2];t===e?(e[12]=t[0]*g+t[4]*y+t[8]*m+t[12],e[13]=t[1]*g+t[5]*y+t[9]*m+t[13],e[14]=t[2]*g+t[6]*y+t[10]*m+t[14],e[15]=t[3]*g+t[7]*y+t[11]*m+t[15]):(i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=i,e[1]=s,e[2]=r,e[3]=a,e[4]=o,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=i*g+o*y+h*m+t[12],e[13]=s*g+l*y+d*m+t[13],e[14]=r*g+u*y+f*m+t[14],e[15]=a*g+c*y+p*m+t[15])}(this,t,e),this}rotate(e,t,n=this){return function(e,t,n,i){let s,r,a,o,l,u,c,h,d,f,p,g,y,m,x,v,b,w,S,M,A,_,k,C,P=i[0],B=i[1],I=i[2],T=Math.hypot(P,B,I);Math.abs(T)<1e-6||(T=1/T,P*=T,B*=T,I*=T,s=Math.sin(n),r=Math.cos(n),a=1-r,o=t[0],l=t[1],u=t[2],c=t[3],h=t[4],d=t[5],f=t[6],p=t[7],g=t[8],y=t[9],m=t[10],x=t[11],v=P*P*a+r,b=B*P*a+I*s,w=I*P*a-B*s,S=P*B*a-I*s,M=B*B*a+r,A=I*B*a+P*s,_=P*I*a+B*s,k=B*I*a-P*s,C=I*I*a+r,e[0]=o*v+h*b+g*w,e[1]=l*v+d*b+y*w,e[2]=u*v+f*b+m*w,e[3]=c*v+p*b+x*w,e[4]=o*S+h*M+g*A,e[5]=l*S+d*M+y*A,e[6]=u*S+f*M+m*A,e[7]=c*S+p*M+x*A,e[8]=o*_+h*k+g*C,e[9]=l*_+d*k+y*C,e[10]=u*_+f*k+m*C,e[11]=c*_+p*k+x*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,n,e,t),this}scale(e,t=this){return function(e,t,n){let i=n[0],s=n[1],r=n[2];e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(this,t,"number"==typeof e?[e,e,e]:e),this}add(e,t){return t?le(this,e,t):le(this,this,e),this}sub(e,t){return t?ue(this,e,t):ue(this,this,e),this}multiply(e,t){var n,i,s;return e.length?t?re(this,e,t):re(this,this,e):(i=this,s=e,(n=this)[0]=i[0]*s,n[1]=i[1]*s,n[2]=i[2]*s,n[3]=i[3]*s,n[4]=i[4]*s,n[5]=i[5]*s,n[6]=i[6]*s,n[7]=i[7]*s,n[8]=i[8]*s,n[9]=i[9]*s,n[10]=i[10]*s,n[11]=i[11]*s,n[12]=i[12]*s,n[13]=i[13]*s,n[14]=i[14]*s,n[15]=i[15]*s),this}identity(){var e;return(e=this)[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}copy(e){var t,n;return n=e,(t=this)[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}fromPerspective({fov:e,aspect:t,near:n,far:i}={}){return function(e,t,n,i,s){let r=1/Math.tan(t/2),a=1/(i-s);e[0]=r/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(s+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*s*i*a,e[15]=0}(this,e,t,n,i),this}fromOrthogonal({left:e,right:t,bottom:n,top:i,near:s,far:r}){return function(e,t,n,i,s,r,a){let o=1/(t-n),l=1/(i-s),u=1/(r-a);e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*o,e[13]=(s+i)*l,e[14]=(a+r)*u,e[15]=1}(this,e,t,n,i,s,r),this}fromQuaternion(e){return function(e,t){let n=t[0],i=t[1],s=t[2],r=t[3],a=n+n,o=i+i,l=s+s,u=n*a,c=i*a,h=i*o,d=s*a,f=s*o,p=s*l,g=r*a,y=r*o,m=r*l;e[0]=1-h-p,e[1]=c+m,e[2]=d-y,e[3]=0,e[4]=c-m,e[5]=1-u-p,e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return function(e,t){let n=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],y=t[14],m=t[15],x=n*o-i*a,v=n*l-s*a,b=n*u-r*a,w=i*l-s*o,S=i*u-r*o,M=s*u-r*l,A=c*g-h*p,_=c*y-d*p,k=c*m-f*p,C=h*y-d*g,P=h*m-f*g,B=d*m-f*y,I=x*B-v*P+b*C+w*k-S*_+M*A;I&&(I=1/I,e[0]=(o*B-l*P+u*C)*I,e[1]=(s*P-i*B-r*C)*I,e[2]=(g*M-y*S+m*w)*I,e[3]=(d*S-h*M-f*w)*I,e[4]=(l*k-a*B-u*_)*I,e[5]=(n*B-s*k+r*_)*I,e[6]=(y*b-p*M-m*v)*I,e[7]=(c*M-d*b+f*v)*I,e[8]=(a*P-o*k+u*A)*I,e[9]=(i*k-n*P-r*A)*I,e[10]=(p*S-g*b+m*x)*I,e[11]=(h*b-c*S-f*x)*I,e[12]=(o*_-a*C-l*A)*I,e[13]=(n*C-i*_+s*A)*I,e[14]=(g*v-p*w-y*x)*I,e[15]=(c*w-h*v+d*x)*I)}(this,e),this}compose(e,t,n){return function(e,t,n,i){const s=e,r=t[0],a=t[1],o=t[2],l=t[3],u=r+r,c=a+a,h=o+o,d=r*u,f=r*c,p=r*h,g=a*c,y=a*h,m=o*h,x=l*u,v=l*c,b=l*h,w=i[0],S=i[1],M=i[2];s[0]=(1-(g+m))*w,s[1]=(f+b)*w,s[2]=(p-v)*w,s[3]=0,s[4]=(f-b)*S,s[5]=(1-(d+m))*S,s[6]=(y+x)*S,s[7]=0,s[8]=(p+v)*M,s[9]=(y-x)*M,s[10]=(1-(d+g))*M,s[11]=0,s[12]=n[0],s[13]=n[1],s[14]=n[2],s[15]=1}(this,e,t,n),this}decompose(e,t,n){return function(e,t,n,i){let s=k([e[0],e[1],e[2]]);const r=k([e[4],e[5],e[6]]),a=k([e[8],e[9],e[10]]);se(e)<0&&(s=-s),n[0]=e[12],n[1]=e[13],n[2]=e[14];const o=e.slice(),l=1/s,u=1/r,c=1/a;o[0]*=l,o[1]*=l,o[2]*=l,o[4]*=u,o[5]*=u,o[6]*=u,o[8]*=c,o[9]*=c,o[10]*=c,oe(t,o),i[0]=s,i[1]=r,i[2]=a}(this,e,t,n),this}getRotation(e){return oe(e,this),this}getTranslation(e){var t,n;return n=this,(t=e)[0]=n[12],t[1]=n[13],t[2]=n[14],this}getScaling(e){return ae(e,this),this}getMaxScaleOnAxis(){return function(e){let t=e[0],n=e[1],i=e[2],s=e[4],r=e[5],a=e[6],o=e[8],l=e[9],u=e[10];const c=t*t+n*n+i*i,h=s*s+r*r+a*a,d=o*o+l*l+u*u;return Math.sqrt(Math.max(c,h,d))}(this)}lookAt(e,t,n){return function(e,t,n,i){let s=t[0],r=t[1],a=t[2],o=i[0],l=i[1],u=i[2],c=s-n[0],h=r-n[1],d=a-n[2],f=c*c+h*h+d*d;0===f?d=1:(f=1/Math.sqrt(f),c*=f,h*=f,d*=f);let p=l*d-u*h,g=u*c-o*d,y=o*h-l*c;f=p*p+g*g+y*y,0===f&&(u?o+=1e-6:l?u+=1e-6:l+=1e-6,p=l*d-u*h,g=u*c-o*d,y=o*h-l*c,f=p*p+g*g+y*y),f=1/Math.sqrt(f),p*=f,g*=f,y*=f,e[0]=p,e[1]=g,e[2]=y,e[3]=0,e[4]=h*y-d*g,e[5]=d*p-c*y,e[6]=c*g-h*p,e[7]=0,e[8]=c,e[9]=h,e[10]=d,e[11]=0,e[12]=s,e[13]=r,e[14]=a,e[15]=1}(this,e,t,n),this}determinant(){return se(this)}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this[4]=e[t+4],this[5]=e[t+5],this[6]=e[t+6],this[7]=e[t+7],this[8]=e[t+8],this[9]=e[t+9],this[10]=e[t+10],this[11]=e[t+11],this[12]=e[t+12],this[13]=e[t+13],this[14]=e[t+14],this[15]=e[t+15],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e[t+4]=this[4],e[t+5]=this[5],e[t+6]=this[6],e[t+7]=this[7],e[t+8]=this[8],e[t+9]=this[9],e[t+10]=this[10],e[t+11]=this[11],e[t+12]=this[12],e[t+13]=this[13],e[t+14]=this[14],e[t+15]=this[15],e}}const he=new ce;class de extends Array{constructor(e=0,t=e,n=e,i="YXZ"){super(e,t,n),this.order=i,this.onChange=()=>{},this._target=this;const s=["0","1","2"];return new Proxy(this,{set(e,t){const n=Reflect.set(...arguments);return n&&s.includes(t)&&e.onChange(),n}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set(e,t=e,n=e){return e.length?this.copy(e):(this._target[0]=e,this._target[1]=t,this._target[2]=n,this.onChange(),this)}copy(e){return this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2],this.onChange(),this}reorder(e){return this._target.order=e,this.onChange(),this}fromRotationMatrix(e,t=this.order){return function(e,t,n="YXZ"){"XYZ"===n?(e[1]=Math.asin(Math.min(Math.max(t[8],-1),1)),Math.abs(t[8])<.99999?(e[0]=Math.atan2(-t[9],t[10]),e[2]=Math.atan2(-t[4],t[0])):(e[0]=Math.atan2(t[6],t[5]),e[2]=0)):"YXZ"===n?(e[0]=Math.asin(-Math.min(Math.max(t[9],-1),1)),Math.abs(t[9])<.99999?(e[1]=Math.atan2(t[8],t[10]),e[2]=Math.atan2(t[1],t[5])):(e[1]=Math.atan2(-t[2],t[0]),e[2]=0)):"ZXY"===n?(e[0]=Math.asin(Math.min(Math.max(t[6],-1),1)),Math.abs(t[6])<.99999?(e[1]=Math.atan2(-t[2],t[10]),e[2]=Math.atan2(-t[4],t[5])):(e[1]=0,e[2]=Math.atan2(t[1],t[0]))):"ZYX"===n?(e[1]=Math.asin(-Math.min(Math.max(t[2],-1),1)),Math.abs(t[2])<.99999?(e[0]=Math.atan2(t[6],t[10]),e[2]=Math.atan2(t[1],t[0])):(e[0]=0,e[2]=Math.atan2(-t[4],t[5]))):"YZX"===n?(e[2]=Math.asin(Math.min(Math.max(t[1],-1),1)),Math.abs(t[1])<.99999?(e[0]=Math.atan2(-t[9],t[5]),e[1]=Math.atan2(-t[2],t[0])):(e[0]=0,e[1]=Math.atan2(t[8],t[10]))):"XZY"===n&&(e[2]=Math.asin(-Math.min(Math.max(t[4],-1),1)),Math.abs(t[4])<.99999?(e[0]=Math.atan2(t[6],t[5]),e[1]=Math.atan2(t[8],t[0])):(e[0]=Math.atan2(-t[9],t[10]),e[1]=0))}(this._target,e,t),this.onChange(),this}fromQuaternion(e,t=this.order,n){return he.fromQuaternion(e),this._target.fromRotationMatrix(he,t),n||this.onChange(),this}fromArray(e,t=0){return this._target[0]=e[t],this._target[1]=e[t+1],this._target[2]=e[t+2],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}}class fe{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new ce,this.worldMatrix=new ce,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new L,this.quaternion=new ie,this.scale=new L(1),this.rotation=new de,this.up=new L(0,1,0),this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,!0),this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,void 0,!0)}setParent(e,t=!0){this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,t&&e&&e.addChild(this,!1)}addChild(e,t=!0){~this.children.indexOf(e)||this.children.push(e),t&&e.setParent(this,!1)}removeChild(e,t=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),t&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,t=!1){t?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion._target),this.rotation.fromQuaternion(this.quaternion)}}const pe=new ce,ge=new L,ye=new L;class me extends fe{constructor(e,{near:t=.1,far:n=100,fov:i=45,aspect:s=1,left:r,right:a,bottom:o,top:l,zoom:u=1}={}){super(),Object.assign(this,{near:t,far:n,fov:i,aspect:s,left:r,right:a,bottom:o,top:l,zoom:u}),this.projectionMatrix=new ce,this.viewMatrix=new ce,this.projectionViewMatrix=new ce,this.worldPosition=new L,this.type=r||a?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:e=this.near,far:t=this.far,fov:n=this.fov,aspect:i=this.aspect}={}){return Object.assign(this,{near:e,far:t,fov:n,aspect:i}),this.projectionMatrix.fromPerspective({fov:n*(Math.PI/180),aspect:i,near:e,far:t}),this.type="perspective",this}orthographic({near:e=this.near,far:t=this.far,left:n=this.left||-1,right:i=this.right||1,bottom:s=this.bottom||-1,top:r=this.top||1,zoom:a=this.zoom}={}){return Object.assign(this,{near:e,far:t,left:n,right:i,bottom:s,top:r,zoom:a}),n/=a,i/=a,s/=a,r/=a,this.projectionMatrix.fromOrthogonal({left:n,right:i,bottom:s,top:r,near:e,far:t}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}updateProjectionMatrix(){return"perspective"===this.type?this.perspective():this.orthographic()}lookAt(e){return super.lookAt(e,!0),this}project(e){return e.applyMatrix4(this.viewMatrix),e.applyMatrix4(this.projectionMatrix),this}unproject(e){return e.applyMatrix4(pe.inverse(this.projectionMatrix)),e.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new L,new L,new L,new L,new L,new L]);const e=this.projectionViewMatrix;this.frustum[0].set(e[3]-e[0],e[7]-e[4],e[11]-e[8]).constant=e[15]-e[12],this.frustum[1].set(e[3]+e[0],e[7]+e[4],e[11]+e[8]).constant=e[15]+e[12],this.frustum[2].set(e[3]+e[1],e[7]+e[5],e[11]+e[9]).constant=e[15]+e[13],this.frustum[3].set(e[3]-e[1],e[7]-e[5],e[11]-e[9]).constant=e[15]-e[13],this.frustum[4].set(e[3]-e[2],e[7]-e[6],e[11]-e[10]).constant=e[15]-e[14],this.frustum[5].set(e[3]+e[2],e[7]+e[6],e[11]+e[10]).constant=e[15]+e[14];for(let t=0;t<6;t++){const e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(e,t=e.worldMatrix){if(!e.geometry.attributes.position)return!0;if(e.geometry.bounds&&e.geometry.bounds.radius!==1/0||e.geometry.computeBoundingSphere(),!e.geometry.bounds)return!0;const n=ge;n.copy(e.geometry.bounds.center),n.applyMatrix4(t);const i=e.geometry.bounds.radius*t.getMaxScaleOnAxis();return this.frustumIntersectsSphere(n,i)}frustumIntersectsSphere(e,t){const n=ye;for(let i=0;i<6;i++){const s=this.frustum[i];if(n.copy(s).dot(e)+s.constant<-t)return!1}return!0}}function xe(e,t,n){let i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=n[0],f=n[1],p=n[2],g=n[3],y=n[4],m=n[5],x=n[6],v=n[7],b=n[8];return e[0]=d*i+f*a+p*u,e[1]=d*s+f*o+p*c,e[2]=d*r+f*l+p*h,e[3]=g*i+y*a+m*u,e[4]=g*s+y*o+m*c,e[5]=g*r+y*l+m*h,e[6]=x*i+v*a+b*u,e[7]=x*s+v*o+b*c,e[8]=x*r+v*l+b*h,e}class ve extends Array{constructor(e=1,t=0,n=0,i=0,s=1,r=0,a=0,o=0,l=1){return super(e,t,n,i,s,r,a,o,l),this}set(e,t,n,i,s,r,a,o,l){return e.length?this.copy(e):(function(e,t,n,i,s,r,a,o,l,u){e[0]=t,e[1]=n,e[2]=i,e[3]=s,e[4]=r,e[5]=a,e[6]=o,e[7]=l,e[8]=u}(this,e,t,n,i,s,r,a,o,l),this)}translate(e,t=this){return function(e,t,n){let i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=n[0],f=n[1];e[0]=i,e[1]=s,e[2]=r,e[3]=a,e[4]=o,e[5]=l,e[6]=d*i+f*a+u,e[7]=d*s+f*o+c,e[8]=d*r+f*l+h}(this,t,e),this}rotate(e,t=this){return function(e,t,n){let i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=Math.sin(n),f=Math.cos(n);e[0]=f*i+d*a,e[1]=f*s+d*o,e[2]=f*r+d*l,e[3]=f*a-d*i,e[4]=f*o-d*s,e[5]=f*l-d*r,e[6]=u,e[7]=c,e[8]=h}(this,t,e),this}scale(e,t=this){return function(e,t,n){let i=n[0],s=n[1];e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]}(this,t,e),this}multiply(e,t){return t?xe(this,e,t):xe(this,this,e),this}identity(){var e;return(e=this)[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this}copy(e){var t,n;return n=e,(t=this)[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}fromMatrix4(e){var t,n;return n=e,(t=this)[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],this}fromQuaternion(e){return function(e,t){let n=t[0],i=t[1],s=t[2],r=t[3],a=n+n,o=i+i,l=s+s,u=n*a,c=i*a,h=i*o,d=s*a,f=s*o,p=s*l,g=r*a,y=r*o,m=r*l;e[0]=1-h-p,e[3]=c-m,e[6]=d+y,e[1]=c+m,e[4]=1-u-p,e[7]=f-g,e[2]=d-y,e[5]=f+g,e[8]=1-u-h}(this,e),this}fromBasis(e,t,n){return this.set(e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]),this}inverse(e=this){return function(e,t){let n=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=c*a-o*u,d=-c*r+o*l,f=u*r-a*l,p=n*h+i*d+s*f;p&&(p=1/p,e[0]=h*p,e[1]=(-c*i+s*u)*p,e[2]=(o*i-s*a)*p,e[3]=d*p,e[4]=(c*n-s*l)*p,e[5]=(-o*n+s*r)*p,e[6]=f*p,e[7]=(-u*n+i*l)*p,e[8]=(a*n-i*r)*p)}(this,e),this}getNormalMatrix(e){return function(e,t){let n=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],y=t[14],m=t[15],x=n*o-i*a,v=n*l-s*a,b=n*u-r*a,w=i*l-s*o,S=i*u-r*o,M=s*u-r*l,A=c*g-h*p,_=c*y-d*p,k=c*m-f*p,C=h*y-d*g,P=h*m-f*g,B=d*m-f*y,I=x*B-v*P+b*C+w*k-S*_+M*A;I&&(I=1/I,e[0]=(o*B-l*P+u*C)*I,e[1]=(l*k-a*B-u*_)*I,e[2]=(a*P-o*k+u*A)*I,e[3]=(s*P-i*B-r*C)*I,e[4]=(n*B-s*k+r*_)*I,e[5]=(i*k-n*P-r*A)*I,e[6]=(g*M-y*S+m*w)*I,e[7]=(y*b-p*M-m*v)*I,e[8]=(p*S-g*b+m*x)*I)}(this,e),this}}let be=0;class we extends fe{constructor(e,{geometry:t,program:n,mode:i=e.TRIANGLES,frustumCulled:s=!0,renderOrder:r=0}={}){super(),e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=be++,this.geometry=t,this.program=n,this.mode=i,this.frustumCulled=s,this.renderOrder=r,this.modelViewMatrix=new ce,this.normalMatrix=new ve,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(t=>t&&t({mesh:this,camera:e}));let t=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:t}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(t=>t&&t({mesh:this,camera:e}))}}class Se extends j{constructor(e,{width:t=1,height:n=1,widthSegments:i=1,heightSegments:s=1,attributes:r={}}={}){const a=i,o=s,l=(a+1)*(o+1),u=a*o*6,c=new Float32Array(3*l),h=new Float32Array(3*l),d=new Float32Array(2*l),f=u>65536?new Uint32Array(u):new Uint16Array(u);Se.buildPlane(c,h,d,f,t,n,0,a,o),Object.assign(r,{position:{size:3,data:c},normal:{size:3,data:h},uv:{size:2,data:d},index:{data:f}}),super(e,r)}static buildPlane(e,t,n,i,s,r,a,o,l,u=0,c=1,h=2,d=1,f=-1,p=0,g=0){const y=p,m=s/o,x=r/l;for(let v=0;v<=l;v++){let b=v*x-r/2;for(let r=0;r<=o;r++,p++){let x=r*m-s/2;if(e[3*p+u]=x*d,e[3*p+c]=b*f,e[3*p+h]=a/2,t[3*p+u]=0,t[3*p+c]=0,t[3*p+h]=a>=0?1:-1,n[2*p]=r/o,n[2*p+1]=1-v/l,v===l||r===o)continue;let w=y+r+v*(o+1),S=y+r+(v+1)*(o+1),M=y+r+(v+1)*(o+1)+1,A=y+r+v*(o+1)+1;i[6*g]=w,i[6*g+1]=S,i[6*g+2]=A,i[6*g+3]=S,i[6*g+4]=M,i[6*g+5]=A,g++}}}}class Me extends j{constructor(e,{width:t=1,height:n=1,depth:i=1,widthSegments:s=1,heightSegments:r=1,depthSegments:a=1,attributes:o={}}={}){const l=s,u=r,c=a,h=(l+1)*(u+1)*2+(l+1)*(c+1)*2+(u+1)*(c+1)*2,d=6*(l*u*2+l*c*2+u*c*2),f=new Float32Array(3*h),p=new Float32Array(3*h),g=new Float32Array(2*h),y=h>65536?new Uint32Array(d):new Uint16Array(d);let m=0,x=0;Se.buildPlane(f,p,g,y,i,n,t,c,u,2,1,0,-1,-1,m,x),m+=(c+1)*(u+1),x+=c*u,Se.buildPlane(f,p,g,y,i,n,-t,c,u,2,1,0,1,-1,m,x),m+=(c+1)*(u+1),x+=c*u,Se.buildPlane(f,p,g,y,t,i,n,c,l,0,2,1,1,1,m,x),m+=(l+1)*(c+1),x+=l*c,Se.buildPlane(f,p,g,y,t,i,-n,c,l,0,2,1,1,-1,m,x),m+=(l+1)*(c+1),x+=l*c,Se.buildPlane(f,p,g,y,t,n,-i,l,u,0,1,2,-1,-1,m,x),m+=(l+1)*(u+1),x+=l*u,Se.buildPlane(f,p,g,y,t,n,i,l,u,0,1,2,1,-1,m,x),Object.assign(o,{position:{size:3,data:f},normal:{size:3,data:p},uv:{size:2,data:g},index:{data:y}}),super(e,o)}}var Ae,_e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ke={exports:{}};var Ce,Pe=Ae?ke.exports:(Ae=1,Ce=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=20)}([function(e,t){var n={};e.exports=n,function(){n._baseDelta=1e3/60,n._nextId=0,n._seed=0,n._nowStartTime=+new Date,n._warnedOnce={},n._decomp=null,n.extend=function(e,t){var i,s;"boolean"==typeof t?(i=2,s=t):(i=1,s=!0);for(var r=i;r<arguments.length;r++){var a=arguments[r];if(a)for(var o in a)s&&a[o]&&a[o].constructor===Object?e[o]&&e[o].constructor!==Object?e[o]=a[o]:(e[o]=e[o]||{},n.extend(e[o],s,a[o])):e[o]=a[o]}return e},n.clone=function(e,t){return n.extend({},t,e)},n.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},n.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),i=0;i<n.length;i++)t.push(e[n[i]]);return t}for(var s in e)t.push(e[s]);return t},n.get=function(e,t,n,i){t=t.split(".").slice(n,i);for(var s=0;s<t.length;s+=1)e=e[t[s]];return e},n.set=function(e,t,i,s,r){var a=t.split(".").slice(s,r);return n.get(e,t,0,-1)[a[a.length-1]]=i,i},n.shuffle=function(e){for(var t=e.length-1;t>0;t--){var i=Math.floor(n.random()*(t+1)),s=e[t];e[t]=e[i],e[i]=s}return e},n.choose=function(e){return e[Math.floor(n.random()*e.length)]},n.isElement=function(e){return"undefined"!=typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.isFunction=function(e){return"function"==typeof e},n.isPlainObject=function(e){return"object"==typeof e&&e.constructor===Object},n.isString=function(e){return"[object String]"===toString.call(e)},n.clamp=function(e,t,n){return e<t?t:e>n?n:e},n.sign=function(e){return e<0?-1:1},n.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-n._nowStartTime},n.random=function(t,n){return n=void 0!==n?n:1,(t=void 0!==t?t:0)+e()*(n-t)};var e=function(){return n._seed=(9301*n._seed+49297)%233280,n._seed/233280};n.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},n.logLevel=1,n.log=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.info=function(){console&&n.logLevel>0&&n.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warn=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warnOnce=function(){var e=Array.prototype.slice.call(arguments).join(" ");n._warnedOnce[e]||(n.warn(e),n._warnedOnce[e]=!0)},n.deprecated=function(e,t,i){e[t]=n.chain(function(){n.warnOnce(" deprecated ",i)},e[t])},n.nextId=function(){return n._nextId++},n.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},n.map=function(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n},n.topologicalSort=function(e){var t=[],i=[],s=[];for(var r in e)i[r]||s[r]||n._topologicalSort(r,i,s,e,t);return t},n._topologicalSort=function(e,t,i,s,r){var a=s[e]||[];i[e]=!0;for(var o=0;o<a.length;o+=1){var l=a[o];i[l]||t[l]||n._topologicalSort(l,t,i,s,r)}i[e]=!1,t[e]=!0,r.push(e)},n.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var n=arguments[t];n._chained?e.push.apply(e,n._chained):e.push(n)}var i=function(){for(var t,n=new Array(arguments.length),i=0,s=arguments.length;i<s;i++)n[i]=arguments[i];for(i=0;i<e.length;i+=1){var r=e[i].apply(t,n);void 0!==r&&(t=r)}return t};return i._chained=e,i},n.chainPathBefore=function(e,t,i){return n.set(e,t,n.chain(i,n.get(e,t)))},n.chainPathAfter=function(e,t,i){return n.set(e,t,n.chain(n.get(e,t),i))},n.setDecomp=function(e){n._decomp=e},n.getDecomp=function(){var e=n._decomp;try{e||"undefined"==typeof window||(e=window.decomp),e||void 0===_e||(e=_e.decomp)}catch(t){e=null}return e}}()},function(e,t){var n={};e.exports=n,n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&n.update(t,e),t},n.update=function(e,t,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var i=0;i<t.length;i++){var s=t[i];s.x>e.max.x&&(e.max.x=s.x),s.x<e.min.x&&(e.min.x=s.x),s.y>e.max.y&&(e.max.y=s.y),s.y<e.min.y&&(e.min.y=s.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},n.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},n.shift=function(e,t){var n=e.max.x-e.min.x,i=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+i}},function(e,t){var n={};e.exports=n,n.create=function(e,t){return{x:e||0,y:t||0}},n.clone=function(e){return{x:e.x,y:e.y}},n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},n.rotate=function(e,t,n){var i=Math.cos(t),s=Math.sin(t);n||(n={});var r=e.x*i-e.y*s;return n.y=e.x*s+e.y*i,n.x=r,n},n.rotateAbout=function(e,t,n,i){var s=Math.cos(t),r=Math.sin(t);i||(i={});var a=n.x+((e.x-n.x)*s-(e.y-n.y)*r);return i.y=n.y+((e.x-n.x)*r+(e.y-n.y)*s),i.x=a,i},n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.cross=function(e,t){return e.x*t.y-e.y*t.x},n.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},n.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},n.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},n.mult=function(e,t){return{x:e.x*t,y:e.y*t}},n.div=function(e,t){return{x:e.x/t,y:e.y/t}},n.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},n.neg=function(e){return{x:-e.x,y:-e.y}},n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]},function(e,t,n){var i={};e.exports=i;var s=n(2),r=n(0);i.create=function(e,t){for(var n=[],i=0;i<e.length;i++){var s=e[i],r={x:s.x,y:s.y,index:i,body:t,isInternal:!1};n.push(r)}return n},i.fromPath=function(e,t){var n=[];return e.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,function(e,t,i){n.push({x:parseFloat(t),y:parseFloat(i)})}),i.create(n,t)},i.centre=function(e){for(var t,n,r,a=i.area(e,!0),o={x:0,y:0},l=0;l<e.length;l++)r=(l+1)%e.length,t=s.cross(e[l],e[r]),n=s.mult(s.add(e[l],e[r]),t),o=s.add(o,n);return s.div(o,6*a)},i.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return s.div(t,e.length)},i.area=function(e,t){for(var n=0,i=e.length-1,s=0;s<e.length;s++)n+=(e[i].x-e[s].x)*(e[i].y+e[s].y),i=s;return t?n/2:Math.abs(n)/2},i.inertia=function(e,t){for(var n,i,r=0,a=0,o=e,l=0;l<o.length;l++)i=(l+1)%o.length,r+=(n=Math.abs(s.cross(o[i],o[l])))*(s.dot(o[i],o[i])+s.dot(o[i],o[l])+s.dot(o[l],o[l])),a+=n;return t/6*(r/a)},i.translate=function(e,t,n){n=void 0!==n?n:1;var i,s=e.length,r=t.x*n,a=t.y*n;for(i=0;i<s;i++)e[i].x+=r,e[i].y+=a;return e},i.rotate=function(e,t,n){if(0!==t){var i,s,r,a,o=Math.cos(t),l=Math.sin(t),u=n.x,c=n.y,h=e.length;for(a=0;a<h;a++)s=(i=e[a]).x-u,r=i.y-c,i.x=u+(s*o-r*l),i.y=c+(s*l+r*o);return e}},i.contains=function(e,t){for(var n,i=t.x,s=t.y,r=e.length,a=e[r-1],o=0;o<r;o++){if(n=e[o],(i-a.x)*(n.y-a.y)+(s-a.y)*(a.x-n.x)>0)return!1;a=n}return!0},i.scale=function(e,t,n,r){if(1===t&&1===n)return e;var a,o;r=r||i.centre(e);for(var l=0;l<e.length;l++)a=e[l],o=s.sub(a,r),e[l].x=r.x+o.x*t,e[l].y=r.y+o.y*n;return e},i.chamfer=function(e,t,n,i,a){t="number"==typeof t?[t]:t||[8],n=void 0!==n?n:-1,i=i||2,a=a||14;for(var o=[],l=0;l<e.length;l++){var u=e[l-1>=0?l-1:e.length-1],c=e[l],h=e[(l+1)%e.length],d=t[l<t.length?l:t.length-1];if(0!==d){var f=s.normalise({x:c.y-u.y,y:u.x-c.x}),p=s.normalise({x:h.y-c.y,y:c.x-h.x}),g=Math.sqrt(2*Math.pow(d,2)),y=s.mult(r.clone(f),d),m=s.normalise(s.mult(s.add(f,p),.5)),x=s.sub(c,s.mult(m,g)),v=n;-1===n&&(v=1.75*Math.pow(d,.32)),(v=r.clamp(v,i,a))%2==1&&(v+=1);for(var b=Math.acos(s.dot(f,p))/v,w=0;w<v;w++)o.push(s.add(s.rotate(y,b*w),x))}else o.push(c)}return o},i.clockwiseSort=function(e){var t=i.mean(e);return e.sort(function(e,n){return s.angle(t,e)-s.angle(t,n)}),e},i.isConvex=function(e){var t,n,i,s,r=0,a=e.length;if(a<3)return null;for(t=0;t<a;t++)if(i=(t+2)%a,s=(e[n=(t+1)%a].x-e[t].x)*(e[i].y-e[n].y),(s-=(e[n].y-e[t].y)*(e[i].x-e[n].x))<0?r|=1:s>0&&(r|=2),3===r)return!1;return 0!==r||null},i.hull=function(e){var t,n,i=[],r=[];for((e=e.slice(0)).sort(function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y}),n=0;n<e.length;n+=1){for(t=e[n];r.length>=2&&s.cross3(r[r.length-2],r[r.length-1],t)<=0;)r.pop();r.push(t)}for(n=e.length-1;n>=0;n-=1){for(t=e[n];i.length>=2&&s.cross3(i[i.length-2],i[i.length-1],t)<=0;)i.pop();i.push(t)}return i.pop(),r.pop(),i.concat(r)}},function(e,t,n){var i={};e.exports=i;var s=n(3),r=n(2),a=n(7),o=n(0),l=n(1),u=n(11);!function(){i._timeCorrection=!0,i._inertiaScale=4,i._nextCollidingGroupId=1,i._nextNonCollidingGroupId=-1,i._nextCategory=1,i._baseDelta=1e3/60,i.create=function(t){var n={id:o.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:s.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:1e3/60,_original:null},i=o.extend(n,t);return e(i,t),i},i.nextGroup=function(e){return e?i._nextNonCollidingGroupId--:i._nextCollidingGroupId++},i.nextCategory=function(){return i._nextCategory=i._nextCategory<<1,i._nextCategory};var e=function(e,t){t=t||{},i.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||r.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),s.rotate(e.vertices,e.angle,e.position),u.rotate(e.axes,e.angle),l.update(e.bounds,e.vertices,e.velocity),i.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var n=e.isStatic?"#14151f":o.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),a=e.isStatic?"#555":"#ccc",c=e.isStatic&&null===e.render.fillStyle?1:0;e.render.fillStyle=e.render.fillStyle||n,e.render.strokeStyle=e.render.strokeStyle||a,e.render.lineWidth=e.render.lineWidth||c,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};i.set=function(e,t,n){var s;for(s in"string"==typeof t&&(s=t,(t={})[s]=n),t)if(Object.prototype.hasOwnProperty.call(t,s))switch(n=t[s],s){case"isStatic":i.setStatic(e,n);break;case"isSleeping":a.set(e,n);break;case"mass":i.setMass(e,n);break;case"density":i.setDensity(e,n);break;case"inertia":i.setInertia(e,n);break;case"vertices":i.setVertices(e,n);break;case"position":i.setPosition(e,n);break;case"angle":i.setAngle(e,n);break;case"velocity":i.setVelocity(e,n);break;case"angularVelocity":i.setAngularVelocity(e,n);break;case"speed":i.setSpeed(e,n);break;case"angularSpeed":i.setAngularSpeed(e,n);break;case"parts":i.setParts(e,n);break;case"centre":i.setCentre(e,n);break;default:e[s]=n}},i.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var i=e.parts[n];t?(i.isStatic||(i._original={restitution:i.restitution,friction:i.friction,mass:i.mass,inertia:i.inertia,density:i.density,inverseMass:i.inverseMass,inverseInertia:i.inverseInertia}),i.restitution=0,i.friction=1,i.mass=i.inertia=i.density=1/0,i.inverseMass=i.inverseInertia=0,i.positionPrev.x=i.position.x,i.positionPrev.y=i.position.y,i.anglePrev=i.angle,i.angularVelocity=0,i.speed=0,i.angularSpeed=0,i.motion=0):i._original&&(i.restitution=i._original.restitution,i.friction=i._original.friction,i.mass=i._original.mass,i.inertia=i._original.inertia,i.density=i._original.density,i.inverseMass=i._original.inverseMass,i.inverseInertia=i._original.inverseInertia,i._original=null),i.isStatic=t}},i.setMass=function(e,t){var n=e.inertia/(e.mass/6);e.inertia=n*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},i.setDensity=function(e,t){i.setMass(e,t*e.area),e.density=t},i.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},i.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=s.create(t,e),e.axes=u.fromVertices(e.vertices),e.area=s.area(e.vertices),i.setMass(e,e.density*e.area);var n=s.centre(e.vertices);s.translate(e.vertices,n,-1),i.setInertia(e,i._inertiaScale*s.inertia(e.vertices,e.mass)),s.translate(e.vertices,e.position),l.update(e.bounds,e.vertices,e.velocity)},i.setParts=function(e,t,n){var r;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,r=0;r<t.length;r++){var a=t[r];a!==e&&(a.parent=e,e.parts.push(a))}if(1!==e.parts.length){if(n=void 0===n||n){var o=[];for(r=0;r<t.length;r++)o=o.concat(t[r].vertices);s.clockwiseSort(o);var l=s.hull(o),u=s.centre(l);i.setVertices(e,l),s.translate(e.vertices,u)}var c=i._totalProperties(e);e.area=c.area,e.parent=e,e.position.x=c.centre.x,e.position.y=c.centre.y,e.positionPrev.x=c.centre.x,e.positionPrev.y=c.centre.y,i.setMass(e,c.mass),i.setInertia(e,c.inertia),i.setPosition(e,c.centre)}},i.setCentre=function(e,t,n){n?(e.positionPrev.x+=t.x,e.positionPrev.y+=t.y,e.position.x+=t.x,e.position.y+=t.y):(e.positionPrev.x=t.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=t.y-(e.position.y-e.positionPrev.y),e.position.x=t.x,e.position.y=t.y)},i.setPosition=function(e,t,n){var i=r.sub(t,e.position);n?(e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.velocity.x=i.x,e.velocity.y=i.y,e.speed=r.magnitude(i)):(e.positionPrev.x+=i.x,e.positionPrev.y+=i.y);for(var a=0;a<e.parts.length;a++){var o=e.parts[a];o.position.x+=i.x,o.position.y+=i.y,s.translate(o.vertices,i),l.update(o.bounds,o.vertices,e.velocity)}},i.setAngle=function(e,t,n){var i=t-e.angle;n?(e.anglePrev=e.angle,e.angularVelocity=i,e.angularSpeed=Math.abs(i)):e.anglePrev+=i;for(var a=0;a<e.parts.length;a++){var o=e.parts[a];o.angle+=i,s.rotate(o.vertices,i,e.position),u.rotate(o.axes,i),l.update(o.bounds,o.vertices,e.velocity),a>0&&r.rotateAbout(o.position,i,e.position,o.position)}},i.setVelocity=function(e,t){var n=e.deltaTime/i._baseDelta;e.positionPrev.x=e.position.x-t.x*n,e.positionPrev.y=e.position.y-t.y*n,e.velocity.x=(e.position.x-e.positionPrev.x)/n,e.velocity.y=(e.position.y-e.positionPrev.y)/n,e.speed=r.magnitude(e.velocity)},i.getVelocity=function(e){var t=i._baseDelta/e.deltaTime;return{x:(e.position.x-e.positionPrev.x)*t,y:(e.position.y-e.positionPrev.y)*t}},i.getSpeed=function(e){return r.magnitude(i.getVelocity(e))},i.setSpeed=function(e,t){i.setVelocity(e,r.mult(r.normalise(i.getVelocity(e)),t))},i.setAngularVelocity=function(e,t){var n=e.deltaTime/i._baseDelta;e.anglePrev=e.angle-t*n,e.angularVelocity=(e.angle-e.anglePrev)/n,e.angularSpeed=Math.abs(e.angularVelocity)},i.getAngularVelocity=function(e){return(e.angle-e.anglePrev)*i._baseDelta/e.deltaTime},i.getAngularSpeed=function(e){return Math.abs(i.getAngularVelocity(e))},i.setAngularSpeed=function(e,t){i.setAngularVelocity(e,o.sign(i.getAngularVelocity(e))*t)},i.translate=function(e,t,n){i.setPosition(e,r.add(e.position,t),n)},i.rotate=function(e,t,n,s){if(n){var r=Math.cos(t),a=Math.sin(t),o=e.position.x-n.x,l=e.position.y-n.y;i.setPosition(e,{x:n.x+(o*r-l*a),y:n.y+(o*a+l*r)},s),i.setAngle(e,e.angle+t,s)}else i.setAngle(e,e.angle+t,s)},i.scale=function(e,t,n,r){var a=0,o=0;r=r||e.position;for(var c=0;c<e.parts.length;c++){var h=e.parts[c];s.scale(h.vertices,t,n,r),h.axes=u.fromVertices(h.vertices),h.area=s.area(h.vertices),i.setMass(h,e.density*h.area),s.translate(h.vertices,{x:-h.position.x,y:-h.position.y}),i.setInertia(h,i._inertiaScale*s.inertia(h.vertices,h.mass)),s.translate(h.vertices,{x:h.position.x,y:h.position.y}),c>0&&(a+=h.area,o+=h.inertia),h.position.x=r.x+(h.position.x-r.x)*t,h.position.y=r.y+(h.position.y-r.y)*n,l.update(h.bounds,h.vertices,e.velocity)}e.parts.length>1&&(e.area=a,e.isStatic||(i.setMass(e,e.density*a),i.setInertia(e,o))),e.circleRadius&&(t===n?e.circleRadius*=t:e.circleRadius=null)},i.update=function(e,t){var n=(t=(void 0!==t?t:1e3/60)*e.timeScale)*t,a=i._timeCorrection?t/(e.deltaTime||t):1,c=1-e.frictionAir*(t/o._baseDelta),h=(e.position.x-e.positionPrev.x)*a,d=(e.position.y-e.positionPrev.y)*a;e.velocity.x=h*c+e.force.x/e.mass*n,e.velocity.y=d*c+e.force.y/e.mass*n,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.deltaTime=t,e.angularVelocity=(e.angle-e.anglePrev)*c*a+e.torque/e.inertia*n,e.anglePrev=e.angle,e.angle+=e.angularVelocity;for(var f=0;f<e.parts.length;f++){var p=e.parts[f];s.translate(p.vertices,e.velocity),f>0&&(p.position.x+=e.velocity.x,p.position.y+=e.velocity.y),0!==e.angularVelocity&&(s.rotate(p.vertices,e.angularVelocity,e.position),u.rotate(p.axes,e.angularVelocity),f>0&&r.rotateAbout(p.position,e.angularVelocity,e.position,p.position)),l.update(p.bounds,p.vertices,e.velocity)}},i.updateVelocities=function(e){var t=i._baseDelta/e.deltaTime,n=e.velocity;n.x=(e.position.x-e.positionPrev.x)*t,n.y=(e.position.y-e.positionPrev.y)*t,e.speed=Math.sqrt(n.x*n.x+n.y*n.y),e.angularVelocity=(e.angle-e.anglePrev)*t,e.angularSpeed=Math.abs(e.angularVelocity)},i.applyForce=function(e,t,n){var i=t.x-e.position.x,s=t.y-e.position.y;e.force.x+=n.x,e.force.y+=n.y,e.torque+=i*n.y-s*n.x},i._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var i=e.parts[n],s=i.mass!==1/0?i.mass:1;t.mass+=s,t.area+=i.area,t.inertia+=i.inertia,t.centre=r.add(t.centre,r.mult(i.position,s))}return t.centre=r.div(t.centre,t.mass),t}}()},function(e,t,n){var i={};e.exports=i;var s=n(0);i.on=function(e,t,n){for(var i,s=t.split(" "),r=0;r<s.length;r++)i=s[r],e.events=e.events||{},e.events[i]=e.events[i]||[],e.events[i].push(n);return n},i.off=function(e,t,n){if(t){"function"==typeof t&&(n=t,t=s.keys(e.events).join(" "));for(var i=t.split(" "),r=0;r<i.length;r++){var a=e.events[i[r]],o=[];if(n&&a)for(var l=0;l<a.length;l++)a[l]!==n&&o.push(a[l]);e.events[i[r]]=o}}else e.events={}},i.trigger=function(e,t,n){var i,r,a,o,l=e.events;if(l&&s.keys(l).length>0){n||(n={}),i=t.split(" ");for(var u=0;u<i.length;u++)if(a=l[r=i[u]]){(o=s.clone(n,!1)).name=r,o.source=e;for(var c=0;c<a.length;c++)a[c].apply(e,[o])}}}},function(e,t,n){var i={};e.exports=i;var s=n(5),r=n(0),a=n(1),o=n(4);i.create=function(e){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},e)},i.setModified=function(e,t,n,s){if(e.isModified=t,t&&e.cache&&(e.cache.allBodies=null,e.cache.allConstraints=null,e.cache.allComposites=null),n&&e.parent&&i.setModified(e.parent,t,n,s),s)for(var r=0;r<e.composites.length;r++){var a=e.composites[r];i.setModified(a,t,n,s)}},i.add=function(e,t){var n=[].concat(t);s.trigger(e,"beforeAdd",{object:t});for(var a=0;a<n.length;a++){var o=n[a];switch(o.type){case"body":if(o.parent!==o){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}i.addBody(e,o);break;case"constraint":i.addConstraint(e,o);break;case"composite":i.addComposite(e,o);break;case"mouseConstraint":i.addConstraint(e,o.constraint)}}return s.trigger(e,"afterAdd",{object:t}),e},i.remove=function(e,t,n){var r=[].concat(t);s.trigger(e,"beforeRemove",{object:t});for(var a=0;a<r.length;a++){var o=r[a];switch(o.type){case"body":i.removeBody(e,o,n);break;case"constraint":i.removeConstraint(e,o,n);break;case"composite":i.removeComposite(e,o,n);break;case"mouseConstraint":i.removeConstraint(e,o.constraint)}}return s.trigger(e,"afterRemove",{object:t}),e},i.addComposite=function(e,t){return e.composites.push(t),t.parent=e,i.setModified(e,!0,!0,!1),e},i.removeComposite=function(e,t,n){var s=r.indexOf(e.composites,t);if(-1!==s){var a=i.allBodies(t);i.removeCompositeAt(e,s);for(var o=0;o<a.length;o++)a[o].sleepCounter=0}if(n)for(o=0;o<e.composites.length;o++)i.removeComposite(e.composites[o],t,!0);return e},i.removeCompositeAt=function(e,t){return e.composites.splice(t,1),i.setModified(e,!0,!0,!1),e},i.addBody=function(e,t){return e.bodies.push(t),i.setModified(e,!0,!0,!1),e},i.removeBody=function(e,t,n){var s=r.indexOf(e.bodies,t);if(-1!==s&&(i.removeBodyAt(e,s),t.sleepCounter=0),n)for(var a=0;a<e.composites.length;a++)i.removeBody(e.composites[a],t,!0);return e},i.removeBodyAt=function(e,t){return e.bodies.splice(t,1),i.setModified(e,!0,!0,!1),e},i.addConstraint=function(e,t){return e.constraints.push(t),i.setModified(e,!0,!0,!1),e},i.removeConstraint=function(e,t,n){var s=r.indexOf(e.constraints,t);if(-1!==s&&i.removeConstraintAt(e,s),n)for(var a=0;a<e.composites.length;a++)i.removeConstraint(e.composites[a],t,!0);return e},i.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),i.setModified(e,!0,!0,!1),e},i.clear=function(e,t,n){if(n)for(var s=0;s<e.composites.length;s++)i.clear(e.composites[s],t,!0);return t?e.bodies=e.bodies.filter(function(e){return e.isStatic}):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,i.setModified(e,!0,!0,!1),e},i.allBodies=function(e){if(e.cache&&e.cache.allBodies)return e.cache.allBodies;for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(i.allBodies(e.composites[n]));return e.cache&&(e.cache.allBodies=t),t},i.allConstraints=function(e){if(e.cache&&e.cache.allConstraints)return e.cache.allConstraints;for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(i.allConstraints(e.composites[n]));return e.cache&&(e.cache.allConstraints=t),t},i.allComposites=function(e){if(e.cache&&e.cache.allComposites)return e.cache.allComposites;for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(i.allComposites(e.composites[n]));return e.cache&&(e.cache.allComposites=t),t},i.get=function(e,t,n){var s,r;switch(n){case"body":s=i.allBodies(e);break;case"constraint":s=i.allConstraints(e);break;case"composite":s=i.allComposites(e).concat(e)}return s?0===(r=s.filter(function(e){return e.id.toString()===t.toString()})).length?null:r[0]:null},i.move=function(e,t,n){return i.remove(e,t),i.add(n,t),e},i.rebase=function(e){for(var t=i.allBodies(e).concat(i.allConstraints(e)).concat(i.allComposites(e)),n=0;n<t.length;n++)t[n].id=r.nextId();return e},i.translate=function(e,t,n){for(var s=n?i.allBodies(e):e.bodies,r=0;r<s.length;r++)o.translate(s[r],t);return e},i.rotate=function(e,t,n,s){for(var r=Math.cos(t),a=Math.sin(t),l=s?i.allBodies(e):e.bodies,u=0;u<l.length;u++){var c=l[u],h=c.position.x-n.x,d=c.position.y-n.y;o.setPosition(c,{x:n.x+(h*r-d*a),y:n.y+(h*a+d*r)}),o.rotate(c,t)}return e},i.scale=function(e,t,n,s,r){for(var a=r?i.allBodies(e):e.bodies,l=0;l<a.length;l++){var u=a[l],c=u.position.x-s.x,h=u.position.y-s.y;o.setPosition(u,{x:s.x+c*t,y:s.y+h*n}),o.scale(u,t,n)}return e},i.bounds=function(e){for(var t=i.allBodies(e),n=[],s=0;s<t.length;s+=1){var r=t[s];n.push(r.bounds.min,r.bounds.max)}return a.create(n)}},function(e,t,n){var i={};e.exports=i;var s=n(4),r=n(5),a=n(0);i._motionWakeThreshold=.18,i._motionSleepThreshold=.08,i._minBias=.9,i.update=function(e,t){for(var n=t/a._baseDelta,r=i._motionSleepThreshold,o=0;o<e.length;o++){var l=e[o],u=s.getSpeed(l),c=s.getAngularSpeed(l),h=u*u+c*c;if(0===l.force.x&&0===l.force.y){var d=Math.min(l.motion,h),f=Math.max(l.motion,h);l.motion=i._minBias*d+(1-i._minBias)*f,l.sleepThreshold>0&&l.motion<r?(l.sleepCounter+=1,l.sleepCounter>=l.sleepThreshold/n&&i.set(l,!0)):l.sleepCounter>0&&(l.sleepCounter-=1)}else i.set(l,!1)}},i.afterCollisions=function(e){for(var t=i._motionSleepThreshold,n=0;n<e.length;n++){var s=e[n];if(s.isActive){var r=s.collision,a=r.bodyA.parent,o=r.bodyB.parent;if(!(a.isSleeping&&o.isSleeping||a.isStatic||o.isStatic)&&(a.isSleeping||o.isSleeping)){var l=a.isSleeping&&!a.isStatic?a:o,u=l===a?o:a;!l.isStatic&&u.motion>t&&i.set(l,!1)}}}},i.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||r.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&r.trigger(e,"sleepEnd"))}},function(e,t,n){var i={};e.exports=i;var s,r,a,o=n(3),l=n(9);s=[],r={overlap:0,axis:null},a={overlap:0,axis:null},i.create=function(e,t){return{pair:null,collided:!1,bodyA:e,bodyB:t,parentA:e.parent,parentB:t.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},i.collides=function(e,t,n){if(i._overlapAxes(r,e.vertices,t.vertices,e.axes),r.overlap<=0)return null;if(i._overlapAxes(a,t.vertices,e.vertices,t.axes),a.overlap<=0)return null;var s,u,c=n&&n.table[l.id(e,t)];c?s=c.collision:((s=i.create(e,t)).collided=!0,s.bodyA=e.id<t.id?e:t,s.bodyB=e.id<t.id?t:e,s.parentA=s.bodyA.parent,s.parentB=s.bodyB.parent),e=s.bodyA,t=s.bodyB,u=r.overlap<a.overlap?r:a;var h=s.normal,d=s.tangent,f=s.penetration,p=s.supports,g=u.overlap,y=u.axis,m=y.x,x=y.y;m*(t.position.x-e.position.x)+x*(t.position.y-e.position.y)>=0&&(m=-m,x=-x),h.x=m,h.y=x,d.x=-x,d.y=m,f.x=m*g,f.y=x*g,s.depth=g;var v=i._findSupports(e,t,h,1),b=0;if(o.contains(e.vertices,v[0])&&(p[b++]=v[0]),o.contains(e.vertices,v[1])&&(p[b++]=v[1]),b<2){var w=i._findSupports(t,e,h,-1);o.contains(t.vertices,w[0])&&(p[b++]=w[0]),b<2&&o.contains(t.vertices,w[1])&&(p[b++]=w[1])}return 0===b&&(p[b++]=v[0]),s.supportCount=b,s},i._overlapAxes=function(e,t,n,i){var s,r,a,o,l,u,c=t.length,h=n.length,d=t[0].x,f=t[0].y,p=n[0].x,g=n[0].y,y=i.length,m=Number.MAX_VALUE,x=0;for(l=0;l<y;l++){var v=i[l],b=v.x,w=v.y,S=d*b+f*w,M=p*b+g*w,A=S,_=M;for(u=1;u<c;u+=1)(o=t[u].x*b+t[u].y*w)>A?A=o:o<S&&(S=o);for(u=1;u<h;u+=1)(o=n[u].x*b+n[u].y*w)>_?_=o:o<M&&(M=o);if((s=(r=A-M)<(a=_-S)?r:a)<m&&(m=s,x=l,s<=0))break}e.axis=i[x],e.overlap=m},i._findSupports=function(e,t,n,i){var r,a,o,l=t.vertices,u=l.length,c=e.position.x,h=e.position.y,d=n.x*i,f=n.y*i,p=l[0],g=p,y=d*(c-g.x)+f*(h-g.y);for(o=1;o<u;o+=1)(a=d*(c-(g=l[o]).x)+f*(h-g.y))<y&&(y=a,p=g);return y=d*(c-(r=l[(u+p.index-1)%u]).x)+f*(h-r.y),d*(c-(g=l[(p.index+1)%u]).x)+f*(h-g.y)<y?(s[0]=p,s[1]=g,s):(s[0]=p,s[1]=r,s)}},function(e,t,n){var i={};e.exports=i;var s=n(16);i.create=function(e,t){var n=e.bodyA,r=e.bodyB,a={id:i.id(n,r),bodyA:n,bodyB:r,collision:e,contacts:[s.create(),s.create()],contactCount:0,separation:0,isActive:!0,isSensor:n.isSensor||r.isSensor,timeCreated:t,timeUpdated:t,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return i.update(a,e,t),a},i.update=function(e,t,n){var i=t.supports,s=t.supportCount,r=e.contacts,a=t.parentA,o=t.parentB;e.isActive=!0,e.timeUpdated=n,e.collision=t,e.separation=t.depth,e.inverseMass=a.inverseMass+o.inverseMass,e.friction=a.friction<o.friction?a.friction:o.friction,e.frictionStatic=a.frictionStatic>o.frictionStatic?a.frictionStatic:o.frictionStatic,e.restitution=a.restitution>o.restitution?a.restitution:o.restitution,e.slop=a.slop>o.slop?a.slop:o.slop,e.contactCount=s,t.pair=e;var l=i[0],u=r[0],c=i[1],h=r[1];h.vertex!==l&&u.vertex!==c||(r[1]=u,r[0]=u=h,h=r[1]),u.vertex=l,h.vertex=c},i.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.contactCount=0)},i.id=function(e,t){return e.id<t.id?e.id.toString(36)+":"+t.id.toString(36):t.id.toString(36)+":"+e.id.toString(36)}},function(e,t,n){var i={};e.exports=i;var s=n(3),r=n(2),a=n(7),o=n(1),l=n(11),u=n(0);i._warming=.4,i._torqueDampen=1,i._minLength=1e-6,i.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?r.add(t.bodyA.position,t.pointA):t.pointA,i=t.bodyB?r.add(t.bodyB.position,t.pointB):t.pointB,s=r.magnitude(r.sub(n,i));t.length=void 0!==t.length?t.length:s,t.id=t.id||u.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var a={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(a.type="pin",a.anchors=!1):t.stiffness<.9&&(a.type="spring"),t.render=u.extend(a,t.render),t},i.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var n=e[t],i=n.constraintImpulse;n.isStatic||0===i.x&&0===i.y&&0===i.angle||(n.position.x+=i.x,n.position.y+=i.y,n.angle+=i.angle)}},i.solveAll=function(e,t){for(var n=u.clamp(t/u._baseDelta,0,1),s=0;s<e.length;s+=1){var r=e[s],a=!r.bodyA||r.bodyA&&r.bodyA.isStatic,o=!r.bodyB||r.bodyB&&r.bodyB.isStatic;(a||o)&&i.solve(e[s],n)}for(s=0;s<e.length;s+=1)a=!(r=e[s]).bodyA||r.bodyA&&r.bodyA.isStatic,o=!r.bodyB||r.bodyB&&r.bodyB.isStatic,a||o||i.solve(e[s],n)},i.solve=function(e,t){var n=e.bodyA,s=e.bodyB,a=e.pointA,o=e.pointB;if(n||s){n&&!n.isStatic&&(r.rotate(a,n.angle-e.angleA,a),e.angleA=n.angle),s&&!s.isStatic&&(r.rotate(o,s.angle-e.angleB,o),e.angleB=s.angle);var l=a,u=o;if(n&&(l=r.add(n.position,a)),s&&(u=r.add(s.position,o)),l&&u){var c=r.sub(l,u),h=r.magnitude(c);h<i._minLength&&(h=i._minLength);var d,f,p,g,y,m=(h-e.length)/h,x=e.stiffness>=1||0===e.length?e.stiffness*t:e.stiffness*t*t,v=e.damping*t,b=r.mult(c,m*x),w=(n?n.inverseMass:0)+(s?s.inverseMass:0),S=w+((n?n.inverseInertia:0)+(s?s.inverseInertia:0));if(v>0){var M=r.create();p=r.div(c,h),y=r.sub(s&&r.sub(s.position,s.positionPrev)||M,n&&r.sub(n.position,n.positionPrev)||M),g=r.dot(p,y)}n&&!n.isStatic&&(f=n.inverseMass/w,n.constraintImpulse.x-=b.x*f,n.constraintImpulse.y-=b.y*f,n.position.x-=b.x*f,n.position.y-=b.y*f,v>0&&(n.positionPrev.x-=v*p.x*g*f,n.positionPrev.y-=v*p.y*g*f),d=r.cross(a,b)/S*i._torqueDampen*n.inverseInertia*(1-e.angularStiffness),n.constraintImpulse.angle-=d,n.angle-=d),s&&!s.isStatic&&(f=s.inverseMass/w,s.constraintImpulse.x+=b.x*f,s.constraintImpulse.y+=b.y*f,s.position.x+=b.x*f,s.position.y+=b.y*f,v>0&&(s.positionPrev.x+=v*p.x*g*f,s.positionPrev.y+=v*p.y*g*f),d=r.cross(o,b)/S*i._torqueDampen*s.inverseInertia*(1-e.angularStiffness),s.constraintImpulse.angle+=d,s.angle+=d)}}},i.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],u=n.constraintImpulse;if(!(n.isStatic||0===u.x&&0===u.y&&0===u.angle)){a.set(n,!1);for(var c=0;c<n.parts.length;c++){var h=n.parts[c];s.translate(h.vertices,u),c>0&&(h.position.x+=u.x,h.position.y+=u.y),0!==u.angle&&(s.rotate(h.vertices,u.angle,n.position),l.rotate(h.axes,u.angle),c>0&&r.rotateAbout(h.position,u.angle,n.position,h.position)),o.update(h.bounds,h.vertices,n.velocity)}u.angle*=i._warming,u.x*=i._warming,u.y*=i._warming}}},i.pointAWorld=function(e){return{x:(e.bodyA?e.bodyA.position.x:0)+(e.pointA?e.pointA.x:0),y:(e.bodyA?e.bodyA.position.y:0)+(e.pointA?e.pointA.y:0)}},i.pointBWorld=function(e){return{x:(e.bodyB?e.bodyB.position.x:0)+(e.pointB?e.pointB.x:0),y:(e.bodyB?e.bodyB.position.y:0)+(e.pointB?e.pointB.y:0)}},i.currentLength=function(e){var t=(e.bodyA?e.bodyA.position.x:0)+(e.pointA?e.pointA.x:0),n=(e.bodyA?e.bodyA.position.y:0)+(e.pointA?e.pointA.y:0),i=t-((e.bodyB?e.bodyB.position.x:0)+(e.pointB?e.pointB.x:0)),s=n-((e.bodyB?e.bodyB.position.y:0)+(e.pointB?e.pointB.y:0));return Math.sqrt(i*i+s*s)}},function(e,t,n){var i={};e.exports=i;var s=n(2),r=n(0);i.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var i=(n+1)%e.length,a=s.normalise({x:e[i].y-e[n].y,y:e[n].x-e[i].x}),o=0===a.y?1/0:a.x/a.y;t[o=o.toFixed(3).toString()]=a}return r.values(t)},i.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),i=Math.sin(t),s=0;s<e.length;s++){var r,a=e[s];r=a.x*n-a.y*i,a.y=a.x*i+a.y*n,a.x=r}}},function(e,t,n){var i={};e.exports=i;var s=n(3),r=n(0),a=n(4),o=n(1),l=n(2);i.rectangle=function(e,t,n,i,o){o=o||{};var l={label:"Rectangle Body",position:{x:e,y:t},vertices:s.fromPath("L 0 0 L "+n+" 0 L "+n+" "+i+" L 0 "+i)};if(o.chamfer){var u=o.chamfer;l.vertices=s.chamfer(l.vertices,u.radius,u.quality,u.qualityMin,u.qualityMax),delete o.chamfer}return a.create(r.extend({},l,o))},i.trapezoid=function(e,t,n,i,o,l){l=l||{},o>=1&&r.warn("Bodies.trapezoid: slope parameter must be < 1.");var u,c=n*(o*=.5),h=c+(1-2*o)*n,d=h+c;u=o<.5?"L 0 0 L "+c+" "+-i+" L "+h+" "+-i+" L "+d+" 0":"L 0 0 L "+h+" "+-i+" L "+d+" 0";var f={label:"Trapezoid Body",position:{x:e,y:t},vertices:s.fromPath(u)};if(l.chamfer){var p=l.chamfer;f.vertices=s.chamfer(f.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete l.chamfer}return a.create(r.extend({},f,l))},i.circle=function(e,t,n,s,a){s=s||{};var o={label:"Circle Body",circleRadius:n};a=a||25;var l=Math.ceil(Math.max(10,Math.min(a,n)));return l%2==1&&(l+=1),i.polygon(e,t,l,n,r.extend({},o,s))},i.polygon=function(e,t,n,o,l){if(l=l||{},n<3)return i.circle(e,t,o,l);for(var u=2*Math.PI/n,c="",h=.5*u,d=0;d<n;d+=1){var f=h+d*u,p=Math.cos(f)*o,g=Math.sin(f)*o;c+="L "+p.toFixed(3)+" "+g.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:e,y:t},vertices:s.fromPath(c)};if(l.chamfer){var m=l.chamfer;y.vertices=s.chamfer(y.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete l.chamfer}return a.create(r.extend({},y,l))},i.fromVertices=function(e,t,n,i,u,c,h,d){var f,p,g,y,m,x,v,b,w,S,M=r.getDecomp();for(f=Boolean(M&&M.quickDecomp),i=i||{},g=[],u=void 0!==u&&u,c=void 0!==c?c:.01,h=void 0!==h?h:10,d=void 0!==d?d:.01,r.isArray(n[0])||(n=[n]),w=0;w<n.length;w+=1)if(m=n[w],!(y=s.isConvex(m))&&!f&&r.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),y||!f)m=y?s.clockwiseSort(m):s.hull(m),g.push({position:{x:e,y:t},vertices:m});else{var A=m.map(function(e){return[e.x,e.y]});M.makeCCW(A),!1!==c&&M.removeCollinearPoints(A,c),!1!==d&&M.removeDuplicatePoints&&M.removeDuplicatePoints(A,d);var _=M.quickDecomp(A);for(x=0;x<_.length;x++){var k=_[x].map(function(e){return{x:e[0],y:e[1]}});h>0&&s.area(k)<h||g.push({position:s.centre(k),vertices:k})}}for(x=0;x<g.length;x++)g[x]=a.create(r.extend(g[x],i));if(u)for(x=0;x<g.length;x++){var C=g[x];for(v=x+1;v<g.length;v++){var P=g[v];if(o.overlaps(C.bounds,P.bounds)){var B=C.vertices,I=P.vertices;for(b=0;b<C.vertices.length;b++)for(S=0;S<P.vertices.length;S++){var T=l.magnitudeSquared(l.sub(B[(b+1)%B.length],I[S])),E=l.magnitudeSquared(l.sub(B[b],I[(S+1)%I.length]));T<5&&E<5&&(B[b].isInternal=!0,I[S].isInternal=!0)}}}}return g.length>1?(p=a.create(r.extend({parts:g.slice(0)},i)),a.setPosition(p,{x:e,y:t}),p):g[0]}},function(e,t,n){var i={};e.exports=i;var s=n(0),r=n(8);i.create=function(e){return s.extend({bodies:[],collisions:[],pairs:null},e)},i.setBodies=function(e,t){e.bodies=t.slice(0)},i.clear=function(e){e.bodies=[],e.collisions=[]},i.collisions=function(e){var t,n,s=e.pairs,a=e.bodies,o=a.length,l=i.canCollide,u=r.collides,c=e.collisions,h=0;for(a.sort(i._compareBoundsX),t=0;t<o;t++){var d=a[t],f=d.bounds,p=d.bounds.max.x,g=d.bounds.max.y,y=d.bounds.min.y,m=d.isStatic||d.isSleeping,x=d.parts.length,v=1===x;for(n=t+1;n<o;n++){var b=a[n];if((P=b.bounds).min.x>p)break;if(!(g<P.min.y||y>P.max.y)&&(!m||!b.isStatic&&!b.isSleeping)&&l(d.collisionFilter,b.collisionFilter)){var w=b.parts.length;if(v&&1===w)(k=u(d,b,s))&&(c[h++]=k);else for(var S=w>1?1:0,M=x>1?1:0;M<x;M++)for(var A=d.parts[M],_=(f=A.bounds,S);_<w;_++){var k,C=b.parts[_],P=C.bounds;f.min.x>P.max.x||f.max.x<P.min.x||f.max.y<P.min.y||f.min.y>P.max.y||(k=u(A,C,s))&&(c[h++]=k)}}}}return c.length!==h&&(c.length=h),c},i.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!==(e.mask&t.category)&&0!==(t.mask&e.category)},i._compareBoundsX=function(e,t){return e.bounds.min.x-t.bounds.min.x}},function(e,t,n){var i={};e.exports=i;var s=n(0);i.create=function(e){var t={};return e||s.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=parseInt(t.element.getAttribute("data-pixel-ratio"),10)||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var n=i._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&(t.button=0,e.preventDefault()),t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var n=i._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var n=i._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&e.preventDefault(),t.button=-1,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault(),t.sourceEvents.mousewheel=e},i.setElement(t,t.element),t},i.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove,{passive:!0}),t.addEventListener("mousedown",e.mousedown,{passive:!0}),t.addEventListener("mouseup",e.mouseup,{passive:!0}),t.addEventListener("wheel",e.mousewheel,{passive:!1}),t.addEventListener("touchmove",e.mousemove,{passive:!1}),t.addEventListener("touchstart",e.mousedown,{passive:!1}),t.addEventListener("touchend",e.mouseup,{passive:!1})},i.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},i.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},i.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},i._getRelativeMousePosition=function(e,t,n){var i,s,r=t.getBoundingClientRect(),a=document.documentElement||document.body.parentNode||document.body,o=void 0!==window.pageXOffset?window.pageXOffset:a.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:a.scrollTop,u=e.changedTouches;return u?(i=u[0].pageX-r.left-o,s=u[0].pageY-r.top-l):(i=e.pageX-r.left-o,s=e.pageY-r.top-l),{x:i/(t.clientWidth/(t.width||t.clientWidth)*n),y:s/(t.clientHeight/(t.height||t.clientHeight)*n)}}},function(e,t,n){var i={};e.exports=i;var s=n(0);i._registry={},i.register=function(e){if(i.isPlugin(e)||s.warn("Plugin.register:",i.toString(e),"does not implement all required fields."),e.name in i._registry){var t=i._registry[e.name],n=i.versionParse(e.version).number,r=i.versionParse(t.version).number;n>r?(s.warn("Plugin.register:",i.toString(t),"was upgraded to",i.toString(e)),i._registry[e.name]=e):n<r?s.warn("Plugin.register:",i.toString(t),"can not be downgraded to",i.toString(e)):e!==t&&s.warn("Plugin.register:",i.toString(e),"is already registered to different plugin object")}else i._registry[e.name]=e;return e},i.resolve=function(e){return i._registry[i.dependencyParse(e).name]},i.toString=function(e){return"string"==typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},i.isPlugin=function(e){return e&&e.name&&e.version&&e.install},i.isUsed=function(e,t){return e.used.indexOf(t)>-1},i.isFor=function(e,t){var n=e.for&&i.dependencyParse(e.for);return!e.for||t.name===n.name&&i.versionSatisfies(t.version,n.range)},i.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var n=i.dependencies(e),r=s.topologicalSort(n),a=[],o=0;o<r.length;o+=1)if(r[o]!==e.name){var l=i.resolve(r[o]);l?i.isUsed(e,l.name)||(i.isFor(l,e)||(s.warn("Plugin.use:",i.toString(l),"is for",l.for,"but installed on",i.toString(e)+"."),l._warned=!0),l.install?l.install(e):(s.warn("Plugin.use:",i.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(a.push(" "+i.toString(l)),delete l._warned):a.push(" "+i.toString(l)),e.used.push(l.name)):a.push(" "+r[o])}a.length>0&&s.info(a.join("  "))}else s.warn("Plugin.use:",i.toString(e),"does not specify any dependencies to install.")},i.dependencies=function(e,t){var n=i.dependencyParse(e),r=n.name;if(!(r in(t=t||{}))){e=i.resolve(e)||e,t[r]=s.map(e.uses||[],function(t){i.isPlugin(t)&&i.register(t);var r=i.dependencyParse(t),a=i.resolve(t);return a&&!i.versionSatisfies(a.version,r.range)?(s.warn("Plugin.dependencies:",i.toString(a),"does not satisfy",i.toString(r),"used by",i.toString(n)+"."),a._warned=!0,e._warned=!0):a||(s.warn("Plugin.dependencies:",i.toString(t),"used by",i.toString(n),"could not be resolved."),e._warned=!0),r.name});for(var a=0;a<t[r].length;a+=1)i.dependencies(t[r][a],t);return t}},i.dependencyParse=function(e){return s.isString(e)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(e)||s.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}):{name:e.name,range:e.range||e.version}},i.versionParse=function(e){var t=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;t.test(e)||s.warn("Plugin.versionParse:",e,"is not a valid version or range.");var n=t.exec(e),i=Number(n[4]),r=Number(n[5]),a=Number(n[6]);return{isRange:Boolean(n[1]||n[2]),version:n[3],range:e,operator:n[1]||n[2]||"",major:i,minor:r,patch:a,parts:[i,r,a],prerelease:n[7],number:1e8*i+1e4*r+a}},i.versionSatisfies=function(e,t){t=t||"*";var n=i.versionParse(t),s=i.versionParse(e);if(n.isRange){if("*"===n.operator||"*"===e)return!0;if(">"===n.operator)return s.number>n.number;if(">="===n.operator)return s.number>=n.number;if("~"===n.operator)return s.major===n.major&&s.minor===n.minor&&s.patch>=n.patch;if("^"===n.operator)return n.major>0?s.major===n.major&&s.number>=n.number:n.minor>0?s.minor===n.minor&&s.patch>=n.patch:s.patch===n.patch}return e===t||"*"===e}},function(e,t){var n={};e.exports=n,n.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}},function(e,t,n){var i={};e.exports=i;var s=n(7),r=n(18),a=n(13),o=n(19),l=n(5),u=n(6),c=n(10),h=n(0),d=n(4);i._deltaMax=1e3/60,i.create=function(e){e=e||{};var t=h.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},e);return t.world=e.world||u.create({label:"World"}),t.pairs=e.pairs||o.create(),t.detector=e.detector||a.create(),t.detector.pairs=t.pairs,t.grid={buckets:[]},t.world.gravity=t.gravity,t.broadphase=t.grid,t.metrics={},t},i.update=function(e,t){var n,d=h.now(),f=e.world,p=e.detector,g=e.pairs,y=e.timing,m=y.timestamp;t>i._deltaMax&&h.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",i._deltaMax.toFixed(3),"ms."),t=void 0!==t?t:h._baseDelta,t*=y.timeScale,y.timestamp+=t,y.lastDelta=t;var x={timestamp:y.timestamp,delta:t};l.trigger(e,"beforeUpdate",x);var v=u.allBodies(f),b=u.allConstraints(f);for(f.isModified&&(a.setBodies(p,v),u.setModified(f,!1,!1,!0)),e.enableSleeping&&s.update(v,t),i._bodiesApplyGravity(v,e.gravity),t>0&&i._bodiesUpdate(v,t),l.trigger(e,"beforeSolve",x),c.preSolveAll(v),n=0;n<e.constraintIterations;n++)c.solveAll(b,t);c.postSolveAll(v);var w=a.collisions(p);o.update(g,w,m),e.enableSleeping&&s.afterCollisions(g.list),g.collisionStart.length>0&&l.trigger(e,"collisionStart",{pairs:g.collisionStart,timestamp:y.timestamp,delta:t});var S=h.clamp(20/e.positionIterations,0,1);for(r.preSolvePosition(g.list),n=0;n<e.positionIterations;n++)r.solvePosition(g.list,t,S);for(r.postSolvePosition(v),c.preSolveAll(v),n=0;n<e.constraintIterations;n++)c.solveAll(b,t);for(c.postSolveAll(v),r.preSolveVelocity(g.list),n=0;n<e.velocityIterations;n++)r.solveVelocity(g.list,t);return i._bodiesUpdateVelocities(v),g.collisionActive.length>0&&l.trigger(e,"collisionActive",{pairs:g.collisionActive,timestamp:y.timestamp,delta:t}),g.collisionEnd.length>0&&l.trigger(e,"collisionEnd",{pairs:g.collisionEnd,timestamp:y.timestamp,delta:t}),i._bodiesClearForces(v),l.trigger(e,"afterUpdate",x),e.timing.lastElapsed=h.now()-d,e},i.merge=function(e,t){if(h.extend(e,t),t.world){e.world=t.world,i.clear(e);for(var n=u.allBodies(e.world),r=0;r<n.length;r++){var a=n[r];s.set(a,!1),a.id=h.nextId()}}},i.clear=function(e){o.clear(e.pairs),a.clear(e.detector)},i._bodiesClearForces=function(e){for(var t=e.length,n=0;n<t;n++){var i=e[n];i.force.x=0,i.force.y=0,i.torque=0}},i._bodiesApplyGravity=function(e,t){var n=void 0!==t.scale?t.scale:.001,i=e.length;if((0!==t.x||0!==t.y)&&0!==n)for(var s=0;s<i;s++){var r=e[s];r.isStatic||r.isSleeping||(r.force.y+=r.mass*t.y*n,r.force.x+=r.mass*t.x*n)}},i._bodiesUpdate=function(e,t){for(var n=e.length,i=0;i<n;i++){var s=e[i];s.isStatic||s.isSleeping||d.update(s,t)}},i._bodiesUpdateVelocities=function(e){for(var t=e.length,n=0;n<t;n++)d.updateVelocities(e[n])}},function(e,t,n){var i={};e.exports=i;var s=n(3),r=n(0),a=n(1);i._restingThresh=2,i._restingThreshTangent=Math.sqrt(6),i._positionDampen=.9,i._positionWarming=.8,i._frictionNormalMultiplier=5,i._frictionMaxStatic=Number.MAX_VALUE,i.preSolvePosition=function(e){var t,n,i,s=e.length;for(t=0;t<s;t++)(n=e[t]).isActive&&(i=n.contactCount,n.collision.parentA.totalContacts+=i,n.collision.parentB.totalContacts+=i)},i.solvePosition=function(e,t,n){var s,a,o,l,u,c,h,d,f=i._positionDampen*(n||1),p=r.clamp(t/r._baseDelta,0,1),g=e.length;for(s=0;s<g;s++)(a=e[s]).isActive&&!a.isSensor&&(l=(o=a.collision).parentA,u=o.parentB,c=o.normal,a.separation=o.depth+c.x*(u.positionImpulse.x-l.positionImpulse.x)+c.y*(u.positionImpulse.y-l.positionImpulse.y));for(s=0;s<g;s++)(a=e[s]).isActive&&!a.isSensor&&(l=(o=a.collision).parentA,u=o.parentB,c=o.normal,d=a.separation-a.slop*p,(l.isStatic||u.isStatic)&&(d*=2),l.isStatic||l.isSleeping||(h=f/l.totalContacts,l.positionImpulse.x+=c.x*d*h,l.positionImpulse.y+=c.y*d*h),u.isStatic||u.isSleeping||(h=f/u.totalContacts,u.positionImpulse.x-=c.x*d*h,u.positionImpulse.y-=c.y*d*h))},i.postSolvePosition=function(e){for(var t=i._positionWarming,n=e.length,r=s.translate,o=a.update,l=0;l<n;l++){var u=e[l],c=u.positionImpulse,h=c.x,d=c.y,f=u.velocity;if(u.totalContacts=0,0!==h||0!==d){for(var p=0;p<u.parts.length;p++){var g=u.parts[p];r(g.vertices,c),o(g.bounds,g.vertices,f),g.position.x+=h,g.position.y+=d}u.positionPrev.x+=h,u.positionPrev.y+=d,h*f.x+d*f.y<0?(c.x=0,c.y=0):(c.x*=t,c.y*=t)}}},i.preSolveVelocity=function(e){var t,n,i=e.length;for(t=0;t<i;t++){var s=e[t];if(s.isActive&&!s.isSensor){var r=s.contacts,a=s.contactCount,o=s.collision,l=o.parentA,u=o.parentB,c=o.normal,h=o.tangent;for(n=0;n<a;n++){var d=r[n],f=d.vertex,p=d.normalImpulse,g=d.tangentImpulse;if(0!==p||0!==g){var y=c.x*p+h.x*g,m=c.y*p+h.y*g;l.isStatic||l.isSleeping||(l.positionPrev.x+=y*l.inverseMass,l.positionPrev.y+=m*l.inverseMass,l.anglePrev+=l.inverseInertia*((f.x-l.position.x)*m-(f.y-l.position.y)*y)),u.isStatic||u.isSleeping||(u.positionPrev.x-=y*u.inverseMass,u.positionPrev.y-=m*u.inverseMass,u.anglePrev-=u.inverseInertia*((f.x-u.position.x)*m-(f.y-u.position.y)*y))}}}}},i.solveVelocity=function(e,t){var n,s,a,o,l=t/r._baseDelta,u=l*l*l,c=-i._restingThresh*l,h=i._restingThreshTangent,d=i._frictionNormalMultiplier*l,f=i._frictionMaxStatic,p=e.length;for(a=0;a<p;a++){var g=e[a];if(g.isActive&&!g.isSensor){var y=g.collision,m=y.parentA,x=y.parentB,v=y.normal.x,b=y.normal.y,w=y.tangent.x,S=y.tangent.y,M=g.inverseMass,A=g.friction*g.frictionStatic*d,_=g.contacts,k=g.contactCount,C=1/k,P=m.position.x-m.positionPrev.x,B=m.position.y-m.positionPrev.y,I=m.angle-m.anglePrev,T=x.position.x-x.positionPrev.x,E=x.position.y-x.positionPrev.y,F=x.angle-x.anglePrev;for(o=0;o<k;o++){var R=_[o],D=R.vertex,L=D.x-m.position.x,O=D.y-m.position.y,V=D.x-x.position.x,q=D.y-x.position.y,Y=P-O*I-(T-q*F),j=B+L*I-(E+V*F),U=v*Y+b*j,z=w*Y+S*j,W=g.separation+U,N=Math.min(W,1),G=(N=W<0?0:N)*A;z<-G||z>G?(s=z>0?z:-z,(n=g.friction*(z>0?1:-1)*u)<-s?n=-s:n>s&&(n=s)):(n=z,s=f);var H=L*b-O*v,X=V*b-q*v,Q=C/(M+m.inverseInertia*H*H+x.inverseInertia*X*X),Z=(1+g.restitution)*U*Q;if(n*=Q,U<c)R.normalImpulse=0;else{var $=R.normalImpulse;R.normalImpulse+=Z,R.normalImpulse>0&&(R.normalImpulse=0),Z=R.normalImpulse-$}if(z<-h||z>h)R.tangentImpulse=0;else{var K=R.tangentImpulse;R.tangentImpulse+=n,R.tangentImpulse<-s&&(R.tangentImpulse=-s),R.tangentImpulse>s&&(R.tangentImpulse=s),n=R.tangentImpulse-K}var J=v*Z+w*n,ee=b*Z+S*n;m.isStatic||m.isSleeping||(m.positionPrev.x+=J*m.inverseMass,m.positionPrev.y+=ee*m.inverseMass,m.anglePrev+=(L*ee-O*J)*m.inverseInertia),x.isStatic||x.isSleeping||(x.positionPrev.x-=J*x.inverseMass,x.positionPrev.y-=ee*x.inverseMass,x.anglePrev-=(V*ee-q*J)*x.inverseInertia)}}}}},function(e,t,n){var i={};e.exports=i;var s=n(9),r=n(0);i.create=function(e){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},i.update=function(e,t,n){var i,r,a,o=s.update,l=s.create,u=s.setActive,c=e.table,h=e.list,d=h.length,f=d,p=e.collisionStart,g=e.collisionEnd,y=e.collisionActive,m=t.length,x=0,v=0,b=0;for(a=0;a<m;a++)(r=(i=t[a]).pair)?(r.isActive&&(y[b++]=r),o(r,i,n)):(c[(r=l(i,n)).id]=r,p[x++]=r,h[f++]=r);for(f=0,d=h.length,a=0;a<d;a++)(r=h[a]).timeUpdated>=n?h[f++]=r:(u(r,!1,n),r.collision.bodyA.sleepCounter>0&&r.collision.bodyB.sleepCounter>0?h[f++]=r:(g[v++]=r,delete c[r.id]));h.length!==f&&(h.length=f),p.length!==x&&(p.length=x),g.length!==v&&(g.length=v),y.length!==b&&(y.length=b)},i.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}},function(e,t,n){var i=e.exports=n(21);i.Axes=n(11),i.Bodies=n(12),i.Body=n(4),i.Bounds=n(1),i.Collision=n(8),i.Common=n(0),i.Composite=n(6),i.Composites=n(22),i.Constraint=n(10),i.Contact=n(16),i.Detector=n(13),i.Engine=n(17),i.Events=n(5),i.Grid=n(23),i.Mouse=n(14),i.MouseConstraint=n(24),i.Pair=n(9),i.Pairs=n(19),i.Plugin=n(15),i.Query=n(25),i.Render=n(26),i.Resolver=n(18),i.Runner=n(27),i.SAT=n(28),i.Sleeping=n(7),i.Svg=n(29),i.Vector=n(2),i.Vertices=n(3),i.World=n(30),i.Engine.run=i.Runner.run,i.Common.deprecated(i.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(e,t,n){var i={};e.exports=i;var s=n(15),r=n(0);i.name="matter-js",i.version="0.20.0",i.uses=[],i.used=[],i.use=function(){s.use(i,Array.prototype.slice.call(arguments))},i.before=function(e,t){return e=e.replace(/^Matter./,""),r.chainPathBefore(i,e,t)},i.after=function(e,t){return e=e.replace(/^Matter./,""),r.chainPathAfter(i,e,t)}},function(e,t,n){var i={};e.exports=i;var s=n(6),r=n(10),a=n(0),o=n(4),l=n(12),u=a.deprecated;i.stack=function(e,t,n,i,r,a,l){for(var u,c=s.create({label:"Stack"}),h=e,d=t,f=0,p=0;p<i;p++){for(var g=0,y=0;y<n;y++){var m=l(h,d,y,p,u,f);if(m){var x=m.bounds.max.y-m.bounds.min.y,v=m.bounds.max.x-m.bounds.min.x;x>g&&(g=x),o.translate(m,{x:.5*v,y:.5*x}),h=m.bounds.max.x+r,s.addBody(c,m),u=m,f+=1}else h+=r}d+=g+a,h=e}return c},i.chain=function(e,t,n,i,o,l){for(var u=e.bodies,c=1;c<u.length;c++){var h=u[c-1],d=u[c],f=h.bounds.max.y-h.bounds.min.y,p=h.bounds.max.x-h.bounds.min.x,g=d.bounds.max.y-d.bounds.min.y,y={bodyA:h,pointA:{x:p*t,y:f*n},bodyB:d,pointB:{x:(d.bounds.max.x-d.bounds.min.x)*i,y:g*o}},m=a.extend(y,l);s.addConstraint(e,r.create(m))}return e.label+=" Chain",e},i.mesh=function(e,t,n,i,o){var l,u,c,h,d,f=e.bodies;for(l=0;l<n;l++){for(u=1;u<t;u++)c=f[u-1+l*t],h=f[u+l*t],s.addConstraint(e,r.create(a.extend({bodyA:c,bodyB:h},o)));if(l>0)for(u=0;u<t;u++)c=f[u+(l-1)*t],h=f[u+l*t],s.addConstraint(e,r.create(a.extend({bodyA:c,bodyB:h},o))),i&&u>0&&(d=f[u-1+(l-1)*t],s.addConstraint(e,r.create(a.extend({bodyA:d,bodyB:h},o)))),i&&u<t-1&&(d=f[u+1+(l-1)*t],s.addConstraint(e,r.create(a.extend({bodyA:d,bodyB:h},o))))}return e.label+=" Mesh",e},i.pyramid=function(e,t,n,s,r,a,l){return i.stack(e,t,n,s,r,a,function(t,i,a,u,c,h){var d=Math.min(s,Math.ceil(n/2)),f=c?c.bounds.max.x-c.bounds.min.x:0;if(!(u>d||a<(u=d-u)||a>n-1-u))return 1===h&&o.translate(c,{x:(a+(n%2==1?1:-1))*f,y:0}),l(e+(c?a*f:0)+a*r,i,a,u,c,h)})},i.newtonsCradle=function(e,t,n,i,a){for(var o=s.create({label:"Newtons Cradle"}),u=0;u<n;u++){var c=l.circle(e+u*(1.9*i),t+a,i,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=r.create({pointA:{x:e+u*(1.9*i),y:t},bodyB:c});s.addBody(o,c),s.addConstraint(o,h)}return o},u(i,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),i.car=function(e,t,n,i,a){var u=o.nextGroup(!0),c=.5*-n+20,h=.5*n-20,d=s.create({label:"Car"}),f=l.rectangle(e,t,n,i,{collisionFilter:{group:u},chamfer:{radius:.5*i},density:2e-4}),p=l.circle(e+c,t+0,a,{collisionFilter:{group:u},friction:.8}),g=l.circle(e+h,t+0,a,{collisionFilter:{group:u},friction:.8}),y=r.create({bodyB:f,pointB:{x:c,y:0},bodyA:p,stiffness:1,length:0}),m=r.create({bodyB:f,pointB:{x:h,y:0},bodyA:g,stiffness:1,length:0});return s.addBody(d,f),s.addBody(d,p),s.addBody(d,g),s.addConstraint(d,y),s.addConstraint(d,m),d},u(i,"car","Composites.car  moved to car example"),i.softBody=function(e,t,n,s,r,o,u,c,h,d){h=a.extend({inertia:1/0},h),d=a.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var f=i.stack(e,t,n,s,r,o,function(e,t){return l.circle(e,t,c,h)});return i.mesh(f,n,s,u,d),f.label="Soft Body",f},u(i,"softBody","Composites.softBody  moved to softBody and cloth examples")},function(e,t,n){var i={};e.exports=i;var s=n(9),r=n(0),a=r.deprecated;i.create=function(e){return r.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},e)},i.update=function(e,t,n,s){var r,a,o,l,u,c=n.world,h=e.buckets,d=!1;for(r=0;r<t.length;r++){var f=t[r];if((!f.isSleeping||s)&&(!c.bounds||!(f.bounds.max.x<c.bounds.min.x||f.bounds.min.x>c.bounds.max.x||f.bounds.max.y<c.bounds.min.y||f.bounds.min.y>c.bounds.max.y))){var p=i._getRegion(e,f);if(!f.region||p.id!==f.region.id||s){f.region&&!s||(f.region=p);var g=i._regionUnion(p,f.region);for(a=g.startCol;a<=g.endCol;a++)for(o=g.startRow;o<=g.endRow;o++){l=h[u=i._getBucketId(a,o)];var y=a>=p.startCol&&a<=p.endCol&&o>=p.startRow&&o<=p.endRow,m=a>=f.region.startCol&&a<=f.region.endCol&&o>=f.region.startRow&&o<=f.region.endRow;!y&&m&&m&&l&&i._bucketRemoveBody(e,l,f),(f.region===p||y&&!m||s)&&(l||(l=i._createBucket(h,u)),i._bucketAddBody(e,l,f))}f.region=p,d=!0}}}d&&(e.pairsList=i._createActivePairsList(e))},a(i,"update","Grid.update  replaced by Matter.Detector"),i.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},a(i,"clear","Grid.clear  replaced by Matter.Detector"),i._regionUnion=function(e,t){var n=Math.min(e.startCol,t.startCol),s=Math.max(e.endCol,t.endCol),r=Math.min(e.startRow,t.startRow),a=Math.max(e.endRow,t.endRow);return i._createRegion(n,s,r,a)},i._getRegion=function(e,t){var n=t.bounds,s=Math.floor(n.min.x/e.bucketWidth),r=Math.floor(n.max.x/e.bucketWidth),a=Math.floor(n.min.y/e.bucketHeight),o=Math.floor(n.max.y/e.bucketHeight);return i._createRegion(s,r,a,o)},i._createRegion=function(e,t,n,i){return{id:e+","+t+","+n+","+i,startCol:e,endCol:t,startRow:n,endRow:i}},i._getBucketId=function(e,t){return"C"+e+"R"+t},i._createBucket=function(e,t){return e[t]=[]},i._bucketAddBody=function(e,t,n){var i,r=e.pairs,a=s.id,o=t.length;for(i=0;i<o;i++){var l=t[i];if(!(n.id===l.id||n.isStatic&&l.isStatic)){var u=a(n,l),c=r[u];c?c[2]+=1:r[u]=[n,l,1]}}t.push(n)},i._bucketRemoveBody=function(e,t,n){var i,a=e.pairs,o=s.id;t.splice(r.indexOf(t,n),1);var l=t.length;for(i=0;i<l;i++){var u=a[o(n,t[i])];u&&(u[2]-=1)}},i._createActivePairsList=function(e){var t,n,i=e.pairs,s=r.keys(i),a=s.length,o=[];for(n=0;n<a;n++)(t=i[s[n]])[2]>0?o.push(t):delete i[s[n]];return o}},function(e,t,n){var i={};e.exports=i;var s=n(3),r=n(7),a=n(14),o=n(5),l=n(13),u=n(10),c=n(6),h=n(0),d=n(1);i.create=function(e,t){var n=(e?e.mouse:null)||(t?t.mouse:null);n||(e&&e.render&&e.render.canvas?n=a.create(e.render.canvas):t&&t.element?n=a.create(t.element):(n=a.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var s={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:u.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},r=h.extend(s,t);return o.on(e,"beforeUpdate",function(){var t=c.allBodies(e.world);i.update(r,t),i._triggerEvents(r)}),r},i.update=function(e,t){var n=e.mouse,i=e.constraint,a=e.body;if(0===n.button){if(i.bodyB)r.set(i.bodyB,!1),i.pointA=n.position;else for(var u=0;u<t.length;u++)if(a=t[u],d.contains(a.bounds,n.position)&&l.canCollide(a.collisionFilter,e.collisionFilter))for(var c=a.parts.length>1?1:0;c<a.parts.length;c++){var h=a.parts[c];if(s.contains(h.vertices,n.position)){i.pointA=n.position,i.bodyB=e.body=a,i.pointB={x:n.position.x-a.position.x,y:n.position.y-a.position.y},i.angleB=a.angle,r.set(a,!1),o.trigger(e,"startdrag",{mouse:n,body:a});break}}}else i.bodyB=e.body=null,i.pointB=null,a&&o.trigger(e,"enddrag",{mouse:n,body:a})},i._triggerEvents=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&o.trigger(e,"mousemove",{mouse:t}),n.mousedown&&o.trigger(e,"mousedown",{mouse:t}),n.mouseup&&o.trigger(e,"mouseup",{mouse:t}),a.clearSourceEvents(t)}},function(e,t,n){var i={};e.exports=i;var s=n(2),r=n(8),a=n(1),o=n(12),l=n(3);i.collides=function(e,t){for(var n=[],i=t.length,s=e.bounds,o=r.collides,l=a.overlaps,u=0;u<i;u++){var c=t[u],h=c.parts.length,d=1===h?0:1;if(l(c.bounds,s))for(var f=d;f<h;f++){var p=c.parts[f];if(l(p.bounds,s)){var g=o(p,e);if(g){n.push(g);break}}}}return n},i.ray=function(e,t,n,r){r=r||1e-100;for(var a=s.angle(t,n),l=s.magnitude(s.sub(t,n)),u=.5*(n.x+t.x),c=.5*(n.y+t.y),h=o.rectangle(u,c,l,r,{angle:a}),d=i.collides(h,e),f=0;f<d.length;f+=1){var p=d[f];p.body=p.bodyB=p.bodyA}return d},i.region=function(e,t,n){for(var i=[],s=0;s<e.length;s++){var r=e[s],o=a.overlaps(r.bounds,t);(o&&!n||!o&&n)&&i.push(r)}return i},i.point=function(e,t){for(var n=[],i=0;i<e.length;i++){var s=e[i];if(a.contains(s.bounds,t))for(var r=1===s.parts.length?0:1;r<s.parts.length;r++){var o=s.parts[r];if(a.contains(o.bounds,t)&&l.contains(o.vertices,t)){n.push(s);break}}}return n}},function(e,t,n){var i={};e.exports=i;var s=n(4),r=n(0),a=n(6),o=n(1),l=n(5),u=n(2),c=n(14);!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(r.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),i._goodFps=30,i._goodDelta=1e3/60,i.create=function(e){var t={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},n=r.extend(t,e);return n.canvas&&(n.canvas.width=n.options.width||n.canvas.width,n.canvas.height=n.options.height||n.canvas.height),n.mouse=e.mouse,n.engine=e.engine,n.canvas=n.canvas||d(n.options.width,n.options.height),n.context=n.canvas.getContext("2d"),n.textures={},n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.canvas.width,y:n.canvas.height}},n.controller=i,n.options.showBroadphase=!1,1!==n.options.pixelRatio&&i.setPixelRatio(n,n.options.pixelRatio),r.isElement(n.element)&&n.element.appendChild(n.canvas),n},i.run=function(t){!function s(r){t.frameRequestId=e(s),n(t,r),i.world(t,r),t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0),(t.options.showStats||t.options.showDebug)&&i.stats(t,t.context,r),(t.options.showPerformance||t.options.showDebug)&&i.performance(t,t.context,r),t.context.setTransform(1,0,0,1,0,0)}()},i.stop=function(e){t(e.frameRequestId)},i.setPixelRatio=function(e,t){var n=e.options,i=e.canvas;"auto"===t&&(t=f(i)),n.pixelRatio=t,i.setAttribute("data-pixel-ratio",t),i.width=n.width*t,i.height=n.height*t,i.style.width=n.width+"px",i.style.height=n.height+"px"},i.setSize=function(e,t,n){e.options.width=t,e.options.height=n,e.bounds.max.x=e.bounds.min.x+t,e.bounds.max.y=e.bounds.min.y+n,1!==e.options.pixelRatio?i.setPixelRatio(e,e.options.pixelRatio):(e.canvas.width=t,e.canvas.height=n)},i.lookAt=function(e,t,n,i){i=void 0===i||i,t=r.isArray(t)?t:[t],n=n||{x:0,y:0};for(var s={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},a=0;a<t.length;a+=1){var o=t[a],l=o.bounds?o.bounds.min:o.min||o.position||o,u=o.bounds?o.bounds.max:o.max||o.position||o;l&&u&&(l.x<s.min.x&&(s.min.x=l.x),u.x>s.max.x&&(s.max.x=u.x),l.y<s.min.y&&(s.min.y=l.y),u.y>s.max.y&&(s.max.y=u.y))}var h=s.max.x-s.min.x+2*n.x,d=s.max.y-s.min.y+2*n.y,f=e.canvas.height,p=e.canvas.width/f,g=h/d,y=1,m=1;g>p?m=g/p:y=p/g,e.options.hasBounds=!0,e.bounds.min.x=s.min.x,e.bounds.max.x=s.min.x+h*y,e.bounds.min.y=s.min.y,e.bounds.max.y=s.min.y+d*m,i&&(e.bounds.min.x+=.5*h-h*y*.5,e.bounds.max.x+=.5*h-h*y*.5,e.bounds.min.y+=.5*d-d*m*.5,e.bounds.max.y+=.5*d-d*m*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),c.setOffset(e.mouse,e.bounds.min))},i.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,i=t/e.options.width,s=n/e.options.height;e.context.setTransform(e.options.pixelRatio/i,0,0,e.options.pixelRatio/s,0,0),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},i.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},i.world=function(e,t){var n,s=r.now(),h=e.engine,d=h.world,f=e.canvas,p=e.context,y=e.options,m=e.timing,x=a.allBodies(d),v=a.allConstraints(d),b=y.wireframes?y.wireframeBackground:y.background,w=[],S=[],M={timestamp:h.timing.timestamp};if(l.trigger(e,"beforeRender",M),e.currentBackground!==b&&g(e,b),p.globalCompositeOperation="source-in",p.fillStyle="transparent",p.fillRect(0,0,f.width,f.height),p.globalCompositeOperation="source-over",y.hasBounds){for(n=0;n<x.length;n++){var A=x[n];o.overlaps(A.bounds,e.bounds)&&w.push(A)}for(n=0;n<v.length;n++){var _=v[n],k=_.bodyA,C=_.bodyB,P=_.pointA,B=_.pointB;k&&(P=u.add(k.position,_.pointA)),C&&(B=u.add(C.position,_.pointB)),P&&B&&(o.contains(e.bounds,P)||o.contains(e.bounds,B))&&S.push(_)}i.startViewTransform(e),e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.options.width,y:(e.bounds.max.y-e.bounds.min.y)/e.options.height}),c.setOffset(e.mouse,e.bounds.min))}else S=v,w=x,1!==e.options.pixelRatio&&e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0);!y.wireframes||h.enableSleeping&&y.showSleeping?i.bodies(e,w,p):(y.showConvexHulls&&i.bodyConvexHulls(e,w,p),i.bodyWireframes(e,w,p)),y.showBounds&&i.bodyBounds(e,w,p),(y.showAxes||y.showAngleIndicator)&&i.bodyAxes(e,w,p),y.showPositions&&i.bodyPositions(e,w,p),y.showVelocity&&i.bodyVelocity(e,w,p),y.showIds&&i.bodyIds(e,w,p),y.showSeparations&&i.separations(e,h.pairs.list,p),y.showCollisions&&i.collisions(e,h.pairs.list,p),y.showVertexNumbers&&i.vertexNumbers(e,w,p),y.showMousePosition&&i.mousePosition(e,e.mouse,p),i.constraints(S,p),y.hasBounds&&i.endViewTransform(e),l.trigger(e,"afterRender",M),m.lastElapsed=r.now()-s},i.stats=function(e,t,n){for(var i=e.engine,s=i.world,r=a.allBodies(s),o=0,l=0,u=0;u<r.length;u+=1)o+=r[u].parts.length;var c={Part:o,Body:r.length,Cons:a.allConstraints(s).length,Comp:a.allComposites(s).length,Pair:i.pairs.list.length};for(var h in t.fillStyle="#0e0f19",t.fillRect(l,0,302.5,44),t.font="12px Arial",t.textBaseline="top",t.textAlign="right",c){var d=c[h];t.fillStyle="#aaa",t.fillText(h,l+55,8),t.fillStyle="#eee",t.fillText(d,l+55,26),l+=55}},i.performance=function(e,t){var n=e.engine,s=e.timing,a=s.deltaHistory,o=s.elapsedHistory,l=s.timestampElapsedHistory,u=s.engineDeltaHistory,c=s.engineUpdatesHistory,d=s.engineElapsedHistory,f=n.timing.lastUpdatesPerFrame,p=n.timing.lastDelta,g=h(a),y=h(o),m=h(u),x=h(c),v=h(d),b=h(l)/g||0,w=Math.round(g/p),S=1e3/g||0,M=60,A=10,_=69;t.fillStyle="#0e0f19",t.fillRect(0,50,442,34),i.status(t,A,_,M,4,a.length,Math.round(S)+" fps",S/i._goodFps,function(e){return a[e]/g-1}),i.status(t,82,_,M,4,u.length,p.toFixed(2)+" dt",i._goodDelta/p,function(e){return u[e]/m-1}),i.status(t,154,_,M,4,c.length,f+" upf",Math.pow(r.clamp(x/w||1,0,1),4),function(e){return c[e]/x-1}),i.status(t,226,_,M,4,d.length,v.toFixed(2)+" ut",1-f*v/i._goodFps,function(e){return d[e]/v-1}),i.status(t,298,_,M,4,o.length,y.toFixed(2)+" rt",1-y/i._goodFps,function(e){return o[e]/y-1}),i.status(t,370,_,M,4,l.length,b.toFixed(2)+" x",b*b*b,function(e){return(l[e]/a[e]/b||0)-1})},i.status=function(e,t,n,i,s,a,o,l,u){e.strokeStyle="#888",e.fillStyle="#444",e.lineWidth=1,e.fillRect(t,n+7,i,1),e.beginPath(),e.moveTo(t,n+7-s*r.clamp(.4*u(0),-2,2));for(var c=0;c<i;c+=1)e.lineTo(t+c,n+7-(c<a?s*r.clamp(.4*u(c),-2,2):0));e.stroke(),e.fillStyle="hsl("+r.clamp(25+95*l,0,120)+",100%,60%)",e.fillRect(t,n-7,4,4),e.font="12px Arial",e.textBaseline="middle",e.textAlign="right",e.fillStyle="#eee",e.fillText(o,t+i,n-5)},i.constraints=function(e,t){for(var n=t,i=0;i<e.length;i++){var s=e[i];if(s.render.visible&&s.pointA&&s.pointB){var a,o,l=s.bodyA,c=s.bodyB;if(a=l?u.add(l.position,s.pointA):s.pointA,"pin"===s.render.type)n.beginPath(),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath();else{if(o=c?u.add(c.position,s.pointB):s.pointB,n.beginPath(),n.moveTo(a.x,a.y),"spring"===s.render.type)for(var h,d=u.sub(o,a),f=u.perp(u.normalise(d)),p=Math.ceil(r.clamp(s.length/5,12,20)),g=1;g<p;g+=1)h=g%2==0?1:-1,n.lineTo(a.x+d.x*(g/p)+f.x*h*4,a.y+d.y*(g/p)+f.y*h*4);n.lineTo(o.x,o.y)}s.render.lineWidth&&(n.lineWidth=s.render.lineWidth,n.strokeStyle=s.render.strokeStyle,n.stroke()),s.render.anchors&&(n.fillStyle=s.render.strokeStyle,n.beginPath(),n.arc(a.x,a.y,3,0,2*Math.PI),n.arc(o.x,o.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},i.bodies=function(e,t,n){var i=n;e.engine;var s,r,a,o,l=e.options,u=l.showInternalEdges||!l.wireframes;for(a=0;a<t.length;a++)if((s=t[a]).render.visible)for(o=s.parts.length>1?1:0;o<s.parts.length;o++)if((r=s.parts[o]).render.visible){if(l.showSleeping&&s.isSleeping?i.globalAlpha=.5*r.render.opacity:1!==r.render.opacity&&(i.globalAlpha=r.render.opacity),r.render.sprite&&r.render.sprite.texture&&!l.wireframes){var c=r.render.sprite,h=p(e,c.texture);i.translate(r.position.x,r.position.y),i.rotate(r.angle),i.drawImage(h,h.width*-c.xOffset*c.xScale,h.height*-c.yOffset*c.yScale,h.width*c.xScale,h.height*c.yScale),i.rotate(-r.angle),i.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius)i.beginPath(),i.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{i.beginPath(),i.moveTo(r.vertices[0].x,r.vertices[0].y);for(var d=1;d<r.vertices.length;d++)!r.vertices[d-1].isInternal||u?i.lineTo(r.vertices[d].x,r.vertices[d].y):i.moveTo(r.vertices[d].x,r.vertices[d].y),r.vertices[d].isInternal&&!u&&i.moveTo(r.vertices[(d+1)%r.vertices.length].x,r.vertices[(d+1)%r.vertices.length].y);i.lineTo(r.vertices[0].x,r.vertices[0].y),i.closePath()}l.wireframes?(i.lineWidth=1,i.strokeStyle=e.options.wireframeStrokeStyle,i.stroke()):(i.fillStyle=r.render.fillStyle,r.render.lineWidth&&(i.lineWidth=r.render.lineWidth,i.strokeStyle=r.render.strokeStyle,i.stroke()),i.fill())}i.globalAlpha=1}},i.bodyWireframes=function(e,t,n){var i,s,r,a,o,l=n,u=e.options.showInternalEdges;for(l.beginPath(),r=0;r<t.length;r++)if((i=t[r]).render.visible)for(o=i.parts.length>1?1:0;o<i.parts.length;o++){for(s=i.parts[o],l.moveTo(s.vertices[0].x,s.vertices[0].y),a=1;a<s.vertices.length;a++)!s.vertices[a-1].isInternal||u?l.lineTo(s.vertices[a].x,s.vertices[a].y):l.moveTo(s.vertices[a].x,s.vertices[a].y),s.vertices[a].isInternal&&!u&&l.moveTo(s.vertices[(a+1)%s.vertices.length].x,s.vertices[(a+1)%s.vertices.length].y);l.lineTo(s.vertices[0].x,s.vertices[0].y)}l.lineWidth=1,l.strokeStyle=e.options.wireframeStrokeStyle,l.stroke()},i.bodyConvexHulls=function(e,t,n){var i,s,r,a=n;for(a.beginPath(),s=0;s<t.length;s++)if((i=t[s]).render.visible&&1!==i.parts.length){for(a.moveTo(i.vertices[0].x,i.vertices[0].y),r=1;r<i.vertices.length;r++)a.lineTo(i.vertices[r].x,i.vertices[r].y);a.lineTo(i.vertices[0].x,i.vertices[0].y)}a.lineWidth=1,a.strokeStyle="rgba(255,255,255,0.2)",a.stroke()},i.vertexNumbers=function(e,t,n){var i,s,r,a=n;for(i=0;i<t.length;i++){var o=t[i].parts;for(r=o.length>1?1:0;r<o.length;r++){var l=o[r];for(s=0;s<l.vertices.length;s++)a.fillStyle="rgba(255,255,255,0.2)",a.fillText(i+"_"+s,l.position.x+.8*(l.vertices[s].x-l.position.x),l.position.y+.8*(l.vertices[s].y-l.position.y))}}},i.mousePosition=function(e,t,n){var i=n;i.fillStyle="rgba(255,255,255,0.8)",i.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},i.bodyBounds=function(e,t,n){var i=n;e.engine;var s=e.options;i.beginPath();for(var r=0;r<t.length;r++)if(t[r].render.visible)for(var a=t[r].parts,o=a.length>1?1:0;o<a.length;o++){var l=a[o];i.rect(l.bounds.min.x,l.bounds.min.y,l.bounds.max.x-l.bounds.min.x,l.bounds.max.y-l.bounds.min.y)}s.wireframes?i.strokeStyle="rgba(255,255,255,0.08)":i.strokeStyle="rgba(0,0,0,0.1)",i.lineWidth=1,i.stroke()},i.bodyAxes=function(e,t,n){var i=n;e.engine;var s,r,a,o,l=e.options;for(i.beginPath(),r=0;r<t.length;r++){var u=t[r],c=u.parts;if(u.render.visible)if(l.showAxes)for(a=c.length>1?1:0;a<c.length;a++)for(s=c[a],o=0;o<s.axes.length;o++){var h=s.axes[o];i.moveTo(s.position.x,s.position.y),i.lineTo(s.position.x+20*h.x,s.position.y+20*h.y)}else for(a=c.length>1?1:0;a<c.length;a++)for(s=c[a],o=0;o<s.axes.length;o++)i.moveTo(s.position.x,s.position.y),i.lineTo((s.vertices[0].x+s.vertices[s.vertices.length-1].x)/2,(s.vertices[0].y+s.vertices[s.vertices.length-1].y)/2)}l.wireframes?(i.strokeStyle="indianred",i.lineWidth=1):(i.strokeStyle="rgba(255, 255, 255, 0.4)",i.globalCompositeOperation="overlay",i.lineWidth=2),i.stroke(),i.globalCompositeOperation="source-over"},i.bodyPositions=function(e,t,n){var i=n;e.engine;var s,r,a,o,l=e.options;for(i.beginPath(),a=0;a<t.length;a++)if((s=t[a]).render.visible)for(o=0;o<s.parts.length;o++)r=s.parts[o],i.arc(r.position.x,r.position.y,3,0,2*Math.PI,!1),i.closePath();for(l.wireframes?i.fillStyle="indianred":i.fillStyle="rgba(0,0,0,0.5)",i.fill(),i.beginPath(),a=0;a<t.length;a++)(s=t[a]).render.visible&&(i.arc(s.positionPrev.x,s.positionPrev.y,2,0,2*Math.PI,!1),i.closePath());i.fillStyle="rgba(255,165,0,0.8)",i.fill()},i.bodyVelocity=function(e,t,n){var i=n;i.beginPath();for(var r=0;r<t.length;r++){var a=t[r];if(a.render.visible){var o=s.getVelocity(a);i.moveTo(a.position.x,a.position.y),i.lineTo(a.position.x+o.x,a.position.y+o.y)}}i.lineWidth=3,i.strokeStyle="cornflowerblue",i.stroke()},i.bodyIds=function(e,t,n){var i,s,r=n;for(i=0;i<t.length;i++)if(t[i].render.visible){var a=t[i].parts;for(s=a.length>1?1:0;s<a.length;s++){var o=a[s];r.font="12px Arial",r.fillStyle="rgba(255,255,255,0.5)",r.fillText(o.id,o.position.x+10,o.position.y-10)}}},i.collisions=function(e,t,n){var i,s,r,a,o=n,l=e.options;for(o.beginPath(),r=0;r<t.length;r++)if((i=t[r]).isActive)for(s=i.collision,a=0;a<i.contactCount;a++){var u=i.contacts[a].vertex;o.rect(u.x-1.5,u.y-1.5,3.5,3.5)}for(l.wireframes?o.fillStyle="rgba(255,255,255,0.7)":o.fillStyle="orange",o.fill(),o.beginPath(),r=0;r<t.length;r++)if((i=t[r]).isActive&&(s=i.collision,i.contactCount>0)){var c=i.contacts[0].vertex.x,h=i.contacts[0].vertex.y;2===i.contactCount&&(c=(i.contacts[0].vertex.x+i.contacts[1].vertex.x)/2,h=(i.contacts[0].vertex.y+i.contacts[1].vertex.y)/2),s.bodyB===s.supports[0].body||!0===s.bodyA.isStatic?o.moveTo(c-8*s.normal.x,h-8*s.normal.y):o.moveTo(c+8*s.normal.x,h+8*s.normal.y),o.lineTo(c,h)}l.wireframes?o.strokeStyle="rgba(255,165,0,0.7)":o.strokeStyle="orange",o.lineWidth=1,o.stroke()},i.separations=function(e,t,n){var i,s,r,a,o,l=n,u=e.options;for(l.beginPath(),o=0;o<t.length;o++)if((i=t[o]).isActive){r=(s=i.collision).bodyA;var c=1;(a=s.bodyB).isStatic||r.isStatic||(c=.5),a.isStatic&&(c=0),l.moveTo(a.position.x,a.position.y),l.lineTo(a.position.x-s.penetration.x*c,a.position.y-s.penetration.y*c),c=1,a.isStatic||r.isStatic||(c=.5),r.isStatic&&(c=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x+s.penetration.x*c,r.position.y+s.penetration.y*c)}u.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},i.inspector=function(e,t){e.engine;var n,i=e.selected,s=e.render,r=s.options;if(r.hasBounds){var a=s.bounds.max.x-s.bounds.min.x,o=s.bounds.max.y-s.bounds.min.y,l=a/s.options.width,u=o/s.options.height;t.scale(1/l,1/u),t.translate(-s.bounds.min.x,-s.bounds.min.y)}for(var c=0;c<i.length;c++){var h=i[c].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),h.type){case"body":n=h.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var d=h.pointA;h.bodyA&&(d=h.pointB),t.beginPath(),t.arc(d.x,d.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),r.hasBounds&&t.setTransform(1,0,0,1,0,0)};var n=function(e,t){var n=e.engine,s=e.timing,r=s.historySize,a=n.timing.timestamp;s.delta=t-s.lastTime||i._goodDelta,s.lastTime=t,s.timestampElapsed=a-s.lastTimestamp||0,s.lastTimestamp=a,s.deltaHistory.unshift(s.delta),s.deltaHistory.length=Math.min(s.deltaHistory.length,r),s.engineDeltaHistory.unshift(n.timing.lastDelta),s.engineDeltaHistory.length=Math.min(s.engineDeltaHistory.length,r),s.timestampElapsedHistory.unshift(s.timestampElapsed),s.timestampElapsedHistory.length=Math.min(s.timestampElapsedHistory.length,r),s.engineUpdatesHistory.unshift(n.timing.lastUpdatesPerFrame),s.engineUpdatesHistory.length=Math.min(s.engineUpdatesHistory.length,r),s.engineElapsedHistory.unshift(n.timing.lastElapsed),s.engineElapsedHistory.length=Math.min(s.engineElapsedHistory.length,r),s.elapsedHistory.unshift(s.lastElapsed),s.elapsedHistory.length=Math.min(s.elapsedHistory.length,r)},h=function(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length||0},d=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},f=function(e){var t=e.getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},p=function(e,t){var n=e.textures[t];return n||((n=e.textures[t]=new Image).src=t,n)},g=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}()},function(e,t,n){var i={};e.exports=i;var s=n(5),r=n(17),a=n(0);!function(){i._maxFrameDelta=1e3/15,i._frameDeltaFallback=1e3/60,i._timeBufferMargin=1.5,i._elapsedNextEstimate=1,i._smoothingLowerBound=.1,i._smoothingUpperBound=.9,i.create=function(e){var t=a.extend({delta:1e3/60,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:1e3/30,lastUpdatesDeferred:0,enabled:!0},e);return t.fps=0,t},i.run=function(e,t){return e.timeBuffer=i._frameDeltaFallback,function n(s){e.frameRequestId=i._onNextFrame(e,n),s&&e.enabled&&i.tick(e,t,s)}(),e},i.tick=function(t,n,o){var l=a.now(),u=t.delta,c=0,h=o-t.timeLastTick;if((!h||!t.timeLastTick||h>Math.max(i._maxFrameDelta,t.maxFrameTime))&&(h=t.frameDelta||i._frameDeltaFallback),t.frameDeltaSmoothing){t.frameDeltaHistory.push(h),t.frameDeltaHistory=t.frameDeltaHistory.slice(-t.frameDeltaHistorySize);var d=t.frameDeltaHistory.slice(0).sort(),f=t.frameDeltaHistory.slice(d.length*i._smoothingLowerBound,d.length*i._smoothingUpperBound);h=e(f)||h}t.frameDeltaSnapping&&(h=1e3/Math.round(1e3/h)),t.frameDelta=h,t.timeLastTick=o,t.timeBuffer+=t.frameDelta,t.timeBuffer=a.clamp(t.timeBuffer,0,t.frameDelta+u*i._timeBufferMargin),t.lastUpdatesDeferred=0;var p=t.maxUpdates||Math.ceil(t.maxFrameTime/u),g={timestamp:n.timing.timestamp};s.trigger(t,"beforeTick",g),s.trigger(t,"tick",g);for(var y=a.now();u>0&&t.timeBuffer>=u*i._timeBufferMargin;){s.trigger(t,"beforeUpdate",g),r.update(n,u),s.trigger(t,"afterUpdate",g),t.timeBuffer-=u,c+=1;var m=a.now()-l,x=a.now()-y,v=m+i._elapsedNextEstimate*x/c;if(c>=p||v>t.maxFrameTime){t.lastUpdatesDeferred=Math.round(Math.max(0,t.timeBuffer/u-i._timeBufferMargin));break}}n.timing.lastUpdatesPerFrame=c,s.trigger(t,"afterTick",g),t.frameDeltaHistory.length>=100&&(t.lastUpdatesDeferred&&Math.round(t.frameDelta/u)>p?a.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):t.lastUpdatesDeferred&&a.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),void 0!==t.isFixed&&a.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(t.deltaMin||t.deltaMax)&&a.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),0!==t.fps&&a.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},i.stop=function(e){i._cancelNextFrame(e)},i._onNextFrame=function(e,t){if("undefined"==typeof window||!window.requestAnimationFrame)throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return e.frameRequestId=window.requestAnimationFrame(t),e.frameRequestId},i._cancelNextFrame=function(e){if("undefined"==typeof window||!window.cancelAnimationFrame)throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.");window.cancelAnimationFrame(e.frameRequestId)};var e=function(e){for(var t=0,n=e.length,i=0;i<n;i+=1)t+=e[i];return t/n||0}}()},function(e,t,n){var i={};e.exports=i;var s=n(8),r=n(0).deprecated;i.collides=function(e,t){return s.collides(e,t)},r(i,"collides","SAT.collides  replaced by Collision.collides")},function(e,t,n){var i={};e.exports=i,n(1);var s=n(0);i.pathToVertices=function(e,t){"undefined"==typeof window||"SVGPathSeg"in window||s.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,r,a,o,l,u,c,h,d,f,p,g=[],y=0,m=0,x=0;t=t||15;var v=function(e,t,n){var i=n%2==1&&n>1;if(!d||e!=d.x||t!=d.y){d&&i?(f=d.x,p=d.y):(f=0,p=0);var s={x:f+e,y:p+t};!i&&d||(d=s),g.push(s),m=f+e,x=p+t}},b=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":m=e.x,x=e.y;break;case"H":m=e.x;break;case"V":x=e.y}v(m,x,e.pathSegType)}};for(i._svgPathToAbsolute(e),a=e.getTotalLength(),u=[],n=0;n<e.pathSegList.numberOfItems;n+=1)u.push(e.pathSegList.getItem(n));for(c=u.concat();y<a;){if((l=u[e.getPathSegAtLength(y)])!=h){for(;c.length&&c[0]!=l;)b(c.shift());h=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":o=e.getPointAtLength(y),v(o.x,o.y,0)}y+=t}for(n=0,r=c.length;n<r;++n)b(c[n]);return g},i._svgPathToAbsolute=function(e){for(var t,n,i,s,r,a,o=e.pathSegList,l=0,u=0,c=o.numberOfItems,h=0;h<c;++h){var d=o.getItem(h),f=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in d&&(l=d.x),"y"in d&&(u=d.y);else switch("x1"in d&&(i=l+d.x1),"x2"in d&&(r=l+d.x2),"y1"in d&&(s=u+d.y1),"y2"in d&&(a=u+d.y2),"x"in d&&(l+=d.x),"y"in d&&(u+=d.y),f){case"m":o.replaceItem(e.createSVGPathSegMovetoAbs(l,u),h);break;case"l":o.replaceItem(e.createSVGPathSegLinetoAbs(l,u),h);break;case"h":o.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),h);break;case"v":o.replaceItem(e.createSVGPathSegLinetoVerticalAbs(u),h);break;case"c":o.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,u,i,s,r,a),h);break;case"s":o.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,u,r,a),h);break;case"q":o.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,u,i,s),h);break;case"t":o.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,u),h);break;case"a":o.replaceItem(e.createSVGPathSegArcAbs(l,u,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),h);break;case"z":case"Z":l=t,u=n}"M"!=f&&"m"!=f||(t=l,n=u)}}},function(e,t,n){var i={};e.exports=i;var s=n(6);n(0),i.create=s.create,i.add=s.add,i.remove=s.remove,i.clear=s.clear,i.addComposite=s.addComposite,i.addBody=s.addBody,i.addConstraint=s.addConstraint}])},ke.exports=Ce());class Be{children=[];addChild(e){this.children.push(e)}removeChild(e){const t=this.children.indexOf(e);t>-1&&this.children.splice(t,1)}}class Ie{renderer;scene;camera;physics;physicsObjects=[];isRunning=!1;animationFrameId=null;frameCount=0;lastTime=0;fps=60;qualityLevel=1;audioData={frequency:new Array(64).fill(0),amplitude:0,bass:0,mid:0,treble:0};constructor(){this.physics=Pe.Engine.create({gravity:{x:0,y:-.5,scale:.001}})}async init(e){try{console.log(" Initializing WebGL Scene Manager..."),console.log("Canvas dimensions:",e.width,"x",e.height),console.log("Canvas client dimensions:",e.clientWidth,"x",e.clientHeight),0!==e.width&&0!==e.height||(e.width=e.clientWidth||window.innerWidth,e.height=e.clientHeight||window.innerHeight,console.log(" Updated canvas dimensions to:",e.width,"x",e.height)),this.renderer=new $({canvas:e,width:e.clientWidth,height:e.clientHeight,alpha:!0,antialias:!0,premultipliedAlpha:!1}),this.scene=new Be,this.camera=new me,this.camera.position.z=5,this.renderer.setSize(e.clientWidth,e.clientHeight),this.renderer.setClearColor(0,0);return new ResizeObserver(()=>{this.handleResize(e)}).observe(e),console.log(" WebGL Scene Manager initialized successfully"),Promise.resolve()}catch(t){return console.error(" Failed to initialize WebGL Scene Manager:",t),Promise.reject(t)}}handleResize(e){const t=e.clientWidth,n=e.clientHeight;this.renderer.setSize(t,n),this.camera.perspective({aspect:t/n})}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animate(),console.log(" WebGL Scene Manager started"))}stop(){this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),console.log(" WebGL Scene Manager stopped")}animate(){if(!this.isRunning)return;const e=performance.now(),t=e-this.lastTime;this.lastTime=e,Pe.Engine.update(this.physics,t),this.updatePhysicsObjects(),this.renderer.render({scene:this.scene,camera:this.camera}),this.updatePerformance(t),this.animationFrameId=requestAnimationFrame(()=>this.animate())}updatePhysicsObjects(){this.physicsObjects.forEach(e=>{e.body&&e.mesh&&(e.mesh.position.x=.01*e.body.position.x,e.mesh.position.y=.01*e.body.position.y,e.mesh.rotation.z=e.body.angle)})}updatePerformance(e){this.frameCount++,this.frameCount%60==0&&(this.fps=1e3/e,this.fps<30&&this.qualityLevel>.5?(this.qualityLevel=Math.max(.5,this.qualityLevel-.1),console.log(` Performance drop detected, reducing quality to ${this.qualityLevel}`)):this.fps>55&&this.qualityLevel<1&&(this.qualityLevel=Math.min(1,this.qualityLevel+.05),console.log(` Performance good, increasing quality to ${this.qualityLevel}`)))}updateAudioData(e){this.audioData=e}addPhysicsObject(e){this.physicsObjects.push(e),Pe.Composite.add(this.physics.world,e.body),this.scene.addChild(e.mesh)}removePhysicsObject(e){const t=this.physicsObjects.indexOf(e);t>-1&&(this.physicsObjects.splice(t,1),Pe.Composite.remove(this.physics.world,e.body),this.scene.removeChild(e.mesh))}getPerformanceStats(){return{fps:Math.round(this.fps),qualityLevel:this.qualityLevel,objectCount:this.physicsObjects.length}}destroy(){this.stop(),this.physicsObjects.forEach(e=>{this.scene.removeChild(e.mesh)}),this.physicsObjects=[],Pe.Engine.clear(this.physics),console.log(" WebGL Scene Manager destroyed")}}const Te={vertex:"\n    attribute vec3 position;\n    attribute vec2 uv;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    varying vec2 vUv;\n    \n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragment:"\n    precision highp float;\n    varying vec2 vUv;\n    uniform float time;\n    uniform vec3 color;\n    \n    void main() {\n      float alpha = 1.0 - length(vUv - vec2(0.5));\n      alpha = smoothstep(0.0, 0.5, alpha);\n      gl_FragColor = vec4(color, alpha * 0.8);\n    }\n  "},Ee={vertex:"\n    attribute vec3 position;\n    attribute vec2 uv;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform float time;\n    varying vec2 vUv;\n    varying float vTime;\n    \n    void main() {\n      vUv = uv;\n      vTime = time;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragment:"\n    precision highp float;\n    varying vec2 vUv;\n    varying float vTime;\n    uniform vec3 color;\n    \n    void main() {\n      float wave = sin(vUv.x * 10.0 + vTime) * 0.5 + 0.5;\n      float alpha = smoothstep(0.0, 0.3, wave) * 0.6;\n      gl_FragColor = vec4(color, alpha);\n    }\n  "};class Fe{static time=0;static updateTime(e){this.time+=e}static createParticle(e=0,t=0,n=.1,i=[.5,.8,1]){const s=Pe.Bodies.circle(e,t,50*n,{restitution:.8,friction:.1,density:.001}),r=new Se,a=new W({vertex:Te.vertex,fragment:Te.fragment,uniforms:{time:{value:0},color:{value:i}}}),o=new we({geometry:r,program:a});return o.scale.set(n,n,1),{body:s,mesh:o,type:"particle"}}static createFluidParticle(e=0,t=0,n=.15,i=[.2,.6,.9]){const s=Pe.Bodies.circle(e,t,40*n,{restitution:.3,friction:.8,density:.002,frictionAir:.1}),r=new Se,a=new W({vertex:Ee.vertex,fragment:Ee.fragment,uniforms:{time:{value:0},color:{value:i}}}),o=new we({geometry:r,program:a});return o.scale.set(n,n,1),{body:s,mesh:o,type:"fluid"}}static createSoftBody(e=0,t=0,n=.2,i=[.8,.4,.8]){const s=Pe.Bodies.rectangle(e,t,100*n,100*n,{restitution:.6,friction:.3,density:.001,chamfer:{radius:10}}),r=new Me,a=new W({vertex:Te.vertex,fragment:Te.fragment,uniforms:{time:{value:0},color:{value:i}}}),o=new we({geometry:r,program:a});return o.scale.set(n,n,n),{body:s,mesh:o,type:"softBody"}}static createParticleSystem(e=20,t,n="particle"){const i=[];for(let s=0;s<e;s++){const e=t.x+Math.random()*t.width,s=t.y+Math.random()*t.height,r=.05+.1*Math.random();let a;switch(n){case"fluid":a=this.createFluidParticle(e,s,r);break;case"softBody":a=this.createSoftBody(e,s,r);break;default:a=this.createParticle(e,s,r)}i.push(a)}return i}static createBoundary(e,t,n,i,s=!0){return Pe.Bodies.rectangle(e,t,n,i,{isStatic:s,render:{fillStyle:"transparent",strokeStyle:"transparent"}})}static updateShaders(e){this.updateTime(e)}}class Re{audioContext=null;analyser=null;dataArray=null;frequencyArray=null;_isConnected=!1;constructor(){this.audioContext=null,this.analyser=null,this.dataArray=null,this.frequencyArray=null}async connect(e){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=128,this.analyser.smoothingTimeConstant=.8;const t=this.analyser.frequencyBinCount;if(this.dataArray=new Uint8Array(t),this.frequencyArray=new Float32Array(t),e){this.audioContext.createMediaElementSource(e).connect(this.analyser),this.analyser.connect(this.audioContext.destination)}return this._isConnected=!0,console.log(" Audio Visual Bridge connected successfully"),!0}catch(t){return console.error(" Failed to connect Audio Visual Bridge:",t),!1}}connectToAudioContext(e,t){try{this.audioContext=e,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=128,this.analyser.smoothingTimeConstant=.8;const n=this.analyser.frequencyBinCount;return this.dataArray=new Uint8Array(n),this.frequencyArray=new Float32Array(n),t.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this._isConnected=!0,console.log(" Audio Visual Bridge connected to existing audio context"),!0}catch(n){return console.error(" Failed to connect Audio Visual Bridge to audio context:",n),!1}}getAudioData(){if(!(this._isConnected&&this.analyser&&this.dataArray&&this.frequencyArray))return{frequency:new Array(64).fill(0),amplitude:0,bass:0,mid:0,treble:0};this.analyser.getFloatFrequencyData(this.frequencyArray),this.analyser.getByteFrequencyData(this.dataArray);let e=0;for(let r=0;r<this.dataArray.length;r++)e+=this.dataArray[r];const t=e/this.dataArray.length/255,n=this.calculateFrequencyBand(0,8),i=this.calculateFrequencyBand(8,32),s=this.calculateFrequencyBand(32,64);return{frequency:Array.from(this.frequencyArray).slice(0,64).map(e=>Math.max(0,(e+140)/140)),amplitude:t,bass:n,mid:i,treble:s}}calculateFrequencyBand(e,t){if(!this.dataArray)return 0;let n=0;for(let i=e;i<Math.min(t,this.dataArray.length);i++)n+=this.dataArray[i];return n/(t-e)/255}getAmplitude(){return this.getAudioData().amplitude}getBassLevel(){return this.getAudioData().bass}getMidLevel(){return this.getAudioData().mid}getTrebleLevel(){return this.getAudioData().treble}getFrequencySpectrum(){return this.getAudioData().frequency}isConnected(){return this._isConnected}disconnect(){this.analyser&&this.analyser.disconnect(),this.audioContext&&this.audioContext.close(),this._isConnected=!1,this.audioContext=null,this.analyser=null,this.dataArray=null,this.frequencyArray=null,console.log(" Audio Visual Bridge disconnected")}}class De{sceneManager;audioBridge;canvas=null;isInitialized=!1;currentScene="particles";config;constructor(e={}){this.sceneManager=new Ie,this.audioBridge=new Re,this.config={sceneType:"particles",particleCount:30,audioReactivity:!0,quality:"medium",...e}}async init(e){try{console.log(" Visual Manager init started..."),this.canvas=e,console.log(" Initializing WebGL scene manager..."),await this.sceneManager.init(e),console.log(" WebGL scene manager initialized"),console.log(" Attempting to initialize audio bridge...");try{await this.audioBridge.connect(),console.log(" Audio bridge initialized")}catch(t){console.warn(" Audio bridge failed to initialize (this is optional):",t)}return this.isInitialized=!0,console.log(" Visual Manager initialized successfully"),!0}catch(n){return console.error(" Failed to initialize Visual Manager:",n),!1}}start(){this.isInitialized?(console.log(" Starting Visual Manager..."),console.log(" Creating initial scene..."),this.createScene(this.currentScene),this.sceneManager.start(),console.log(" Visual Manager started")):console.warn(" Visual Manager not initialized, cannot start")}stop(){this.sceneManager.stop(),console.log(" Visual Manager stopped")}setScene(e){this.isInitialized&&(this.currentScene=e,this.clearScene(),this.createScene(e),console.log(` Scene changed to: ${e}`))}clearScene(){const e=this.sceneManager.getPerformanceStats();for(let t=0;t<e.objectCount;t++);}createScene(e){if(console.log(" Creating scene:",e),!this.canvas)return void console.error(" No canvas available for scene creation");console.log(" Canvas dimensions:",this.canvas.width,"x",this.canvas.height);const t={x:-this.canvas.width/2,y:-this.canvas.height/2,width:this.canvas.width,height:this.canvas.height};let n;switch(console.log(" Scene bounds:",t),Fe.createBoundary(t.x-50,t.y+t.height/2,100,t.height),Fe.createBoundary(t.x+t.width+50,t.y+t.height/2,100,t.height),Fe.createBoundary(t.x+t.width/2,t.y-50,t.width,100),Fe.createBoundary(t.x+t.width/2,t.y+t.height+50,t.width,100),e){case"fluid":n=Fe.createParticleSystem(this.config.particleCount,t,"fluid");break;case"softBody":n=Fe.createParticleSystem(this.config.particleCount,t,"softBody");break;case"mixed":const e=Fe.createParticleSystem(Math.floor(this.config.particleCount/3),t,"fluid"),i=Fe.createParticleSystem(Math.floor(this.config.particleCount/3),t,"softBody"),s=Fe.createParticleSystem(this.config.particleCount-e.length-i.length,t,"particle");n=[...e,...i,...s];break;default:n=Fe.createParticleSystem(this.config.particleCount,t,"particle")}console.log(" Adding",n.length,"particles to scene"),n.forEach((e,t)=>{this.sceneManager.addPhysicsObject(e),t<3&&console.log(" Added particle",t,"at position:",e.body.position)}),console.log(" Scene creation complete")}updateAudioData(e){this.config.audioReactivity&&this.sceneManager.updateAudioData(e)}connectToAudioContext(e,t){return this.audioBridge.connectToAudioContext(e,t)}getPerformanceStats(){return this.sceneManager.getPerformanceStats()}setConfig(e){this.config={...this.config,...e},this.isInitialized&&e.sceneType&&this.setScene(e.sceneType)}destroy(){this.stop(),this.audioBridge.disconnect(),this.sceneManager.destroy(),this.isInitialized=!1,console.log(" Visual Manager destroyed")}}var Le=i('<div class="text-2xl text-green-400 mb-8">Break Complete! </div>'),Oe=i('<div class="text-xl text-blue-300 mb-8">Take a moment to breathe and reset...</div>'),Ve=i('<p class="italic"> </p>'),qe=i('<p class="text-gray-400 italic">Waiting for wisdom...</p>'),Ye=i('<section class="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex flex-col items-center justify-center p-4 text-white relative"><canvas class="absolute inset-0 w-full h-full pointer-events-none" style="z-index: 1;"></canvas> <div class="text-center space-y-8 max-w-2xl relative" style="z-index: 2;"><h1 class="text-4xl font-bold mb-8"> Micro-Break</h1> <div class="text-6xl font-mono font-bold mb-8"> </div> <!> <div class="max-w-xl text-balance text-lg rounded-lg bg-white/10 p-6 shadow-lg backdrop-blur-sm min-h-[120px] flex items-center justify-center"><!></div> <button class="mt-8 px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg transition-colors">End Break</button></div></section>');function je(i,M){e(M,!1),console.log(" Session page script loading..."),console.log(" Session page imports completed");let k,C,P=m(60),B=m(""),I=null,T=!1,E=null,F=m(!1),R=m(),D=!1;function L(){if(!I||p(P)<=0||p(F))return;if(T)return void(E=window.setTimeout(()=>{p(F)||L()},1e3));const e=A.getNextQuoteTime();E=window.setTimeout(()=>{p(F)||O()},e)}async function O(){if(p(F)||T)return;const e=A.getQuote({persona:I?.persona||"student",intensity:I?.roastIntensity||4,profanity:"off"});if(e){y(B,e.text),T=!0;try{if("character"===I?.selectedVoiceType&&I?.selectedVoiceId){await S.speakWithCharacter(p(B),I.selectedVoiceId);const e=setInterval(()=>{S.isCurrentlyPlaying()||(clearInterval(e),T=!1,p(F)||L())},100)}else if("ai"===I?.selectedVoiceType&&I?.selectedVoiceId){const e={voiceId:I.selectedVoiceId,pitch:I.aiVoicePitch||0,rate:I.aiVoiceRate||0,volume:I.aiVoiceVolume||80};await _.speak(p(B),e);const t=setInterval(()=>{_.isCurrentlyPlaying()||(clearInterval(t),T=!1,p(F)||L())},100)}else{const e=new SpeechSynthesisUtterance(p(B));if(e.rate=I?.voiceRate||1,e.pitch=I?.voicePitch||1,e.volume=.7,I&&I.selectedVoiceId&&"undefined"!=typeof speechSynthesis){const t=speechSynthesis.getVoices(),n=I.selectedVoiceId,i=t.find(e=>e.voiceURI===n);i&&(e.voice=i)}e.onend=()=>{T=!1,p(F)||L()},e.onerror=()=>{T=!1,p(F)||L()},speechSynthesis.speak(e)}}catch(t){console.error("Failed to speak quote:",t),T=!1,p(F)||L()}}}t(()=>{console.log(" Session page onMount started!"),console.log(" Current URL:",window.location.href),console.log(" Page pathname:",window.location.pathname),speechSynthesis.cancel(),S.stop(),_.stop();const e=w.subscribe(e=>{I=e,e&&y(P,60*e.durationMinutes)});console.log(" Setting up WebGL initialization timeout..."),setTimeout(async()=>{console.log(" Checking canvas availability..."),console.log("Canvas element:",p(R)),p(R)?(console.log(" Canvas found, setting dimensions..."),x(R,p(R).width=p(R).clientWidth||window.innerWidth),x(R,p(R).height=p(R).clientHeight||window.innerHeight),console.log(" Canvas dimensions set to:",p(R).width,"x",p(R).height),await async function(){if(console.log(" Starting WebGL Visual System initialization..."),console.log("Canvas element:",p(R)),console.log("Canvas dimensions:",p(R)?.width,"x",p(R)?.height),!p(R))return void console.error(" Canvas element not found!");x(R,p(R).width=p(R).clientWidth||window.innerWidth),x(R,p(R).height=p(R).clientHeight||window.innerHeight);try{C=new De({sceneType:"particles",particleCount:100,audioReactivity:!0,quality:"high"}),console.log(" Visual Manager created, initializing..."),D=await C.init(p(R)),console.log(" Initialization result:",D),D?(console.log(" WebGL Visual System started for session"),C.start()):console.warn(" WebGL Visual System failed to initialize")}catch(e){console.error(" Failed to initialize WebGL Visual System:",e),console.error("Error details:",e)}}()):console.error(" Canvas element not found after timeout!")},100);const t=A.getInitialDelay();return E=window.setTimeout(()=>{p(F)||O()},t),k=setInterval(()=>{p(P)>0&&(y(P,p(P)-1),0===p(P)&&(y(F,!0),speechSynthesis.cancel(),_.stop(),S.stop(),T=!1,E&&(clearTimeout(E),E=null),C&&C.stop()))},1e3),()=>{clearInterval(k),E&&clearTimeout(E),C&&(C.stop(),C.destroy()),e()}}),n();var V=Ye();s(e=>{h.title="Micro-Break - Sarcastic Serenity"});var q=f(V);r(q,e=>y(R,e),()=>p(R));var Y=d(q,2),j=d(f(Y),2),U=f(j);v(j);var z=d(j,2),W=e=>{var t=Le();u(e,t)},N=e=>{var t=Oe();u(e,t)};a(z,e=>{p(F)?e(W):e(N,!1)});var G=d(z,2),H=f(G),X=e=>{var t=Ve(),n=f(t);v(t),o(()=>g(n,`"${p(B)??""}"`)),u(e,t)},Q=e=>{var t=qe();u(e,t)};a(H,e=>{p(B)?e(X):e(Q,!1)}),v(G);var Z=d(G,2);v(Y),v(V),o((e,t)=>g(U,`${e??""}:${t??""}`),[()=>Math.floor(p(P)/60),()=>String(p(P)%60).padStart(2,"0")]),l("click",Z,function(){y(F,!0),speechSynthesis.cancel(),T=!1,E&&(clearTimeout(E),E=null),b("/")}),u(i,V),c()}export{je as component};
