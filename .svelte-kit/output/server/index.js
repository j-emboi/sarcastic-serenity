import{B as e,r as t,w as r}from"./chunks/vendor.js";import{json as s,text as n,error as a}from"@sveltejs/kit";import{HttpError as o,SvelteKitError as i,Redirect as c,ActionFailure as l}from"@sveltejs/kit/internal";import{a as u,b as d,c as p,o as h,r as f,p as m}from"./chunks/environment.js";import{w as _,v as y,g,s as w,p as v,T as $,I as b,E as k,c as j}from"./chunks/event-state.js";import*as E from"devalue";import{m as x,d as R,a as S,v as O,b as q,c as T,e as P,n as A,r as C,f as H,g as U}from"./chunks/exports.js";import{b as N,t as L,a as W,g as z}from"./chunks/utils.js";import{p as D,s as I,r as M,o as F,g as G,a as J,b as B,c as V,d as K}from"./chunks/internal.js";import{parse as Q,serialize as X}from"cookie";import*as Y from"set-cookie-parser";const Z=["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"],ee=["GET","POST","HEAD"];function te(e,t){const r=[];let s;e.split(",").forEach((e,t)=>{const s=/([^/ \t]+)\/([^; \t]+)[ \t]*(?:;[ \t]*q=([0-9.]+))?/.exec(e);if(s){const[,e,n,a="1"]=s;r.push({type:e,subtype:n,q:+a,i:t})}}),r.sort((e,t)=>e.q!==t.q?t.q-e.q:"*"===e.subtype!=("*"===t.subtype)?"*"===e.subtype?1:-1:"*"===e.type!=("*"===t.type)?"*"===e.type?1:-1:e.i-t.i);let n=1/0;for(const a of t){const[e,t]=a.split("/"),o=r.findIndex(r=>!(r.type!==e&&"*"!==r.type||r.subtype!==t&&"*"!==r.subtype));-1!==o&&o<n&&(s=a,n=o)}return s}function re(e){return function(e,...t){const r=e.headers.get("content-type")?.split(";",1)[0].trim()??"";return t.includes(r.toLowerCase())}(e,"application/x-www-form-urlencoded","multipart/form-data","text/plain")}function se(e){return e}function ne(e){return e instanceof o||e instanceof i?e.status:500}const ae={"&":"&amp;",'"':"&quot;"},oe={"&":"&amp;","<":"&lt;"},ie="[\\ud800-\\udbff](?![\\udc00-\\udfff])|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\udc00-\\udfff]",ce=new RegExp(`[${Object.keys(ae).join("")}]|`+ie,"g"),le=new RegExp(`[${Object.keys(oe).join("")}]|`+ie,"g");function ue(e,t){const r=t?ae:oe;return e.replace(t?ce:le,e=>2===e.length?e:r[e]??`&#${e.charCodeAt(0)};`)}function de(e,t){return n(`${t} method not allowed`,{status:405,headers:{allow:pe(e).join(", ")}})}function pe(e){const t=Z.filter(t=>t in e);return("GET"in e||"HEAD"in e)&&t.push("HEAD"),t}function he(e,t,r){let s=e.templates.error({status:t,message:ue(r)});return n(s,{headers:{"content-type":"text/html; charset=utf-8"},status:t})}async function fe(e,t,r){var n;const a=ne(r=r instanceof o?r:(n=r)instanceof Error||n&&n.name&&n.message?n:new Error(JSON.stringify(n))),i=await me(e,t,r),c=te(e.request.headers.get("accept")||"text/html",["application/json","text/html"]);return e.isDataRequest||"application/json"===c?s(i,{status:a}):he(t,a,i.message)}async function me(e,t,r){if(r instanceof o)return r.body;const s=ne(r),n=function(e){return e instanceof i?e.text:"Internal Error"}(r);return await _(e,()=>t.hooks.handleError({error:r,event:e,status:s,message:n}))??{message:n}}function _e(e,t){return new Response(void 0,{status:e,headers:{location:t}})}function ye(e,t){return t.path?`Data returned from \`load\` while rendering ${e.route.id} is not serializable: ${t.message} (${t.path}). If you need to serialize/deserialize custom types, use transport hooks: https://svelte.dev/docs/kit/hooks#Universal-hooks-transport.`:""===t.path?`Data returned from \`load\` while rendering ${e.route.id} is not a plain object`:t.message}function ge(e){const t={};return e.uses&&e.uses.dependencies.size>0&&(t.dependencies=Array.from(e.uses.dependencies)),e.uses&&e.uses.search_params.size>0&&(t.search_params=Array.from(e.uses.search_params)),e.uses&&e.uses.params.size>0&&(t.params=Array.from(e.uses.params)),e.uses?.parent&&(t.parent=1),e.uses?.route&&(t.route=1),e.uses?.url&&(t.url=1),t}function we(e,t){return e._.prerendered_routes.has(t)||"/"===t.at(-1)&&e._.prerendered_routes.has(t.slice(0,-1))}function ve(e){return e.filter(e=>null!=e)}const $e="/__data.json",be=".html__data.json";function ke(e){return e.endsWith(".html")?e.replace(/\.html$/,be):e.replace(/\/$/,"")+$e}const je="/__route.js";function Ee(e){return e.replace(/\/$/,"")+je}function xe(e){return"application/json"===te(e.request.headers.get("accept")??"*/*",["application/json","text/html"])&&"POST"===e.request.method}function Re(e){return e instanceof l?new Error('Cannot "throw fail()". Use "return fail()"'):e}function Se(e){return Oe({type:"redirect",status:e.status,location:e.location})}function Oe(e,t){return s(e,t)}function qe(e){if(e.default&&Object.keys(e).length>1)throw new Error("When using named actions, the default action cannot be used. See the docs for more info: https://svelte.dev/docs/kit/form-actions#named-actions")}async function Te(e,t){const r=new URL(e.request.url);let s="default";for(const a of r.searchParams)if(a[0].startsWith("/")){if(s=a[0].slice(1),"default"===s)throw new Error('Cannot use reserved action name "default"');break}const n=t[s];if(!n)throw new i(404,"Not Found",`No action with name '${s}' found`);if(!re(e.request))throw new i(415,"Unsupported Media Type",`Form actions expect form-encoded data — received ${e.request.headers.get("content-type")}`);return _(e,()=>n(e))}function Pe(e,t,r){const s=Object.fromEntries(Object.entries(r).map(([e,t])=>[e,t.encode]));return Ae(e,e=>E.stringify(e,s),t)}function Ae(e,t,r){try{return t(e)}catch(s){const t=s;if(e instanceof Response)throw new Error(`Data returned from action inside ${r} is not serializable. Form actions need to return plain objects or fail(). E.g. return { success: true } or return fail(400, { message: "invalid" });`);if("path"in t){let e=`Data returned from action inside ${r} is not serializable: ${t.message}`;throw""!==t.path&&(e+=` (data.${t.path})`),new Error(e)}throw t}}async function Ce({event:t,state:r,node:s,parent:n}){if(!s?.server)return null;let a=!0;const o={dependencies:new Set,params:new Set,parent:!1,route:!1,url:!1,search_params:new Set},i=s.server.load,c=s.server.trailingSlash;if(!i)return{type:"data",data:null,uses:o,slash:c};const l=x(t.url,()=>{a&&(o.url=!0)},e=>{a&&o.search_params.add(e)});r.prerendering&&R(l);let u=!1;const d=await _(t,()=>i.call(null,{...t,fetch:(r,s)=>{const n=new URL(r instanceof Request?r.url:r,t.url);return e&&u&&o.dependencies.has(n.href),t.fetch(r,s)},depends:(...e)=>{for(const r of e){const{href:e}=new URL(r,t.url);o.dependencies.add(e)}},params:new Proxy(t.params,{get:(t,r)=>(e&&u&&"string"==typeof r&&o.params.has(r),a&&o.params.add(r),t[r])}),parent:async()=>(e&&u&&o.parent,a&&(o.parent=!0),n()),route:new Proxy(t.route,{get:(t,r)=>(e&&u&&"string"==typeof r&&o.route,a&&(o.route=!0),t[r])}),url:l,untrack(e){a=!1;try{return e()}finally{a=!0}}}));return u=!0,{type:"data",data:d??null,uses:o,slash:c}}async function He({event:e,fetched:t,node:r,parent:s,server_data_promise:n,state:a,resolve_opts:o,csr:i}){const c=await n,l=r?.universal?.load;if(!l)return c?.data??null;return await _(e,()=>l.call(null,{url:e.url,params:e.params,data:c?.data??null,route:e.route,fetch:Ue(e,a,t,i,o),setHeaders:e.setHeaders,depends:()=>{},parent:s,untrack:e=>e()}))??null}function Ue(e,t,r,s,n){return(a,o)=>{const i=(async(a,o)=>{const i=a instanceof Request&&a.body?a.clone().body:null,c=a instanceof Request&&[...a.headers].length?new Headers(a.headers):o?.headers;let l=await e.fetch(a,o);const u=new URL(a instanceof Request?a.url:a,e.url),d=u.origin===e.url.origin;let p;if(d)t.prerendering&&(p={response:l,body:null},t.prerendering.dependencies.set(u.pathname,p));else if("https:"===u.protocol||"http:"===u.protocol)if("no-cors"===(a instanceof Request?a.mode:o?.mode??"cors"))l=new Response("",{status:l.status,statusText:l.statusText,headers:l.headers});else{const t=l.headers.get("access-control-allow-origin");if(!t||t!==e.url.origin&&"*"!==t)throw new Error(`CORS error: ${t?"Incorrect":"No"} 'Access-Control-Allow-Origin' header is present on the requested resource`)}const h=new Proxy(l,{get(t,s,n){async function l(s,n){const l=Number(t.status);if(isNaN(l))throw new Error(`response.status is not a number. value: "${t.status}" type: ${typeof t.status}`);r.push({url:d?u.href.slice(e.url.origin.length):u.href,method:e.request.method,request_body:a instanceof Request&&i?await Ne(i):o?.body,request_headers:c,response_body:s,response:t,is_b64:n})}if("arrayBuffer"===s)return async()=>{const e=await t.arrayBuffer(),r=new Uint8Array(e);return p&&(p.body=r),e instanceof ArrayBuffer&&await l(N(r),!0),e};async function h(){const e=await t.text();return e&&"string"!=typeof e||await l(e,!1),p&&(p.body=e),e}return"text"===s?h:"json"===s?async()=>JSON.parse(await h()):Reflect.get(t,s,t)}});if(s){const t=l.headers.get;l.headers.get=r=>{const s=r.toLowerCase(),a=t.call(l.headers,s);if(a&&!s.startsWith("x-sveltekit-")&&!n.filterSerializedResponseHeaders(s,a))throw new Error(`Failed to get response header "${s}" — it must be included by the \`filterSerializedResponseHeaders\` option: https://svelte.dev/docs/kit/hooks#Server-hooks-handle (at ${e.route.id})`);return a}}return h})(a,o);return i.catch(()=>{}),i}}async function Ne(e){let t="";const r=e.getReader();for(;;){const{done:e,value:s}=await r.read();if(e)break;t+=L.decode(s)}return t}function Le(...e){let t=5381;for(const r of e)if("string"==typeof r){let e=r.length;for(;e;)t=33*t^r.charCodeAt(--e)}else{if(!ArrayBuffer.isView(r))throw new TypeError("value must be a string or TypedArray");{const e=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);let s=e.length;for(;s;)t=33*t^e[--s]}}return(t>>>0).toString(36)}const We={"<":"\\u003C","\u2028":"\\u2028","\u2029":"\\u2029"},ze=new RegExp(`[${Object.keys(We).join("")}]`,"g");const De=JSON.stringify;function Ie(e){Fe[0]||function(){function e(e){return 4294967296*(e-Math.floor(e))}let t=2;for(let r=0;r<64;t++){let s=!0;for(let e=2;e*e<=t;e++)if(t%e===0){s=!1;break}s&&(r<8&&(Me[r]=e(t**.5)),Fe[r]=e(t**(1/3)),r++)}}();const t=Me.slice(0),r=function(e){const t=W.encode(e),r=8*t.length,s=512*Math.ceil((r+65)/512),n=new Uint8Array(s/8);n.set(t),n[t.length]=128,Ge(n);const a=new Uint32Array(n.buffer);return a[a.length-2]=Math.floor(r/4294967296),a[a.length-1]=r,a}(e);for(let n=0;n<r.length;n+=16){const e=r.subarray(n,n+16);let s,a,o,i=t[0],c=t[1],l=t[2],u=t[3],d=t[4],p=t[5],h=t[6],f=t[7];for(let t=0;t<64;t++)t<16?s=e[t]:(a=e[t+1&15],o=e[t+14&15],s=e[15&t]=(a>>>7^a>>>18^a>>>3^a<<25^a<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+e[15&t]+e[t+9&15]|0),s=s+f+(d>>>6^d>>>11^d>>>25^d<<26^d<<21^d<<7)+(h^d&(p^h))+Fe[t],f=h,h=p,p=d,d=u+s|0,u=l,l=c,c=i,i=s+(c&l^u&(c^l))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;t[0]=t[0]+i|0,t[1]=t[1]+c|0,t[2]=t[2]+l|0,t[3]=t[3]+u|0,t[4]=t[4]+d|0,t[5]=t[5]+p|0,t[6]=t[6]+h|0,t[7]=t[7]+f|0}const s=new Uint8Array(t.buffer);return Ge(s),btoa(String.fromCharCode(...s))}const Me=new Uint32Array(8),Fe=new Uint32Array(64);function Ge(e){for(let t=0;t<e.length;t+=4){const r=e[t+0],s=e[t+1],n=e[t+2],a=e[t+3];e[t+0]=a,e[t+1]=n,e[t+2]=s,e[t+3]=r}}const Je=new Uint8Array(16);const Be=new Set(["self","unsafe-eval","unsafe-hashes","unsafe-inline","none","strict-dynamic","report-sample","wasm-unsafe-eval","script"]),Ve=/^(nonce|sha\d\d\d)-/;class Ke{#e;#t;#r;#s;#n;#a;#o;#i;#c;#l;#u;#d;#p;#h;#f;constructor(e,t,r){this.#e=e,this.#c=t;const s=this.#c;this.#l=[],this.#u=[],this.#d=[],this.#p=[],this.#h=[];const n=s["script-src"]||s["default-src"],a=s["script-src-elem"],o=s["style-src"]||s["default-src"],i=s["style-src-attr"],c=s["style-src-elem"],l=e=>!!e&&!e.some(e=>"unsafe-inline"===e);this.#r=l(n),this.#s=l(a),this.#a=l(o),this.#o=l(i),this.#i=l(c),this.#t=this.#r||this.#s,this.#n=this.#a||this.#o||this.#i,this.script_needs_nonce=this.#t&&!this.#e,this.style_needs_nonce=this.#n&&!this.#e,this.#f=r}add_script(e){if(!this.#t)return;const t=this.#e?`sha256-${Ie(e)}`:`nonce-${this.#f}`;this.#r&&this.#l.push(t),this.#s&&this.#u.push(t)}add_style(e){if(!this.#n)return;const t=this.#e?`sha256-${Ie(e)}`:`nonce-${this.#f}`;if(this.#a&&this.#d.push(t),this.#o&&this.#p.push(t),this.#i){const e="sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=",r=this.#c;!r["style-src-elem"]||r["style-src-elem"].includes(e)||this.#h.includes(e)||this.#h.push(e),t!==e&&this.#h.push(t)}}get_header(e=!1){const t=[],r={...this.#c};this.#d.length>0&&(r["style-src"]=[...r["style-src"]||r["default-src"]||[],...this.#d]),this.#p.length>0&&(r["style-src-attr"]=[...r["style-src-attr"]||[],...this.#p]),this.#h.length>0&&(r["style-src-elem"]=[...r["style-src-elem"]||[],...this.#h]),this.#l.length>0&&(r["script-src"]=[...r["script-src"]||r["default-src"]||[],...this.#l]),this.#u.length>0&&(r["script-src-elem"]=[...r["script-src-elem"]||[],...this.#u]);for(const s in r){if(e&&("frame-ancestors"===s||"report-uri"===s||"sandbox"===s))continue;const n=r[s];if(!n)continue;const a=[s];Array.isArray(n)&&n.forEach(e=>{Be.has(e)||Ve.test(e)?a.push(`'${e}'`):a.push(e)}),t.push(a.join(" "))}return t.join("; ")}}class Qe extends Ke{get_meta(){const e=this.get_header(!0);if(e)return`<meta http-equiv="content-security-policy" content="${ue(e,!0)}">`}}class Xe extends Ke{constructor(e,t,r){if(super(e,t,r),Object.values(t).filter(e=>!!e).length>0){const e=t["report-to"]?.length??!1,r=t["report-uri"]?.length??!1;if(!e&&!r)throw Error("`content-security-policy-report-only` must be specified with either the `report-to` or `report-uri` directives, or both")}}}class Ye{nonce=function(){return crypto.getRandomValues(Je),btoa(String.fromCharCode(...Je))}();csp_provider;report_only_provider;constructor({mode:e,directives:t,reportOnly:r},{prerender:s}){const n="hash"===e||"auto"===e&&s;this.csp_provider=new Qe(n,t,this.nonce),this.report_only_provider=new Xe(n,r,this.nonce)}get script_needs_nonce(){return this.csp_provider.script_needs_nonce||this.report_only_provider.script_needs_nonce}get style_needs_nonce(){return this.csp_provider.style_needs_nonce||this.report_only_provider.style_needs_nonce}add_script(e){this.csp_provider.add_script(e),this.report_only_provider.add_script(e)}add_style(e){this.csp_provider.add_style(e),this.report_only_provider.add_style(e)}}function Ze(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),fulfil:e,reject:t}}function et(){const e=[Ze()];return{iterator:{[Symbol.asyncIterator]:()=>({next:async()=>{const t=await e[0].promise;return t.done||e.shift(),t}})},push:t=>{e[e.length-1].fulfil({value:t,done:!1}),e.push(Ze())},done:()=>{e[e.length-1].fulfil({done:!0})}}}function tt(e,t,r){const s={},n=e.slice(1),a=n.filter(e=>void 0!==e);let o=0;for(let i=0;i<t.length;i+=1){const e=t[i];let c=n[i-o];if(e.chained&&e.rest&&o&&(c=n.slice(i-o,i+1).filter(e=>e).join("/"),o=0),void 0!==c){if(!e.matcher||r[e.matcher](c)){s[e.name]=c;const r=t[i+1],l=n[i+1];r&&!r.rest&&r.optional&&l&&e.chained&&(o=0),r||l||Object.keys(s).length!==a.length||(o=0);continue}if(!e.optional||!e.chained)return;o++}else e.rest&&(s[e.name]="")}if(!o)return s}function rt(e,t,r){const{errors:s,layouts:n,leaf:a}=e,o=[...s,...n.map(e=>e?.[1]),a[1]].filter(e=>"number"==typeof e).map(e=>`'${e}': () => ${st(r._.client.nodes?.[e],t)}`).join(",\n\t\t");return[`{\n\tid: ${De(e.id)}`,`errors: ${De(e.errors)}`,`layouts: ${De(e.layouts)}`,`leaf: ${De(e.leaf)}`,`nodes: {\n\t\t${o}\n\t}\n}`].join(",\n\t")}function st(e,t){if(!e)return"Promise.resolve({})";if("/"===e[0])return`import('${e}')`;if(""!==u)return`import('${u}/${e}')`;let r=z(t.pathname,`${d}/${e}`);return"."!==r[0]&&(r=`./${r}`),`import('${r}')`}function nt(e,t,r,s){const a=new Headers({"content-type":"application/javascript; charset=utf-8"});if(e){const o=rt(e,r,s),i=`${function(e,t,r){const{errors:s,layouts:n,leaf:a}=e;let o="";for(const i of[...s,...n.map(e=>e?.[1]),a[1]]){if("number"!=typeof i)continue;const e=r._.client.css?.[i];for(const t of e??[])o+=`'${u||d}/${t}',`}return o?`${st(r._.client.start,t)}.then(x => x.load_css([${o}]));`:""}(e,r,s)}\nexport const route = ${o}; export const params = ${JSON.stringify(t)};`;return{response:n(i,{headers:a}),body:i}}return{response:n("",{headers:a}),body:""}}const at={...t(!1),check:()=>!1};async function ot({branch:e,fetched:t,options:s,manifest:a,state:o,page_config:i,status:c,error:l=null,event:m,resolve_opts:y,action_result:w}){if(o.prerendering){if("nonce"===s.csp.mode)throw new Error('Cannot use prerendering if config.kit.csp.mode === "nonce"');if(s.app_template_contains_nonce)throw new Error("Cannot use prerendering if page template contains %sveltekit.nonce%")}const{client:v}=a._,$=new Set(v.imports),b=new Set(v.stylesheets),k=new Set(v.fonts),j=new Set,x=new Map;let R;const S="success"===w?.type||"failure"===w?.type?w.data??null:null;let O=d,q=u,T=De(d);if(o.prerendering?.fallback)s.hash_routing&&(T="new URL('.', location).pathname.slice(0, -1)");else{O=m.url.pathname.slice(d.length).split("/").slice(2).map(()=>"..").join("/")||".",T=`new URL(${De(O)}, location).pathname.slice(0, -1)`,(!u||"/"===u[0]&&"/_svelte_kit_assets"!==u)&&(q=O)}if(i.ssr){const t={stores:{page:r(null),navigating:r(null),updated:at},constructors:await Promise.all(e.map(({node:e})=>{if(!e.component)throw new Error(`Missing +page.svelte component for route ${m.route.id}`);return e.component()})),form:S};let n={};for(let r=0;r<e.length;r+=1)n={...n,...e[r].data},t[`data_${r}`]=n;t.page={error:l,params:m.params,route:m.route,status:c,url:m.url,data:n,form:S,state:{}},h({base:O,assets:q});const a={context:new Map([["__request__",{page:t.page}]])};try{R=_(m,()=>s.root.render(t,a))}finally{f()}for(const{node:r}of e){for(const e of r.imports)$.add(e);for(const e of r.stylesheets)b.add(e);for(const e of r.fonts)k.add(e);r.inline_styles&&!v.inline&&Object.entries(await r.inline_styles()).forEach(([e,t])=>x.set(e,t))}}else R={head:"",html:"",css:{code:"",map:null}};let P="",A=R.html;const C=new Ye(s.csp,{prerender:!!o.prerendering}),H=e=>e.startsWith("/")?d+e:`${q}/${e}`,U=v.inline?v.inline?.style:Array.from(x.values()).join("\n");if(U){const e=[];C.style_needs_nonce&&e.push(` nonce="${C.nonce}"`),C.add_style(U),P+=`\n\t<style${e.join("")}>${U}</style>`}for(const r of b){const e=H(r),t=['rel="stylesheet"'];if(x.has(r))t.push("disabled",'media="(max-width: 0)"');else if(y.preload({type:"css",path:e})){const t=['rel="preload"','as="style"'];j.add(`<${encodeURI(e)}>; ${t.join(";")}; nopush`)}P+=`\n\t\t<link href="${e}" ${t.join(" ")}>`}for(const r of k){const e=H(r);if(y.preload({type:"font",path:e})){P+=`\n\t\t<link ${['rel="preload"','as="font"',`type="font/${r.slice(r.lastIndexOf(".")+1)}"`,`href="${e}"`,"crossorigin"].join(" ")}>`}}const N=`__sveltekit_${s.version_hash}`,{data:L,chunks:z}=function(e,t,r,s,n){let a=1,o=0;const{iterator:i,push:c,done:l}=et();function u(r){if("function"==typeof r?.then){const i=a++;return o+=1,r.then(e=>({data:e})).catch(async r=>({error:await me(e,t,r)})).then(async({data:r,error:a})=>{let d;o-=1;try{d=E.uneval({id:i,data:r,error:a},u)}catch{a=await me(e,t,new Error(`Failed to serialize promise while rendering ${e.route.id}`)),r=void 0,d=E.uneval({id:i,data:r,error:a},u)}const p=s.script_needs_nonce?` nonce="${s.nonce}"`:"";c(`<script${p}>${n}.resolve(${d})<\/script>\n`),0===o&&l()}),`${n}.defer(${i})`}for(const e in t.hooks.transport){const s=t.hooks.transport[e].encode(r);if(s)return`app.decode('${e}', ${E.uneval(s,u)})`}}try{return{data:`[${r.map(e=>{if(!e)return"null";const t={type:"data",data:e.data,uses:ge(e)};return e.slash&&(t.slash=e.slash),E.uneval(t,u)}).join(",")}]`,chunks:o>0?i:null}}catch(d){throw d.path=d.path.slice(1),new Error(ye(e,d))}}(m,s,e.map(e=>e.server_data),C,N);if(i.ssr&&i.csr&&(A+=`\n\t\t\t${t.map(e=>function(e,t,r=!1){const s={};let n=null,a=null,o=!1;for(const[u,d]of e.response.headers)t(u,d)&&(s[u]=d),"cache-control"===u?n=d:"age"===u?a=d:"vary"===u&&"*"===d.trim()&&(o=!0);const i={status:e.response.status,statusText:e.response.statusText,headers:s,body:e.response_body},c=JSON.stringify(i).replace(ze,e=>We[e]),l=['type="application/json"',"data-sveltekit-fetched",`data-url="${ue(e.url,!0)}"`];if(e.is_b64&&l.push("data-b64"),e.request_headers||e.request_body){const t=[];e.request_headers&&t.push([...new Headers(e.request_headers)].join(",")),e.request_body&&t.push(e.request_body),l.push(`data-hash="${Le(...t)}"`)}if(!r&&"GET"===e.method&&n&&!o){const e=/s-maxage=(\d+)/g.exec(n)??/max-age=(\d+)/g.exec(n);if(e){const t=+e[1]-+(a??"0");l.push(`data-ttl="${t}"`)}}return`<script ${l.join(" ")}>${c}<\/script>`}(e,y.filterSerializedResponseHeaders,!!o.prerendering)).join("\n\t\t\t")}`),i.csr){const t=a._.client.routes?.find(e=>e.id===m.route.id)??null;if(v.uses_env_dynamic_public&&o.prerendering&&$.add(`${p}/env.js`),!v.inline){const e=Array.from($,e=>H(e)).filter(e=>y.preload({type:"js",path:e}));for(const t of e)j.add(`<${encodeURI(t)}>; rel="modulepreload"; nopush`),"modulepreload"!==s.preload_strategy?P+=`\n\t\t<link rel="preload" as="script" crossorigin="anonymous" href="${t}">`:o.prerendering&&(P+=`\n\t\t<link rel="modulepreload" href="${t}">`)}if(a._.client.routes&&o.prerendering&&!o.prerendering.fallback){const e=Ee(m.url.pathname);o.prerendering.dependencies.set(e,nt(t,m.params,new URL(e,m.url),a))}const r=[],n=v.uses_env_dynamic_public&&o.prerendering,d=[`base: ${T}`];u&&d.push(`assets: ${De(u)}`),v.uses_env_dynamic_public&&d.push(`env: ${n?"null":De(D)}`),z&&(r.push("const deferred = new Map();"),d.push("defer: (id) => new Promise((fulfil, reject) => {\n\t\t\t\t\t\t\tdeferred.set(id, { fulfil, reject });\n\t\t\t\t\t\t})"),d.push("resolve: ({ id, data, error }) => {\n\t\t\t\t\t\t\tconst try_to_resolve = () => {\n\t\t\t\t\t\t\t\tif (!deferred.has(id)) {\n\t\t\t\t\t\t\t\t\tsetTimeout(try_to_resolve, 0);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst { fulfil, reject } = deferred.get(id);\n\t\t\t\t\t\t\t\tdeferred.delete(id);\n\t\t\t\t\t\t\t\tif (error) reject(error);\n\t\t\t\t\t\t\t\telse fulfil(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttry_to_resolve();\n\t\t\t\t\t\t}"));const{remote_data:h}=g(m);if(h){const e={};for(const r in h)e[r]=await h[r];const t=e=>{for(const r in s.hooks.transport){const n=s.hooks.transport[r].encode(e);if(n)return`app.decode('${r}', ${E.uneval(n,t)})`}};d.push(`data: ${E.uneval(e,t)}`)}r.push(`${N} = {\n\t\t\t\t\t\t${d.join(",\n\t\t\t\t\t\t")}\n\t\t\t\t\t};`);const f=["element"];if(r.push("const element = document.currentScript.parentElement;"),i.ssr){const r={form:"null",error:"null"};S&&(r.form=function(e,t,r){const s=e=>{for(const t in r){const n=r[t].encode(e);if(n)return`app.decode('${t}', ${E.uneval(n,s)})`}};return Ae(e,e=>E.uneval(e,s),t)}(S,m.route.id,s.hooks.transport)),l&&(r.error=E.uneval(l));const o=[`node_ids: [${e.map(({node:e})=>e.index).join(", ")}]`,`data: ${L}`,`form: ${r.form}`,`error: ${r.error}`];if(200!==c&&o.push(`status: ${c}`),a._.client.routes){if(t){const e=rt(t,m.url,a).replaceAll("\n","\n\t\t\t\t\t\t\t");o.push(`params: ${E.uneval(m.params)}`,`server_route: ${e}`)}}else s.embedded&&o.push(`params: ${E.uneval(m.params)}`,`route: ${De(m.route)}`);const i="\t".repeat(n?7:6);f.push(`{\n${i}\t${o.join(`,\n${i}\t`)}\n${i}}`)}const _=v.inline?`${v.inline.script}\n\n\t\t\t\t\t__sveltekit_${s.version_hash}.app.start(${f.join(", ")});`:v.app?`Promise.all([\n\t\t\t\t\t\timport(${De(H(v.start))}),\n\t\t\t\t\t\timport(${De(H(v.app))})\n\t\t\t\t\t]).then(([kit, app]) => {\n\t\t\t\t\t\tkit.start(app, ${f.join(", ")});\n\t\t\t\t\t});`:`import(${De(H(v.start))}).then((app) => {\n\t\t\t\t\t\tapp.start(${f.join(", ")})\n\t\t\t\t\t});`;if(n?r.push(`import(${De(`${O}/${p}/env.js`)}).then(({ env }) => {\n\t\t\t\t\t\t${N}.env = env;\n\n\t\t\t\t\t\t${_.replace(/\n/g,"\n\t")}\n\t\t\t\t\t});`):r.push(_),s.service_worker){const e="";r.push(`if ('serviceWorker' in navigator) {\n\t\t\t\t\t\taddEventListener('load', function () {\n\t\t\t\t\t\t\tnavigator.serviceWorker.register('${H("service-worker.js")}'${e});\n\t\t\t\t\t\t});\n\t\t\t\t\t}`)}const w=`\n\t\t\t\t{\n\t\t\t\t\t${r.join("\n\n\t\t\t\t\t")}\n\t\t\t\t}\n\t\t\t`;C.add_script(w),A+=`\n\t\t\t<script${C.script_needs_nonce?` nonce="${C.nonce}"`:""}>${w}<\/script>\n\t\t`}const M=new Headers({"x-sveltekit-page":"true","content-type":"text/html"});if(o.prerendering){const e=[],t=C.csp_provider.get_meta();t&&e.push(t),o.prerendering.cache&&e.push(`<meta http-equiv="cache-control" content="${o.prerendering.cache}">`),e.length>0&&(P=e.join("\n")+P)}else{const e=C.csp_provider.get_header();e&&M.set("content-security-policy",e);const t=C.report_only_provider.get_header();t&&M.set("content-security-policy-report-only",t),j.size&&M.set("link",Array.from(j).join(", "))}P+=R.head;const F=s.templates.app({head:P,body:A,assets:q,nonce:C.nonce,env:I}),G=await y.transformPageChunk({html:F,done:!0})||"";return z||M.set("etag",`"${Le(G)}"`),z?new Response(new ReadableStream({async start(e){e.enqueue(W.encode(G+"\n"));for await(const t of z)e.enqueue(W.encode(t));e.close()},type:"bytes"}),{headers:M}):n(G,{status:c,headers:M})}class it{data;constructor(e){this.data=e}layouts(){return this.data.slice(0,-1)}page(){return this.data.at(-1)}validate(){for(const t of this.layouts())t&&(O(t.server,t.server_id),q(t.universal,t.universal_id));const e=this.page();e&&(T(e.server,e.server_id),P(e.universal,e.universal_id))}#m(e){return this.data.reduce((t,r)=>r?.universal?.[e]??r?.server?.[e]??t,void 0)}csr(){return this.#m("csr")??!0}ssr(){return this.#m("ssr")??!0}prerender(){return this.#m("prerender")??!1}trailing_slash(){return this.#m("trailingSlash")??"never"}get_config(){let e={};for(const t of this.data)(t?.universal?.config||t?.server?.config)&&(e={...e,...t?.universal?.config,...t?.server?.config});return Object.keys(e).length?e:void 0}should_prerender_data(){return this.data.some(e=>e?.server?.load||void 0!==e?.server?.trailingSlash)}}async function ct({event:e,options:t,manifest:r,state:s,status:n,error:a,resolve_opts:o}){if(e.request.headers.get("x-sveltekit-error"))return he(t,n,a.message);const i=[];try{const c=[],l=await r._.nodes[0](),u=new it([l]),d=u.ssr(),p=u.csr();if(d){s.error=!0;const t=Ce({event:e,state:s,node:l,parent:async()=>({})}),n=await t,a=await He({event:e,fetched:i,node:l,parent:async()=>({}),resolve_opts:o,server_data_promise:t,state:s,csr:p});c.push({node:l,server_data:n,data:a},{node:await r._.nodes[1](),data:null,server_data:null})}return await ot({options:t,manifest:r,state:s,page_config:{ssr:d,csr:p},status:n,error:await me(e,t,a),branch:c,fetched:i,event:e,resolve_opts:o})}catch(l){return l instanceof c?_e(l.status,l.location):he(t,ne(l),(await me(e,t,l)).message)}}function lt(e,t=200){return n("string"==typeof e?e:JSON.stringify(e),{status:t,headers:{"content-type":"application/json","cache-control":"private, no-store"}})}function ut(e){return lt({type:"redirect",location:e.location})}function dt(e,t,r){let s=1,n=0;const{iterator:a,push:o,done:i}=et(),c={...Object.fromEntries(Object.entries(t.hooks.transport).map(([e,t])=>[e,t.encode])),Promise:r=>{if("function"==typeof r?.then){const a=s++;n+=1;let l="data";return r.catch(async r=>(l="error",me(e,t,r))).then(async r=>{let s;try{s=E.stringify(r,c)}catch{const r=await me(e,t,new Error(`Failed to serialize promise while rendering ${e.route.id}`));l="error",s=E.stringify(r,c)}n-=1,o(`{"type":"chunk","id":${a},"${l}":${s}}\n`),0===n&&i()}),a}}};try{return{data:`{"type":"data","nodes":[${r.map(e=>e?"error"===e.type||"skip"===e.type?JSON.stringify(e):`{"type":"data","data":${E.stringify(e.data,c)},"uses":${JSON.stringify(ge(e))}${e.slash?`,"slash":${JSON.stringify(e.slash)}`:""}}`:"null").join(",")}]}\n`,chunks:n>0?a:null}}catch(l){throw l.path="data"+l.path,new Error(ye(e,l))}}async function pt(t,r,s,a,o,u,d){if(o.depth>10)return n(`Not found: ${t.url.pathname}`,{status:404});if(xe(t)){const e=await a._.nodes[r.leaf]();return async function(e,t,r){const s=r?.actions;if(!s){const r=new i(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page");return Oe({type:"error",error:await me(e,t,r)},{status:r.status,headers:{allow:"GET"}})}qe(s);try{const r=await Te(e,s);return Oe(r instanceof l?{type:"failure",status:r.status,data:Pe(r.data,e.route.id,t.hooks.transport)}:{type:"success",status:r?200:204,data:Pe(r,e.route.id,t.hooks.transport)})}catch(n){const r=n;return r instanceof c?Se(r):Oe({type:"error",error:await me(e,t,Re(r))},{status:ne(r)})}}(t,s,e?.server)}try{const h=u.page();let f,m=200;if(function(e){return"POST"===e.request.method}(t)){const e=t.url.searchParams.get("/remote");if(f=e?await async function(e,t,r){const[s,n,a]=r.split("/"),o=t._.remotes,l=await(o[s]?.());let u=l?.[n];if(!u)return e.setHeaders({allow:"GET"}),{type:"error",error:new i(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page")};a&&(u=_(e,()=>u.for(JSON.parse(a))));try{const t=await e.request.formData(),r=u.__.fn;return await _(e,()=>r(t)),{type:"success",status:200}}catch(d){const e=d;return e instanceof c?{type:"redirect",status:e.status,location:e.location}:{type:"error",error:Re(e)}}}(t,a,e):await async function(e,t){const r=t?.actions;if(!r)return e.setHeaders({allow:"GET"}),{type:"error",error:new i(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page")};qe(r);try{const t=await Te(e,r);return t instanceof l?{type:"failure",status:t.status,data:t.data}:{type:"success",status:200,data:t}}catch(s){const e=s;return e instanceof c?{type:"redirect",status:e.status,location:e.location}:{type:"error",error:Re(e)}}}(t,h.server),"redirect"===f?.type)return _e(f.status,f.location);"error"===f?.type&&(m=ne(f.error)),"failure"===f?.type&&(m=f.status)}const y=u.prerender();if(y){const e=h.server;if(e?.actions)throw new Error("Cannot prerender pages with actions")}else if(o.prerendering)return new Response(void 0,{status:204});o.prerender_default=y;const g=u.should_prerender_data(),w=ke(t.url.pathname),v=[],$=u.ssr(),b=u.csr();if(!(!1!==$||o.prerendering&&g))return e&&f&&t.request.headers.has("x-sveltekit-action"),await ot({branch:[],fetched:v,page_config:{ssr:!1,csr:b},status:m,error:null,event:t,options:s,manifest:a,state:o,resolve_opts:d});const k=[];let j=null;const E=u.data.map((e,r)=>{if(j)throw j;return Promise.resolve().then(async()=>{try{if(e===h&&"error"===f?.type)throw f.error;return await Ce({event:t,state:o,node:e,parent:async()=>{const e={};for(let t=0;t<r;t+=1){const r=await E[t];r&&Object.assign(e,r.data)}return e}})}catch(s){throw j=s,j}})}),x=u.data.map((e,r)=>{if(j)throw j;return Promise.resolve().then(async()=>{try{return await He({event:t,fetched:v,node:e,parent:async()=>{const e={};for(let t=0;t<r;t+=1)Object.assign(e,await x[t]);return e},resolve_opts:d,server_data_promise:E[r],state:o,csr:b})}catch(s){throw j=s,j}})});for(const e of E)e.catch(()=>{});for(const e of x)e.catch(()=>{});for(let e=0;e<u.data.length;e+=1){const i=u.data[e];if(i)try{const t=await E[e],r=await x[e];k.push({node:i,server_data:t,data:r})}catch(p){const i=se(p);if(i instanceof c){if(o.prerendering&&g){const e=JSON.stringify({type:"redirect",location:i.location});o.prerendering.dependencies.set(w,{response:n(e),body:e})}return _e(i.status,i.location)}const l=ne(i),u=await me(t,s,i);for(;e--;)if(r.errors[e]){const n=r.errors[e],i=await a._.nodes[n]();let c=e;for(;!k[c];)c-=1;const p=ve(k.slice(0,c+1)),h=new it(p.map(e=>e.node));return await ot({event:t,options:s,manifest:a,state:o,resolve_opts:d,page_config:{ssr:h.ssr(),csr:h.csr()},status:l,error:u,branch:p.concat({node:i,data:null,server_data:null}),fetched:v})}return he(s,l,u.message)}else k.push(null)}if(o.prerendering&&g){let{data:e,chunks:r}=dt(t,s,k.map(e=>e?.server_data));if(r)for await(const t of r)e+=t;o.prerendering.dependencies.set(w,{response:n(e),body:e})}return await ot({event:t,options:s,manifest:a,state:o,resolve_opts:d,page_config:{csr:b,ssr:$},status:m,error:null,branch:!1===$?[]:ve(k),action_result:f,fetched:v})}catch(p){return await ct({event:t,options:s,manifest:a,state:o,status:500,error:p,resolve_opts:d})}}const ht=/[\x00-\x1F\x7F()<>@,;:"/[\]?={} \t]/;function ft(e){if(void 0===e?.path)throw new Error("You must specify a `path` when setting, deleting or serializing cookies")}function mt(e,t){if(!t)return!0;const r="."===t[0]?t.slice(1):t;return e===r||e.endsWith("."+r)}function _t(e,t){if(!t)return!0;const r=t.endsWith("/")?t.slice(0,-1):t;return e===r||e.startsWith(r+"/")}function yt(e,t){for(const r of t){const{name:t,value:s,options:n}=r;if(e.append("set-cookie",X(t,s,n)),n.path.endsWith(".html")){const r=ke(n.path);e.append("set-cookie",X(t,s,{...n,path:r}))}}}function gt({event:e,options:t,manifest:r,state:s,get_cookie_header:n,set_internal:a}){const o=async(o,i)=>{const c=wt(o,i,e.url);let l=(o instanceof Request?o.mode:i?.mode)??"cors",p=(o instanceof Request?o.credentials:i?.credentials)??"same-origin";return t.hooks.handleFetch({event:e,request:c,fetch:async(o,i)=>{const h=wt(o,i,e.url),f=new URL(h.url);if(h.headers.has("origin")||h.headers.set("origin",e.url.origin),o!==c&&(l=(o instanceof Request?o.mode:i?.mode)??"cors",p=(o instanceof Request?o.credentials:i?.credentials)??"same-origin"),"GET"!==h.method&&"HEAD"!==h.method||("no-cors"!==l||f.origin===e.url.origin)&&f.origin!==e.url.origin||h.headers.delete("origin"),f.origin!==e.url.origin){if(`.${f.hostname}`.endsWith(`.${e.url.hostname}`)&&"omit"!==p){const e=n(f,h.headers.get("cookie"));e&&h.headers.set("cookie",e)}return fetch(h)}const m=u||d,_=decodeURIComponent(f.pathname),y=(_.startsWith(m)?_.slice(m.length):_).slice(1),g=`${y}/index.html`,w=r.assets.has(y)||y in r._.server_assets,v=r.assets.has(g)||g in r._.server_assets;if(w||v){const e=w?y:g;if(s.read){const t=w?r.mimeTypes[y.slice(y.lastIndexOf("."))]:"text/html";return new Response(s.read(e),{headers:t?{"content-type":t}:{}})}if(M&&e in r._.server_assets){const t=r._.server_assets[e],s=r.mimeTypes[e.slice(e.lastIndexOf("."))];return new Response(M(e),{headers:{"Content-Length":""+t,"Content-Type":s}})}return await fetch(h)}if(we(r,d+_))return await fetch(h);if("omit"!==p){const t=n(f,h.headers.get("cookie"));t&&h.headers.set("cookie",t);const r=e.request.headers.get("authorization");r&&!h.headers.has("authorization")&&h.headers.set("authorization",r)}h.headers.has("accept")||h.headers.set("accept","*/*"),h.headers.has("accept-language")||h.headers.set("accept-language",e.request.headers.get("accept-language"));const $=await async function(e,t,r,s){if(e.signal){if(e.signal.aborted)throw new DOMException("The operation was aborted.","AbortError");let n=()=>{};const a=new Promise((t,r)=>{const s=()=>{r(new DOMException("The operation was aborted.","AbortError"))};e.signal.addEventListener("abort",s,{once:!0}),n=()=>e.signal.removeEventListener("abort",s)}),o=await Promise.race([St(e,t,r,{...s,depth:s.depth+1}),a]);return n(),o}return await St(e,t,r,{...s,depth:s.depth+1})}(h,t,r,s),b=$.headers.get("set-cookie");if(b)for(const e of Y.splitCookiesString(b)){const{name:t,value:r,...s}=Y.parseString(e,{decodeValues:!1}),n=s.path??(f.pathname.split("/").slice(0,-1).join("/")||"/");a(t,r,{path:n,encode:e=>e,...s})}return $}})};return(e,t)=>{const r=o(e,t);return r.catch(()=>{}),r}}function wt(e,t,r){return e instanceof Request?e:new Request("string"==typeof e?new URL(e,r):e,t)}let vt,$t,bt;const kt=({html:e})=>e,jt=()=>!1,Et=({type:e})=>"js"===e||"css"===e,xt=new Set(["GET","HEAD","POST"]),Rt=new Set(["GET","HEAD","OPTIONS"]);async function St(t,r,l,u){const h=new URL(t.url),f=h.pathname.endsWith(je);const m=function(e){return e.endsWith($e)||e.endsWith(be)}(h.pathname),y=function(e){return e.pathname.startsWith(`${d}/${p}/remote/`)&&e.pathname.replace(`${d}/${p}/remote/`,"")}(h);if(r.csrf_check_origin&&t.headers.get("origin")!==h.origin){const e={status:403};if(y&&"GET"!==t.method)return s({message:"Cross-site remote requests are forbidden"},e);if(re(t)&&("POST"===t.method||"PUT"===t.method||"PATCH"===t.method||"DELETE"===t.method)){const r=`Cross-site ${t.method} form submissions are forbidden`;return"application/json"===t.headers.get("accept")?s({message:r},e):n(r,e)}}if(r.hash_routing&&h.pathname!==d+"/"&&"/[fallback]"!==h.pathname)return n("Not found",{status:404});let E;f?h.pathname=function(e){return e.slice(0,-11)}(h.pathname):m?(h.pathname=function(e){return e.endsWith(be)?e.slice(0,-16)+".html":e.slice(0,-12)}(h.pathname)+("1"===h.searchParams.get($)?"/":"")||"/",h.searchParams.delete($),E=h.searchParams.get(b)?.split("").map(e=>"1"===e),h.searchParams.delete(b)):y&&(h.pathname=d,h.search="");const x={},{cookies:O,new_cookies:q,get_cookie_header:T,set_internal:P,set_trailing_slash:U}=function(e,t){const r=e.headers.get("cookie")??"",s=Q(r,{decode:e=>e});let n;const a={},o={httpOnly:!0,sameSite:"lax",secure:"localhost"!==t.hostname||"http:"!==t.protocol},i={get(e,s){const n=a[e];return n&&mt(t.hostname,n.options.domain)&&_t(t.pathname,n.options.path)?n.value:Q(r,{decode:s?.decode})[e]},getAll(e){const s=Q(r,{decode:e?.decode});for(const r of Object.values(a))mt(t.hostname,r.options.domain)&&_t(t.pathname,r.options.path)&&(s[r.name]=r.value);return Object.entries(s).map(([e,t])=>({name:e,value:t}))},set(e,t,r){const s=e.match(ht);s&&console.warn(`The cookie name "${e}" will be invalid in SvelteKit 3.0 as it contains ${s.join(" and ")}. See RFC 2616 for more details https://datatracker.ietf.org/doc/html/rfc2616#section-2.2`),ft(r),l(e,t,{...o,...r})},delete(e,t){ft(t),i.set(e,"",{...t,maxAge:0})},serialize(e,r,s){ft(s);let a=s.path;if(!s.domain||s.domain===t.hostname){if(!n)throw new Error("Cannot serialize cookies until after the route is determined");a=C(n,a)}return X(e,r,{...o,...s,path:a})}},c=[];function l(e,r,s){if(!n)return void c.push(()=>l(e,r,s));let o=s.path;s.domain&&s.domain!==t.hostname||(o=C(n,o)),a[e]={name:e,value:r,options:{...s,path:o}}}return{cookies:i,new_cookies:a,get_cookie_header:function(e,t){const r={...s};for(const s in a){const t=a[s];if(!mt(e.hostname,t.options.domain))continue;if(!_t(e.pathname,t.options.path))continue;const n=t.options.encode||encodeURIComponent;r[t.name]=n(t.value)}if(t){const e=Q(t,{decode:e=>e});for(const t in e)r[t]=e[t]}return Object.entries(r).map(([e,t])=>`${e}=${t}`).join("; ")},set_internal:l,set_trailing_slash:function(e){n=A(t.pathname,e),c.forEach(e=>e())}}}(t,h),N={[k]:j(u,r),cookies:O,fetch:null,getClientAddress:u.getClientAddress||(()=>{throw new Error("@sveltejs/adapter-static does not specify getClientAddress. Please raise an issue")}),locals:{},params:{},platform:u.platform,request:t,route:{id:null},setHeaders:e=>{for(const t in e){const r=t.toLowerCase(),s=e[t];if("set-cookie"===r)throw new Error("Use `event.cookies.set(name, value, options)` instead of `event.setHeaders` to set cookies");if(r in x)throw new Error(`"${t}" header is already set`);x[r]=s,u.prerendering&&"cache-control"===r&&(u.prerendering.cache=s)}},url:h,isDataRequest:m,isSubRequest:u.depth>0,isRemoteRequest:!!y};N.fetch=gt({event:N,options:r,manifest:l,state:u,get_cookie_header:T,set_internal:P}),u.emulator?.platform&&(N.platform=await u.emulator.platform({config:{},prerender:!!u.prerendering?.fallback}));let L=h.pathname;if(!y){const e=u.prerendering?.inside_reroute;try{u.prerendering&&(u.prerendering.inside_reroute=!0),L=await r.hooks.reroute({url:new URL(h),fetch:N.fetch})??h.pathname}catch{return n("Internal Server Error",{status:500})}finally{u.prerendering&&(u.prerendering.inside_reroute=e)}}try{L=H(L)}catch{return n("Malformed URI",{status:400})}if(L!==h.pathname&&!u.prerendering?.fallback&&we(l,L)){const e=new URL(t.url);e.pathname=m?ke(L):f?Ee(L):L;const r=await fetch(e,t),s=new Headers(r.headers);return s.has("content-encoding")&&(s.delete("content-encoding"),s.delete("content-length")),new Response(r.body,{headers:s,status:r.status,statusText:r.statusText})}let z=null;if(d&&!u.prerendering?.fallback){if(!L.startsWith(d))return n("Not found",{status:404});L=L.slice(d.length)||"/"}if(f)return async function(e,t,r){if(!r._.client.routes)return n("Server-side route resolution disabled",{status:400});let s=null,a={};const o=await r._.matchers();for(const n of r._.client.routes){const t=n.pattern.exec(e);if(!t)continue;const r=tt(t,n.params,o);if(r){s=n,a=S(r);break}}return nt(s,a,t,r).response}(L,new URL(t.url),l);if(L===`/${p}/env.js`)return function(e){return vt??=`export const env=${JSON.stringify(D)}`,$t??=`W/${Date.now()}`,bt??=new Headers({"content-type":"application/javascript; charset=utf-8",etag:$t}),e.headers.get("if-none-match")===$t?new Response(void 0,{status:304,headers:bt}):new Response(vt,{headers:bt})}(t);if(!y&&L.startsWith(`/${p}`)){const e=new Headers;return e.set("cache-control","public, max-age=0, must-revalidate"),n("Not found",{status:404,headers:e})}if(!u.prerendering?.fallback&&!y){const e=await l._.matchers();for(const t of l._.routes){const r=t.pattern.exec(L);if(!r)continue;const s=tt(r,t.params,e);if(s){z=t,N.route={id:z.id},N.params=S(s);break}}}let I={transformPageChunk:kt,filterSerializedResponseHeaders:jt,preload:Et},M="never";try{const p=z?.page?new it(await function(e,t){return Promise.all([...e.layouts.map(e=>null==e?e:t._.nodes[e]()),t._.nodes[e.leaf]()])}(z.page,l)):void 0;if(z){if(h.pathname===d||h.pathname===d+"/")M="always";else if(p)M=p.trailing_slash();else if(z.endpoint){const e=await z.endpoint();M=e.trailingSlash??"never"}if(!m){const e=A(h.pathname,M);if(e!==h.pathname&&!u.prerendering?.fallback)return new Response(void 0,{status:308,headers:{"x-sveltekit-normalize":"1",location:(e.startsWith("//")?h.origin+e:e)+("?"===h.search?"":h.search)}})}if(u.before_handle||u.emulator?.platform){let e={},t=!1;if(z.endpoint){const r=await z.endpoint();e=r.config??e,t=r.prerender??t}else p&&(e=p.get_config()??e,t=p.prerender());u.before_handle&&u.before_handle(N,e,t),u.emulator?.platform&&(N.platform=await u.emulator.platform({config:e,prerender:t}))}}U(M),!u.prerendering||u.prerendering.fallback||u.prerendering.inside_reroute||R(h);const f=await _(N,()=>r.hooks.handle({event:N,resolve:(d,h)=>_(null,()=>async function(d,p,h){try{if(h&&(I={transformPageChunk:h.transformPageChunk||kt,filterSerializedResponseHeaders:h.filterSerializedResponseHeaders||jt,preload:h.preload||Et}),r.hash_routing||u.prerendering?.fallback)return await ot({event:d,options:r,manifest:l,state:u,page_config:{ssr:!1,csr:!0},status:200,error:null,branch:[],fetched:[],resolve_opts:I});if(y)return await async function(e,t,r,n){const[l,u,d]=n.split("/"),p=r._.remotes;p[l]||a(404);const h=(await p[l]())[u];h||a(404);const f=h.__,m=t.hooks.transport;let y;try{if("form"===f.type){if(!re(e.request))throw new i(415,"Unsupported Media Type",`Form actions expect form-encoded data — received ${e.request.headers.get("content-type")}`);const t=await e.request.formData();y=JSON.parse(t.get("sveltekit:remote_refreshes")??"[]"),t.delete("sveltekit:remote_refreshes");const r=f.fn,n=await _(e,()=>r(t));return s({type:"result",result:w(n,m),refreshes:await $(y)})}if("command"===f.type){const{payload:t,refreshes:r}=await e.request.json(),n=v(t,m),a=await _(e,()=>h(n));return s({type:"result",result:w(a,m),refreshes:await $(r)})}const t="prerender"===f.type?d:new URL(e.request.url).searchParams.get("payload"),r=await _(e,()=>h(v(t,m)));return s({type:"result",result:w(r,m)})}catch(b){return b instanceof c?s({type:"redirect",location:b.location,refreshes:await $(y??[])}):s({type:"error",error:await me(e,t,b),status:b instanceof o||b instanceof i?b.status:500},{headers:{"cache-control":"private, no-store"}})}async function $(t){const s={...g(e).refreshes,...Object.fromEntries(await Promise.all(t.map(async t=>{const[s,n,o]=t.split("/"),i=r._.remotes[s];i||a(400,"Bad Request");const c=(await i())[n];return c||a(400,"Bad Request"),[t,await _(e,()=>c(v(o,m)))]})))};return Object.keys(s).length>0?w(s,m):void 0}}(d,r,l,y);if(z){const e=d.request.method;let s;if(m)s=await async function(e,t,r,s,n,a,l){if(!t.page)return new Response(void 0,{status:404});try{const u=[...t.page.layouts,t.page.leaf],d=a??u.map(()=>!0);let p=!1;const h=new URL(e.url);h.pathname=A(h.pathname,l);const f={...e,url:h},m=u.map((e,t)=>function(e){let t,r=!1;return()=>r?t:(r=!0,t=e())}(async()=>{try{if(p)return{type:"skip"};const r=null==e?e:await s._.nodes[e]();return Ce({event:f,state:n,node:r,parent:async()=>{const e={};for(let r=0;r<t;r+=1){const t=await m[r]();t&&Object.assign(e,t.data)}return e}})}catch(r){throw p=!0,r}})),_=m.map(async(e,t)=>d[t]?e():{type:"skip"});let y=_.length;const g=await Promise.all(_.map((t,s)=>t.catch(async t=>{if(t instanceof c)throw t;return y=Math.min(y,s+1),{type:"error",error:await me(e,r,t),status:t instanceof o||t instanceof i?t.status:void 0}}))),{data:w,chunks:v}=dt(e,r,g);return v?new Response(new ReadableStream({async start(e){e.enqueue(W.encode(w));for await(const t of v)e.enqueue(W.encode(t));e.close()},type:"bytes"}),{headers:{"content-type":"text/sveltekit-data","cache-control":"private, no-store"}}):lt(w)}catch(u){const t=u;return t instanceof c?ut(t):lt(await me(e,r,t),500)}}(d,z,r,l,u,E,M);else if(!z.endpoint||z.page&&!function(e){const{method:t,headers:r}=e.request;return!(!Z.includes(t)||ee.includes(t))||("POST"!==t||"true"!==r.get("x-sveltekit-action"))&&"text/html"!==te(e.request.headers.get("accept")??"*/*",["*","text/html"])}(d)){if(!z.page)throw new Error("Route is neither page nor endpoint. This should never happen");if(!p)throw new Error("page_nodes not found. This should never happen");if(xt.has(e))s=await pt(d,z.page,r,l,u,p,I);else{const t=new Set(Rt),r=await l._.nodes[z.page.leaf]();if(r?.server?.actions&&t.add("POST"),"OPTIONS"===e)s=new Response(null,{status:204,headers:{allow:Array.from(t.values()).join(", ")}});else{s=de([...t].reduce((e,t)=>(e[t]=!0,e),{}),e)}}}else s=await async function(e,t,r){const s=e.request.method;let n=t[s]||t.fallback;if("HEAD"===s&&!t.HEAD&&t.GET&&(n=t.GET),!n)return de(t,s);const a=t.prerender??r.prerender_default;if(a&&(t.POST||t.PATCH||t.PUT||t.DELETE))throw new Error("Cannot prerender endpoints that have mutative methods");if(r.prerendering&&!r.prerendering.inside_reroute&&!a){if(r.depth>0)throw new Error(`${e.route.id} is not prerenderable`);return new Response(void 0,{status:204})}try{const t=await _(e,()=>n(e));if(!(t instanceof Response))throw new Error(`Invalid response from route ${e.url.pathname}: handler should return a Response object`);if(r.prerendering&&(!r.prerendering.inside_reroute||a)){const s=new Response(t.clone().body,{status:t.status,statusText:t.statusText,headers:new Headers(t.headers)});if(s.headers.set("x-sveltekit-prerender",String(a)),!r.prerendering.inside_reroute||!a)return s;s.headers.set("x-sveltekit-routeid",encodeURI(e.route.id)),r.prerendering.dependencies.set(e.url.pathname,{response:s,body:null})}return t}catch(o){if(o instanceof c)return new Response(void 0,{status:o.status,headers:{location:o.location}});throw o}}(d,await z.endpoint(),u);if("GET"===t.method&&z.page&&z.endpoint){const e=s.headers.get("vary")?.split(",")?.map(e=>e.trim().toLowerCase());e?.includes("accept")||e?.includes("*")||(s=new Response(s.body,{status:s.status,statusText:s.statusText,headers:new Headers(s.headers)}),s.headers.append("Vary","Accept"))}return s}if(u.error&&d.isSubRequest){const e=new Headers(t.headers);return e.set("x-sveltekit-error","true"),await fetch(t,{headers:e})}return u.error?n("Internal Server Error",{status:500}):0===u.depth?(e&&d.url.pathname,await ct({event:d,options:r,manifest:l,state:u,status:404,error:new i(404,"Not Found",`Not found: ${d.url.pathname}`),resolve_opts:I})):u.prerendering?n("not found",{status:404}):await fetch(t)}catch(f){return await fe(d,r,f)}finally{d.cookies.set=()=>{throw new Error("Cannot use `cookies.set(...)` after the response has been generated")},d.setHeaders=()=>{throw new Error("Cannot use `setHeaders(...)` after the response has been generated")}}}(d,p,h).then(e=>{for(const t in x){const r=x[t];e.headers.set(t,r)}return yt(e.headers,Object.values(q)),u.prerendering&&null!==d.route.id&&e.headers.set("x-sveltekit-routeid",encodeURI(d.route.id)),e}))}));if(200===f.status&&f.headers.has("etag")){let e=t.headers.get("if-none-match");e?.startsWith('W/"')&&(e=e.substring(2));const r=f.headers.get("etag");if(e===r){const e=new Headers({etag:r});for(const t of["cache-control","content-location","date","expires","vary","set-cookie"]){const r=f.headers.get(t);r&&e.set(t,r)}return new Response(void 0,{status:304,headers:e})}}if(m&&f.status>=300&&f.status<=308){const e=f.headers.get("location");if(e)return ut(new c(f.status,e))}return f}catch(F){if(F instanceof c){const e=m?ut(F):z?.page&&xe(N)?Se(F):_e(F.status,F.location);return yt(e.headers,Object.values(q)),e}return await fe(N,r,F)}}const Ot={get({type:e},t){throw new Error(`Cannot read values from $env/dynamic/${e} while prerendering (attempted to read env.${t.toString()}). Use $env/static/${e} instead`)}};let qt;class Tt{#_;#y;constructor(e){this.#_=F,this.#y=e}async init({env:e,read:t}){const r={public_prefix:this.#_.env_public_prefix,private_prefix:this.#_.env_private_prefix},s=function(e,{public_prefix:t,private_prefix:r}){return Object.fromEntries(Object.entries(e).filter(([e])=>e.startsWith(r)&&(""===t||!e.startsWith(t))))}(e,r),n=function(e,{public_prefix:t,private_prefix:r}){return Object.fromEntries(Object.entries(e).filter(([e])=>e.startsWith(t)&&(""===r||!e.startsWith(r))))}(e,r);if(J(m?new Proxy({type:"private"},Ot):s),B(m?new Proxy({type:"public"},Ot):n),V(n),t){K(e=>{const r=t(e);return r instanceof ReadableStream?r:new ReadableStream({async start(e){try{const t=await Promise.resolve(r);if(!t)return void e.close();const s=t.getReader();for(;;){const{done:t,value:r}=await s.read();if(t)break;e.enqueue(r)}e.close()}catch(t){e.error(t)}}})})}await(qt??=(async()=>{try{const e=await G();this.#_.hooks={handle:e.handle||(({event:e,resolve:t})=>t(e)),handleError:e.handleError||(({status:e,error:t})=>console.error(404===e&&t?.message||t)),handleFetch:e.handleFetch||(({request:e,fetch:t})=>t(e)),handleValidationError:e.handleValidationError||(({issues:e})=>(console.error("Remote function schema validation failed:",e),{message:"Bad Request"})),reroute:e.reroute||(()=>{}),transport:e.transport||{}},e.transport&&Object.fromEntries(Object.entries(e.transport).map(([e,t])=>[e,t.decode])),e.init&&await e.init()}catch(e){throw e}})())}async respond(e,t){return St(e,this.#_,this.#y,{...t,error:!1,depth:0})}}export{Tt as Server};
